openapi: 3.0.3
info:
  title: å¤šç§Ÿæˆ·ç‰©æµå¹³å° API
  version: 1.0.2-safe
  description: |
    æ”¯æŒå®¢æˆ·ï¼ˆä¸‹å•æ–¹ï¼‰ä¸æ‰¿è¿æ–¹ï¼ˆæ¥å•æ–¹ï¼‰åŒè§’è‰²çš„ç‰©æµè®¢å•ç³»ç»Ÿã€‚
    - `/api/admin/...`ï¼šå¹³å°ç®¡ç†å‘˜
    - `/api/customer/...`ï¼šå®¢æˆ·ç§Ÿæˆ·
    - `/api/carrier/...`ï¼šæ‰¿è¿æ–¹ç§Ÿæˆ·
    - `/api/public/...`ï¼šå…¬å…±æ¥å£
    ğŸ”¹ æœ¬æ¬¡å¢å®¹ï¼ˆv1.0.2-safeï¼‰ï¼š
    - ä¿ç•™æ‰€æœ‰ v1.0.1 å­—æ®µã€è·¯ç”±ã€çŠ¶æ€ä¸å˜
    - æ–°å¢æ‰¿è¿æ–¹èƒ½åŠ›ç”»åƒï¼ˆå¯é€‰ï¼‰
    - æ–°å¢ä½“ç§¯ã€æ—¶æ•ˆç­‰å¯é€‰å­—æ®µ
    - æ–°å¢åŒ¹é…ç›¸å…³æ¥å£ï¼ˆä¸æ”¹åŠ¨åŸæœ‰ claim/award æµç¨‹ï¼‰
servers:
  - url: http://localhost:3000
    description: å¼€å‘ç¯å¢ƒ
tags:
  - name: setup
    description: å¹³å°åˆå§‹åŒ–ï¼ˆé¦–æ¬¡å®‰è£…ï¼‰
  - name: admin-auth
    description: å¹³å°ç®¡ç†å‘˜ - è®¤è¯ä¸ä¼šè¯
  - name: admin-user
    description: å¹³å°ç®¡ç†å‘˜ - ç”¨æˆ·ç®¡ç†
  - name: admin-tenant
    description: å¹³å°ç®¡ç†å‘˜ - ç§Ÿæˆ·ç®¡ç†
  - name: admin-order
    description: å¹³å°ç®¡ç†å‘˜ - è®¢å•ç®¡ç†
  - name: customer-order
    description: å®¢æˆ·ç§Ÿæˆ· - åˆ›å»ºä¸æŸ¥çœ‹è‡ªå·±çš„è®¢å•
  - name: carrier-order
    description: æ‰¿è¿æ–¹ç§Ÿæˆ· - è®¤é¢†ã€æ‰§è¡Œè®¢å•
  - name: public
    description: å…¬å…±æ¥å£ï¼ˆå°ç¨‹åºä½¿ç”¨ï¼Œæœªæ¥åºŸå¼ƒï¼‰
  - name: auth
    description: ç§Ÿæˆ·è®¤è¯ä¸ä¼šè¯
  - name: matching
    description: æ™ºèƒ½åŒ¹é…ï¼ˆæ–°å¢ï¼Œå¯é€‰ä½¿ç”¨ï¼‰
components:
  securitySchemes:
    AdminSessionAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: å¹³å°ç®¡ç†å‘˜ç™»å½•åè‡ªåŠ¨æºå¸¦ï¼ˆç”± Express Session ç®¡ç†ï¼‰
    TenantSessionAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: ç§Ÿæˆ·ç™»å½•åè‡ªåŠ¨æºå¸¦ï¼ˆç”± Express Session ç®¡ç†ï¼‰
  schemas:
    # --- ç§Ÿæˆ·ç›¸å…³ ---
    TenantApplication:
      type: object
      required:
        - name
        - contact_person
        - contact_phone
        - email
        - password
        - roles
      properties:
        name:
          type: string
          example: "ABC ç‰©æµå…¬å¸"
        contact_person:
          type: string
          example: "å¼ ä¸‰"
        contact_phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        roles:
          type: array
          items:
            type: string
            enum: [customer, carrier]
          minItems: 1
          example: ["customer", "carrier"]
        # === æ–°å¢ï¼šå¯é€‰èƒ½åŠ›å­—æ®µï¼ˆä¸å½±å“æ—§é€»è¾‘ï¼‰===
        address:
          type: string
          example: "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºXXè·¯XXå·"
        service_radius_km:
          type: integer
          minimum: 1
          example: 200
        capacity_kg:
          type: number
          minimum: 0.1
          example: 5000
        capacity_m3:
          type: number
          minimum: 0.1
          example: 30
        base_price_per_km:
          type: number
          minimum: 0.01
          example: 2.5
    TenantProfile:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        contact_person:
          type: string
        roles:
          type: array
          items:
            type: string
            enum: [customer, carrier]
        # === æ–°å¢ï¼šå¯é€‰èƒ½åŠ›å­—æ®µ ===
        address:
          type: string
        service_radius_km:
          type: integer
        capacity_kg:
          type: number
        capacity_m3:
          type: number
        base_price_per_km:
          type: number
        avg_rating:
          type: number
          minimum: 0
          maximum: 5
    # --- æŠ¥ä»·æ¨¡å‹ ---
    QuoteRequest:
      type: object
      required:
        - price
      properties:
        price:
          type: number
          minimum: 0.01
          example: 150.0
        estimated_hours:
          type: integer
          minimum: 1
          example: 24
        # === æ–°å¢ï¼šæ›´ç²¾ç¡®çš„åˆ°è¾¾æ—¶é—´ï¼ˆå¯é€‰ï¼‰===
        estimated_arrival:
          type: string
          format: date-time
          example: "2026-01-14T18:00:00Z"
        note:
          type: string
          example: "è‡ªæœ‰è½¦è¾†ï¼Œ24å°æ—¶å†…è£…è½¦"
    QuoteItem:
      type: object
      properties:
        id:
          type: string
        order_id:
          type: string
        carrier_tenant_id:
          type: string
        carrier_tenant_name:
          type: string
        price:
          type: number
        estimated_hours:
          type: integer
        # === æ–°å¢ ===
        estimated_arrival:
          type: string
          format: date-time
        avg_rating:
          type: number
        match_score:
          type: number
        note:
          type: string
        created_at:
          type: string
          format: date-time
    # --- è®¢å•ç›¸å…³ ---
    CreateOrderRequest:
      type: object
      required:
        - pickup_address
        - delivery_address
        - weight_kg
      properties:
        pickup_address:
          type: string
          example: "åŒ—äº¬å¸‚æœé˜³åŒºXXå¤§å¦"
        delivery_address:
          type: string
          example: "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºYYå›­åŒº"
        weight_kg:
          type: number
          format: float
          minimum: 0.1
          example: 25.5
        # === æ–°å¢å¯é€‰å­—æ®µ ===
        volume_m3:
          type: number
          minimum: 0.01
          example: 1.2
        required_delivery_time:
          type: string
          format: date-time
          example: "2026-01-15T12:00:00Z"
        quote_deadline:
          type: string
          format: date-time
          example: "2026-01-14T10:00:00Z"
        # åŸæœ‰å­—æ®µ
        customer_name:
          type: string
          example: "æå››"
        customer_phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
          example: "13800138000"
        description:
          type: string
          example: "æ˜“ç¢å“ï¼Œè¯·è½»æ‹¿è½»æ”¾"

    OrderItem:
      type: object
      properties:
        id:
          type: string
          example: "order_123e4567-e89b-12d3-a456-426614174000"
        customer_tenant_id:
          type: string
        customer_tenant_name:
          type: string
        carrier_tenant_id:
          type: string
          nullable: true
        carrier_tenant_name:
          type: string
          nullable: true
        pickup_address:
          type: string
        delivery_address:
          type: string
        weight_kg:
          type: number
        # === æ–°å¢å¯é€‰å­—æ®µ ===
        volume_m3:
          type: number
        required_delivery_time:
          type: string
          format: date-time
        quote_deadline:
          type: string
          format: date-time
        status:
          type: string # âš ï¸ ä¸¥æ ¼ä¿ç•™åŸçŠ¶æ€æšä¸¾ï¼
          enum: [created, claimed, awarded, dispatched, in_transit, delivered, cancelled]
        created_at:
          type: string
          format: date-time
        quotes:
          type: array
          items:
            $ref: '#/components/schemas/QuoteItem'
          nullable: true
    OrderListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "TENANT_ROLE_NOT_ENABLED"
        message:
          type: string
          example: "å½“å‰ç§Ÿæˆ·æœªå¯ç”¨å®¢æˆ·è§’è‰²"

    # --- ç§Ÿæˆ·ç®¡ç†ç›¸å…³è¡¥å……æ¨¡å‹ ---
    TenantListItem:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        contact_person:
          type: string
        contact_phone:
          type: string
        email:
          type: string
        status:
          type: string
          enum: [pending, approved, rejected, active, inactive]
        created_at:
          type: string
          format: date-time
        address:
          type: string
        service_radius_km:
          type: integer
        capacity_kg:
          type: number
        capacity_m3:
          type: number
        base_price_per_km:
          type: number
        avg_rating:
          type: number
          minimum: 0
          maximum: 5

    TenantDetail:
      allOf:
        - $ref: '#/components/schemas/TenantListItem'
        - type: object
          properties:
            updated_at:
              type: string
              format: date-time
            vehicles:
              type: array
              items:
                $ref: '#/components/schemas/VehicleInfo'
            financial_info:
              $ref: '#/components/schemas/TenantFinancialInfo'
            contact_info:
              $ref: '#/components/schemas/TenantContactInfo'

    VehicleInfo:
      type: object
      properties:
        id:
          type: integer
        plate_number:
          type: string
        type:
          type: string
        length:
          type: number
        width:
          type: number
        height:
          type: number
        max_weight:
          type: number
        volume:
          type: number
        status:
          type: string
        driver_name:
          type: string
        driver_phone:
          type: string
        image_url:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TenantFinancialInfo:
      type: object
      properties:
        bank_account_number:
          type: string
        bank_name:
          type: string
        tax_id:
          type: string
        settlement_cycle:
          type: string
        credit_limit:
          type: number
        outstanding_balance:
          type: number
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TenantContactInfo:
      type: object
      properties:
        finance_contact_name:
          type: string
        finance_contact_phone:
          type: string
        finance_contact_email:
          type: string
        support_contact_name:
          type: string
        support_contact_phone:
          type: string
        support_contact_email:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PaginationInfo:
      type: object
      properties:
        current_page:
          type: integer
        total_pages:
          type: integer
        total_items:
          type: integer
        per_page:
          type: integer

  responses:
    UnauthorizedError:
      description: æœªè®¤è¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ForbiddenError:
      description: æƒé™ä¸è¶³ï¼ˆå¦‚è§’è‰²ä¸åŒ¹é…ï¼‰
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFoundError:
      description: èµ„æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

paths:
  /api/mp/orders:
    post:
      summary: å°ç¨‹åºåŒ¿åä¸‹å•
      operationId: createMpOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sender_name:
                  type: string
                sender_phone:
                  type: string
                sender_address:
                  type: string
                receiver_name:
                  type: string
                receiver_phone:
                  type: string
                receiver_address:
                  type: string
                goods_desc:
                  type: string
                weight_kg:
                  type: number
                remark:
                  type: string
              required:
                - sender_name
                - sender_phone
                - receiver_name
                - receiver_phone
      responses:
        '201':
          description: è®¢å•åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  tracking_code:
                    type: string
                  status:
                    type: string
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯

  /api/admin/tenants:
    get:
      tags:
        - admin-tenant
      operationId: listAllTenants
      summary: è·å–æ‰€æœ‰ç§Ÿæˆ·ï¼ˆåˆ†é¡µã€å¯ç­›é€‰ï¼‰
      description: è·å–å¹³å°æ‰€æœ‰ç§Ÿæˆ·çš„åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€çŠ¶æ€ç­›é€‰å’Œå…³é”®è¯æœç´¢ã€‚
      security:
        - AdminSessionAuth: []
      parameters:
        - name: page
          in: query
          description: é¡µç 
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: æ¯é¡µæ•°é‡
          required: false
          schema:
            type: integer
            default: 10
        - name: status
          in: query
          description: ç­›é€‰ç§Ÿæˆ·çŠ¶æ€
          required: false
          schema:
            type: string
            enum: [pending, approved, rejected, active, inactive]
        - name: search
          in: query
          description: æœç´¢ç§Ÿæˆ·åç§°æˆ–è”ç³»äºº
          required: false
          schema:
            type: string
      responses:
        '200':
          description: ç§Ÿæˆ·åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tenants:
                        type: array
                        items:
                          $ref: '#/components/schemas/TenantListItem'
                      pagination:
                        $ref: '#/components/schemas/PaginationInfo'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/admin/tenants/{id}:
    get:
      tags:
        - admin-tenant
      operationId: getTenantById
      summary: è·å–å•ä¸ªç§Ÿæˆ·è¯¦æƒ…
      description: è·å–æŒ‡å®šIDç§Ÿæˆ·çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€è½¦è¾†ã€è´¢åŠ¡å’Œå®¢æœä¿¡æ¯ã€‚
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ç§Ÿæˆ·è¯¦æƒ…
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantDetail'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    put:
      tags:
        - admin-tenant
      operationId: updateTenantBasicInfo
      summary: æ›´æ–°ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
      description: æ›´æ–°æŒ‡å®šIDç§Ÿæˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚çŠ¶æ€ã€è”ç³»äººç­‰ï¼‰ã€‚
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                contact_person:
                  type: string
                contact_phone:
                  type: string
                email:
                  type: string
                  format: email
                status:
                  type: string
                  enum: [pending, approved, rejected, active, inactive]
                address:
                  type: string
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantListItem'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/financial:
    put:
      tags:
        - admin-tenant
      operationId: updateTenantFinancialInfo
      summary: æ›´æ–°ç§Ÿæˆ·è´¢åŠ¡ä¿¡æ¯
      description: æ›´æ–°æŒ‡å®šIDç§Ÿæˆ·çš„è´¢åŠ¡ä¿¡æ¯ã€‚
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantFinancialInfo'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantFinancialInfo'
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/contact:
    put:
      tags:
        - admin-tenant
      operationId: updateTenantContactInfo
      summary: æ›´æ–°ç§Ÿæˆ·è”ç³»ä¿¡æ¯
      description: æ›´æ–°æŒ‡å®šIDç§Ÿæˆ·çš„è´¢åŠ¡å’Œå®¢æœè”ç³»ä¿¡æ¯ã€‚
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantContactInfo'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantContactInfo'
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/vehicles:
    post:
      tags:
        - admin-tenant
      operationId: addTenantVehicle
      summary: æ·»åŠ ç§Ÿæˆ·è½¦è¾†
      description: ä¸ºæŒ‡å®šIDçš„ç§Ÿæˆ·æ·»åŠ ä¸€è¾†è½¦è¾†ä¿¡æ¯ã€‚
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VehicleInfo'
      responses:
        '201':
          description: æ·»åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/VehicleInfo'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/pc/tenants/apply:
    post:
      operationId: applyPcTenant
      summary: ç§Ÿæˆ·å…¥é©»ç”³è¯·
      description: æ–°ç§Ÿæˆ·æäº¤å…¥é©»ç”³è¯·ï¼Œåˆ›å»ºæ–°ç§Ÿæˆ·è´¦æˆ·
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - contact_person
                - contact_phone
                - email
                - password
                - roles
              properties:
                name:
                  type: string
                  description: å…¬å¸åç§°
                contact_person:
                  type: string
                  description: è”ç³»äººå§“å
                contact_phone:
                  type: string
                  description: è”ç³»ç”µè¯
                email:
                  type: string
                  description: é‚®ç®±åœ°å€
                password:
                  type: string
                  minLength: 6
                  description: å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
                roles:
                  type: array
                  items:
                    type: string
                    enum: [customer, carrier]
                  description: è§’è‰²åˆ—è¡¨
                address:
                  type: string
                  description: å…¬å¸åœ°å€
      responses:
        '201':
          description: ç§Ÿæˆ·åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: ç§Ÿæˆ·ID
                  name:
                    type: string
                  contact_person:
                    type: string
                  contact_phone:
                    type: string
                  email:
                    type: string
                  roles:
                    type: array
                    items:
                      type: string
                  address:
                    type: string
                  created_at:
                    type: string
                    format: date-time
        '400':
          description: è¯·æ±‚å‚æ•°ä¸å®Œæ•´æˆ–æ ¼å¼é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: MISSING_REQUIRED_FIELDS
        '409':
          description: é‚®ç®±å·²å­˜åœ¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: EMAIL_ALREADY_REGISTERED
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

  /api/health:
    get:
      summary: å¥åº·æ£€æŸ¥
      operationId: healthCheck
      tags:
        - public
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸è¿è¡Œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
        '500':
          description: æœåŠ¡å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/customer/order/bind:
    post:
      summary: å°†è®¢å•ç»‘å®šåˆ°å®¢æˆ·ï¼ˆé€šè¿‡æ‰‹æœºå·ï¼‰
      operationId: bindOrderToCustomer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                order_id:
                  type: string
                  example: "ORD123456"
                customer_phone:
                  type: string
                  example: "13800138000"
              required:
                - order_id
                - customer_phone
      responses:
        '200':
          description: ç»‘å®šæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
        '400':
          description: å‚æ•°é”™è¯¯æˆ–å®¢æˆ·ä¸å­˜åœ¨
        '401':
          description: æœªç™»å½•
        '404':
          description: è®¢å•æœªæ‰¾åˆ°æˆ–å·²ç»‘å®š

  /api/customer/orders:
    post:
      tags:
        - customer-order
      summary: å®¢æˆ·åˆ›å»ºæ–°è®¢å•
      operationId: createCustomerOrder
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: è®¢å•åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  order_id:
                    type: string
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    get:
      tags:
        - customer-order
      summary: è·å–å®¢æˆ·è‡ªå·±çš„è®¢å•åˆ—è¡¨
      operationId: listCustomerOrders
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: è®¢å•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/customer/orders/{orderId}:
    get:
      tags:
        - customer-order
      summary: è·å–å•ä¸ªå®¢æˆ·è®¢å•è¯¦æƒ…
      operationId: getCustomerOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: è®¢å•è¯¦æƒ…
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    put:
      tags:
        - customer-order
      summary: æ›´æ–°å®¢æˆ·è®¢å•ï¼ˆå¦‚ä¿®æ”¹åœ°å€ã€å¤‡æ³¨ç­‰ï¼‰
      operationId: updateCustomerOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pickup_address:
                  type: string
                delivery_address:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    delete:
      tags:
        - customer-order
      summary: åˆ é™¤å®¢æˆ·è®¢å•ï¼ˆä»…é™æœªè®¤é¢†çŠ¶æ€ï¼‰
      operationId: deleteCustomerOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/setup/status:
    get:
      tags:
        - setup
      summary: æ£€æŸ¥å¹³å°æ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–ï¼ˆæ˜¯å¦å­˜åœ¨ç®¡ç†å‘˜ï¼‰
      operationId: getSetupStatus
      responses:
        '200':
          description: è¿”å›åˆå§‹åŒ–çŠ¶æ€
          content:
            application/json:
              schema:
                type: object
                properties:
                  initialized:
                    type: boolean
                    example: false
        '500':
          description: æœåŠ¡å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/setup/admin:
    post:
      tags:
        - setup
      summary: åˆ›å»ºé¦–ä¸ªå¹³å°ç®¡ç†å‘˜ï¼ˆä»…é™æœªåˆå§‹åŒ–æ—¶è°ƒç”¨ï¼‰
      operationId: createFirstAdmin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - email
                - platform_name
              properties:
                username:
                  type: string
                  minLength: 3
                  example: "superadmin"
                password:
                  type: string
                  minLength: 8
                  example: "SecurePass123!"
                email:
                  type: string
                  format: email
                  example: "admin@yourlogistics.com"
                platform_name:
                  type: string
                  description: è¯¥å¹³å°å®ä¾‹çš„åç§°ï¼ˆå¦‚â€œåä¸œç‰©æµäº‘â€ï¼‰
                  example: "æˆ‘çš„ç‰©æµå¹³å°"
                license_key:
                  type: string
                  description: æˆæƒå¯†é’¥ï¼ˆå¯é€‰ï¼Œç”¨äºäº§å“æˆæƒéªŒè¯ï¼‰
                  example: "LIC-2026-XXXX-YYYY-ZZZZ"
      responses:
        '201':
          description: åˆå§‹åŒ–æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "å¹³å°åˆå§‹åŒ–æˆåŠŸ"
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: å¹³å°å·²åˆå§‹åŒ–ï¼Œç¦æ­¢é‡å¤åˆ›å»º
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/admin/login:
    post:
      tags:
        - admin-auth
      summary: å¹³å°ç®¡ç†å‘˜ç™»å½•
      operationId: adminLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "superadmin"
                password:
                  type: string
                  example: "SecurePass123!"
      responses:
        '200':
          description: ç™»å½•æˆåŠŸï¼ŒSet-Cookie è‡ªåŠ¨è®¾ç½® session
        '401':
          description: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/admin/logout:
    post:
      tags:
        - admin-auth
      summary: å¹³å°ç®¡ç†å‘˜ç™»å‡º
      operationId: adminLogout
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: ç™»å‡ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "å·²å®‰å…¨é€€å‡º"

  /api/admin/profile:
    get:
      tags:
        - admin-auth
      summary: è·å–å½“å‰ç®¡ç†å‘˜åŸºæœ¬ä¿¡æ¯
      operationId: getAdminProfile
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: ç®¡ç†å‘˜ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  username:
                    type: string
                  email:
                    type: string
                  platform_name:
                    type: string
                  created_at:
                    type: string
                    format: date-time
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/admin/users:
    post:
      tags:
        - admin-user
      summary: åˆ›å»ºæ–°çš„å¹³å°ç®¡ç†å‘˜ç”¨æˆ·ï¼ˆéœ€å½“å‰ç®¡ç†å‘˜æƒé™ï¼‰
      operationId: createAdminUser
      security:
        - AdminSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - email
              properties:
                username:
                  type: string
                  minLength: 3
                password:
                  type: string
                  minLength: 8
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [admin, operator]
                  default: admin
      responses:
        '201':
          description: ç®¡ç†å‘˜åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '409':
          description: ç”¨æˆ·åæˆ–é‚®ç®±å·²å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/admin/tenants/pending:
    get:
      tags:
        - admin-tenant
      operationId: listPendingTenants
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: å¾…å®¡æ ¸ç§Ÿæˆ·åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TenantApplication'

  /api/admin/tenants/{id}/approve:
    put:
      tags:
        - admin-tenant
      operationId: approveTenant
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: string
                    enum: [customer, carrier]
      responses:
        '200':
          description: å®¡æ ¸é€šè¿‡
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/reject:
    put:
      tags:
        - admin-tenant
      operationId: rejectTenantById
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                  description: æ‹’ç»åŸå› ï¼ˆå¯é€‰ï¼‰
      responses:
        '200':
          description: æ‹’ç»æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ç§Ÿæˆ·ç”³è¯·å·²æ‹’ç»"
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/orders:
    get:
      tags:
        - admin-order
      operationId: listAdminOrders
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: æ‰€æœ‰è®¢å•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'

  /api/admin/orders/{order_id}/status:
    put:
      tags:
        - admin-order
      operationId: updateOrderStatus
      security:
        - AdminSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [created, claimed, awarded, dispatched, in_transit, delivered, cancelled]
                  example: "cancelled"
      responses:
        '200':
          description: çŠ¶æ€æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "è®¢å•çŠ¶æ€å·²æ›´æ–°"
        '400':
          description: çŠ¶æ€å€¼æ— æ•ˆ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/public/orders:
    post:
      tags:
        - public
      summary: å°ç¨‹åºåˆ›å»ºè®¢å•ï¼ˆä¸´æ—¶ï¼‰
      operationId: createPublicOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: è®¢å•åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  order_id:
                    type: string
        '400':
          $ref: '#/components/responses/ForbiddenError'

  /api/carrier/orders:
    get:
      tags:
        - carrier-order
      summary: è·å–å¯è®¤é¢†çš„è®¢å•åˆ—è¡¨ï¼ˆçŠ¶æ€=createdï¼‰
      operationId: listCarrierOrders
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: å¯è®¤é¢†è®¢å•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/carrier/orders/{order_id}/claim:
    put:
      tags:
        - carrier
      summary: æ‰¿è¿å•†è®¤é¢†è®¢å•
      operationId: claimCarrierOrder
      security:
        - CarrierSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
          description: è®¢å•å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ tracking_number æˆ–ç³»ç»Ÿ IDï¼‰
      responses:
        '200':
          description: è®¤é¢†æˆåŠŸï¼Œè¿”å›æ›´æ–°åçš„å®Œæ•´è®¢å•ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/carrier/orders/{order_id}/complete:
    put:
      tags:
        - carrier-order
      summary: æ‰¿è¿æ–¹å®Œæˆè®¢å•
      operationId: completeCarrierOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: å®ŒæˆæˆåŠŸ
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/carrier/orders/{order_id}/quote:
    post:
      tags:
        - carrier-order
      summary: æ‰¿è¿æ–¹å¯¹è®¢å•æäº¤æŠ¥ä»·
      operationId: submitCarrierQuote
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuoteRequest'
      responses:
        '201':
          description: æŠ¥ä»·æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  quote_id:
                    type: string
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/customer/orders/{order_id}/award:
    post:
      tags:
        - customer-order
      summary: å®¢æˆ·é€‰æ‹©æ‰¿è¿æ–¹ï¼ˆæˆäº¤ï¼‰
      operationId: awardOrderToCarrier
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                carrier_tenant_id:
                  type: string
                  description: è¢«é€‰ä¸­çš„æ‰¿è¿æ–¹ç§Ÿæˆ·ID
              required:
                - carrier_tenant_id
      responses:
        '200':
          description: è®¢å•å·²åˆ†é…ç»™æ‰¿è¿æ–¹
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "è®¢å•å·²æˆäº¤ï¼Œæ‰¿è¿æ–¹å·²é€šçŸ¥"
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯ï¼ˆå¦‚ carrier_tenant_id æ— æ•ˆï¼‰
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/tenant-web/login:
    post:
      tags:
        - auth
      summary: ç§Ÿæˆ·ç™»å½•
      operationId: loginTenantWeb
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
        '401':
          description: é‚®ç®±æˆ–å¯†ç é”™è¯¯

  /api/tenant-web/profile:
    get:
      tags:
        - auth
      summary: è·å–ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
      operationId: getTenantProfile
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: ç§Ÿæˆ·ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantProfile'
    put:
      tags:
        - auth
      summary: æ›´æ–°ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
      operationId: updateTenantProfile
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contact_person:
                  type: string
                contact_phone:
                  type: string
                address:
                  type: string
      responses:
        '200':
          description: ä¿¡æ¯æ›´æ–°æˆåŠŸ
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - auth
      summary: ç§Ÿæˆ·åˆ›å»ºæ–°è®¢å•
      operationId: createTenantOrder
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - customer_name
                - customer_phone
                - address
                - weight
              properties:
                customer_name:
                  type: string
                customer_phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                address:
                  type: string
                weight:
                  type: number
                  minimum: 0.1
      responses:
        '201':
          description: è®¢å•åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  order_id:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/profile/roles:
    get:
      tags:
        - auth
      summary: è·å–ç§Ÿæˆ·å¯ç”¨çš„è§’è‰²åˆ—è¡¨
      operationId: getTenantRoles
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: è§’è‰²åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
                      enum: [customer, carrier]

  /api/pc-tenant/apply:
    post:
      tags:
        - auth
      summary: ç§Ÿæˆ·å…¥é©»ç”³è¯·
      operationId: applyPcTenant
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantApplication'
      responses:
        '201':
          description: ç”³è¯·æäº¤æˆåŠŸ

  /api/tenant-web/orders/pending:
    get:
      tags:
        - auth
      summary: è·å–å¯è®¤é¢†çš„è®¢å•åˆ—è¡¨ï¼ˆçŠ¶æ€=createdï¼‰
      operationId: listUnclaimedOrders
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: å¯è®¤é¢†è®¢å•åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/orders/{orderId}/claim:
    put:
      tags:
        - auth
      summary: ç§Ÿæˆ·è®¤é¢†è®¢å•
      operationId: claimOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: è®¤é¢†æˆåŠŸ
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/orders/{orderId}/complete:
    put:
      tags:
        - auth
      summary: ç§Ÿæˆ·å®Œæˆè®¢å•
      operationId: completeOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: å®ŒæˆæˆåŠŸ
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/logout:
    post:
      tags:
        - auth
      summary: ç§Ÿæˆ·ç™»å‡º
      operationId: logoutTenant
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: ç™»å‡ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "å·²å®‰å…¨é€€å‡º"

  # ======================
  # ğŸ”¸ æ–°å¢ï¼šæ™ºèƒ½åŒ¹é…æ¥å£ï¼ˆå…¨æ–°è·¯å¾„ï¼Œä¸å¹²æ‰°æ—§æµç¨‹ï¼‰
  /api/matching/search-carriers:
    post:
      tags:
        - matching
      summary: æ ¹æ®è®¢å•éœ€æ±‚æœç´¢åŒ¹é…çš„æ‰¿è¿æ–¹
      operationId: searchMatchingCarriers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - pickup_address
                - delivery_address
                - weight_kg
              properties:
                pickup_address:
                  type: string
                  example: "åŒ—äº¬å¸‚æœé˜³åŒºXXå¤§å¦"
                delivery_address:
                  type: string
                  example: "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºYYå›­åŒº"
                weight_kg:
                  type: number
                  format: float
                  minimum: 0.1
                  example: 25.5
                # === æ–°å¢å¯é€‰å­—æ®µ ===
                volume_m3:
                  type: number
                  minimum: 0.01
                  example: 1.2
                required_delivery_time:
                  type: string
                  format: date-time
                  example: "2026-01-15T12:00:00Z"
                preferred_carrier_ids:
                  type: array
                  items:
                    type: string
                  description: "ä¼˜å…ˆåŒ¹é…çš„æ‰¿è¿æ–¹IDåˆ—è¡¨"
      responses:
        '200':
          description: åŒ¹é…çš„æ‰¿è¿æ–¹åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QuoteItem'
        '400':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/matching/get-quote-suggestions:
    get:
      tags:
        - matching
      summary: è·å–é’ˆå¯¹ç‰¹å®šè®¢å•çš„é¢„ä¼°æŠ¥ä»·å»ºè®®
      operationId: getQuoteSuggestions
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
          description: è®¢å•ID
      responses:
        '200':
          description: é¢„ä¼°æŠ¥ä»·å»ºè®®åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QuoteItem'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'