openapi: 3.0.3
info:
  title: 澶氱鎴风墿娴佸钩鍙?API
  version: 1.0.2-safe
    鎶€鏈爤:Node.js + Express + SQLite + OpenAPI Backend
    璁よ瘉鏈哄埗:express-session(鍩轰簬 Cookie 鐨勪細璇濓級
    瀹夊叏妯″瀷锛氶€氳繃 TenantSessionAuth 瀹夊叏澶勭悊鍣ㄦ牎楠?req.session.userId
    澶氱鎴锋敮鎸?tenants 琛ㄥ瓨鍌ㄧ鎴?users 琛ㄥ瓨鍌ㄧ鎴峰憳宸?& 灏忕▼搴忛【瀹?
  description: |
    鏀寔瀹㈡埛锛堜笅鍗曟柟锛変笌鎵胯繍鏂癸紙鎺ュ崟鏂癸級鍙岃鑹茬殑鐗╂祦璁㈠崟绯荤粺銆?
    - `/api/admin/...`锛氬钩鍙扮鐞嗗憳
    - `/api/customer/...`锛氬鎴风鎴?
    - `/api/carrier/...`锛氭壙杩愭柟绉熸埛
    - `/api/public/...`锛氬叕鍏辨帴鍙?
    馃敼 鏈澧炲(v1.0.2-safe):
    - 淇濈暀鎵€鏈?v1.0.1 瀛楁銆佽矾鐢便€佺姸鎬佷笉鍙?
    - 鏂板鎵胯繍鏂硅兘鍔涚敾鍍忥紙鍙€夛級
    - 绉熸埛鏈韩鍙互鍦ㄤ竴瀹氭潯浠朵笅杞彉涓烘壙杩愭柟锛屽鎴凤紝浠撳簱瀹炰綋
    - 鏂板浣撶Н銆佹椂鏁堢瓑鍙€夊瓧娈?
    - 鏂板鍖归厤鐩稿叧鎺ュ彛锛堜笉鏀瑰姩鍘熸湁 claim/award 娴佺▼锛?
servers:
  - url: http://localhost:3000
    description: 寮€鍙戠幆澧?
tags:
  - name: setup
    description: 骞冲彴鍒濆鍖栵紙棣栨瀹夎锛?
  - name: admin-auth
    description: 骞冲彴绠＄悊鍛?- 璁よ瘉涓庝細璇?
  - name: admin-user
    description: 骞冲彴绠＄悊鍛?- 鐢ㄦ埛绠＄悊
  - name: admin-tenant
    description: 骞冲彴绠＄悊鍛?- 绉熸埛绠＄悊
  - name: admin-order
    description: 骞冲彴绠＄悊鍛?- 璁㈠崟绠＄悊
  - name: customer-order
    description: 瀹㈡埛绉熸埛 - 鍒涘缓涓庢煡鐪嬭嚜宸辩殑璁㈠崟
  - name: carrier-order
    description: 鎵胯繍鏂圭鎴?- 璁ら銆佹墽琛岃鍗?
  - name: public
    description: 鍏叡鎺ュ彛锛堝皬绋嬪簭浣跨敤锛屾湭鏉ュ簾寮冿級
  - name: auth
    description: 绉熸埛璁よ瘉涓庝細璇?
  - name: matching
    description: 鏅鸿兘鍖归厤锛堟柊澧烇紝鍙€変娇鐢級
components:
  securitySchemes:
    AdminSessionAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: 骞冲彴绠＄悊鍛樼櫥褰曞悗鑷姩鎼哄甫锛堢敱 Express Session 绠＄悊锛?
    TenantSessionAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: 绉熸埛鐧诲綍鍚庤嚜鍔ㄦ惡甯︼紙鐢?Express Session 绠＄悊锛?
  schemas:
   # 涓?Web 绔鎴锋敞鍐屼笓鐢?---
    CustomerWebRegistration:
      type: object
      required:
      - contact_phone
      - password
      - roles
      properties:
       contact_phone:
        type: string
        pattern: '^1[3-9][0-9]{9}$' # 涓浗鎵嬫満鍙锋牸寮?
      example: "13800138000"
    password:
      type: string
      minLength: 6
      example: "password123"
    roles:
      type: array
      items:
        type: string
        enum: [customer]
      example: ["customer"]
    # --- 閫氱敤楠岃瘉妯″紡 ---
    Username:
      type: string
      pattern: '^[a-zA-Z0-9_-]{3,20}$' # 鐢ㄦ埛鍚嶆牸寮忥細瀛楁瘝銆佹暟瀛椼€佷笅鍒掔嚎銆佽繛瀛楃锛岄暱搴?-20
      example: "user_name_123"

    Name:
      type: string
      pattern: '^[\u4e00-\u9fa5a-zA-Z0-9_-]{1,50}$' # 鍚嶇О鏍煎紡锛氭敮鎸佷腑鏂囥€佽嫳鏂囥€佹暟瀛椼€佷笅鍒掔嚎銆佽繛瀛楃锛岄暱搴?-50
      example: "寮犱笁"

    Address:
      type: string
      pattern: '^[\u4e00-\u9fa5a-zA-Z0-9\s\S]{1,200}$' # 鍦板潃鏍煎紡锛氭敮鎸佷腑鏂囥€佽嫳鏂囥€佹暟瀛椼€佺┖鏍煎強浠绘剰瀛楃锛岄暱搴?-200
      example: "鍖椾含甯傛湞闃冲尯鏌愭煇琛楅亾123鍙?

    # --- 绉熸埛鐩稿叧 ---
    TenantApplication:
      type: object
      required:
        - name
        - contact_person
        - contact_phone
        - email
        - password
        - roles
      properties:
        name:
          $ref: '#/components/schemas/Name'
        contact_person:
          $ref: '#/components/schemas/Name'
        contact_phone:
          type: string
          pattern: '^1[3-9][0-9]{9}$'
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        roles:
          type: array
          items:
            type: string
            enum: [customer, carrier]
          minItems: 1
          example: ["customer", "carrier"]
        # === 新增：可选能力字段（不影响旧逻辑）===
        address:
          $ref: '#/components/schemas/Address'
        service_radius_km:
          type: integer
          minimum: 1
          example: 200
        capacity_kg:
          type: number
          minimum: 0.1
          example: 5000
        capacity_m3:
          type: number
          minimum: 0.1
          example: 30
        base_price_per_km:
          type: number
          minimum: 0.01
          example: 2.5
    TenantProfile:
      type: object
      properties:
        id:
          type: string
        name:
          $ref: '#/components/schemas/Name'
        contact_person:
          $ref: '#/components/schemas/Name'
        roles:
          type: array
          items:
            type: string
            enum: [customer, carrier]
        # === 鏂板锛氬彲閫夎兘鍔涘瓧娈?===
        address:
          $ref: '#/components/schemas/Address'
        service_radius_km:
          type: integer
        capacity_kg:
          type: number
        capacity_m3:
          type: number
        base_price_per_km:
          type: number
        avg_rating:
          type: number
          minimum: 0
          maximum: 5
    # --- 鎶ヤ环妯″瀷 ---
    QuoteRequest:
      type: object
      required:
        - price
      properties:
        price:
          type: number
          minimum: 0.01
          example: 150.0
        estimated_hours:
          type: integer
          minimum: 1
          example: 24
        # === 鏂板锛氭洿绮剧‘鐨勫埌杈炬椂闂达紙鍙€夛級===
        estimated_arrival:
          type: string
          format: date-time
          example: "2026-01-14T18:00:00Z"
        note:
          type: string
          example: "鑷湁杞﹁締,24灏忔椂鍐呰杞?
    QuoteItem:
      type: object
      properties:
        id:
          type: string
        order_id:
          type: string
        carrier_tenant_id:
          type: string
        carrier_tenant_name:
          type: string
        price:
          type: number
        estimated_hours:
          type: integer
        # === 鏂板 ===
        estimated_arrival:
          type: string
          format: date-time
        avg_rating:
          type: number
        match_score:
          type: number
        note:
          type: string
        created_at:
          type: string
          format: date-time
    # --- 璁㈠崟鐩稿叧 ---
    CreateOrderRequest:
      type: object
      required:
        - pickup_address
        - delivery_address
        - weight_kg
      properties:
        pickup_address:
          type: string
          example: "鍖椾含甯傛湞闃冲尯XX澶у帵"
        delivery_address:
          type: string
          example: "涓婃捣甯傛郸涓滄柊鍖篩Y鍥尯"
        weight_kg:
          type: number
          format: float
          minimum: 0.1
          example: 25.5
        # === 灏忕▼搴忕鐗规湁瀛楁 ===
        cargo_type:
          type: string
          enum: [瀹跺叿瀹剁數, 瑁呬慨寤烘潗, 鍔炲叕鐢ㄥ搧, 蹇€掑寘瑁? 鍏朵粬]
          description: "璐х墿绫诲瀷"
          example: "瀹跺叿瀹剁數"
        cargo_remark:
          type: string
          description: "璐х墿澶囨敞"
          example: "鏄撶鍝侊紝璇峰皬蹇冩惉杩?
        length:
          type: number
          minimum: 0.01
          description: "璐х墿闀垮害(绫?"
          example: 1.2
        width:
          type: number
          minimum: 0.01
          description: "璐х墿瀹藉害(绫?"
          example: 0.8
        height:
          type: number
          minimum: 0.01
          description: "璐х墿楂樺害(绫?"
          example: 0.6
        vehicle_type:
          type: string
          enum: [鏃犱汉杞? 鏈変汉杞
          description: "杞﹀瀷瑕佹眰"
          example: "鏈変汉杞?
        pickup_time:
          type: string
          format: date-time
          description: "棰勭害鍙栬揣鏃堕棿"
          example: "2026-01-15T10:00:00Z"
        # === 鐜版湁鍙€夊瓧娈?===
        volume_m3:
          type: number
          minimum: 0.01
          example: 1.2
        required_delivery_time:
          type: string
          format: date-time
          example: "2026-01-15T12:00:00Z"
        quote_deadline:
          type: string
          format: date-time
          example: "2026-01-14T10:00:00Z"
        # 鍘熸湁瀛楁
        customer_name:
          $ref: '#/components/schemas/Name'
        customer_phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
          example: "13800138000"
        description:
          type: string
          example: "鏄撶鍝侊紝璇疯交鎷胯交鏀?

    OrderItem:
      type: object
      properties:
        id:
          type: string
          example: "order_123e4567-e89b-12d3-a456-426614174000"
        customer_tenant_id:
          type: string
        customer_tenant_name:
          type: string
        carrier_tenant_id:
          type: string
          nullable: true
        carrier_tenant_name:
          type: string
          nullable: true
        pickup_address:
          type: string
        delivery_address:
          type: string
        weight_kg:
          type: number
        volume_m3:
          type: number
        required_delivery_time:
          type: string
          format: date-time
        quote_deadline:
          type: string
          format: date-time
        status:
          type: string
          enum: [created, pending, pending_claim, claimed, quoted, awarded, dispatched, in_transit, delivered, cancelled] # 鈿狅笍 涓ユ牸淇濈暀鍘熺姸鎬佹灇涓撅紒
        created_at:
          type: string
          format: date-time
        quotes:
          type: array
          items:
            $ref: '#/components/schemas/QuoteItem'
          nullable: true
        order_id:
          type: string
          example: "ORD-20260205-001"
          description: 璁㈠崟鐨勫敮涓€鏍囪瘑绗︼紝鐢ㄤ簬鍓嶇灞曠ず鍜岃烦杞鎯呴〉
        updated_at:
          type: string
          format: date-time
          example: "2026-02-05T10:35:00Z"
          description: 璁㈠崟鏈€鍚庢洿鏂版椂闂?
        sender_info:
          type: string # 娉ㄦ剰锛氳繖鏄?JSON 瀛楃涓诧紝鍦ㄥ墠绔瑙ｆ瀽涓哄璞?
          example: '{"name": "寮犱笁", "phone": "13800138000"}'
          description: 鍙戣揣浜轰俊鎭紙JSON 瀛楃涓叉牸寮忥級
        receiver_info:
          type: string # 娉ㄦ剰锛氳繖鏄?JSON 瀛楃涓诧紝鍦ㄥ墠绔瑙ｆ瀽涓哄璞?
          example: '{"name": "鏉庡洓", "phone": "13900139000"}'
          description: 鏀惰揣浜轰俊鎭紙JSON 瀛楃涓叉牸寮忥級
        cargo_type:
          type: string
          example: "furniture"
          description: 璐х墿绫诲瀷
        length:
          type: number
          example: 1.2
          description: 璐х墿闀垮害锛堢背锛?
        width:
          type: number
          example: 0.8
          description: 璐х墿瀹藉害锛堢背锛?
        height:
          type: number
          example: 0.6
          description: 璐х墿楂樺害锛堢背锛?
        description:
          type: string
          example: "璇峰姟蹇呭皬蹇冭交鏀?
          description: 璁㈠崟澶囨敞
        total_price:
          type: number
          example: 299.99
          description: 璁㈠崟鎬讳环鏍?
      required:
        - id
        - order_id
        - status
        - created_at
        - pickup_address
        - delivery_address
        - sender_info
        - receiver_info
        - cargo_type
        - weight_kg
        - length
        - width
        - height
        - volume_m3
        - total_price
        # 娉ㄦ剰锛氳繖閲屽亣璁惧畠浠槸蹇呭～鐨勩€?
        - customer_tenant_id
        - customer_tenant_name
    OrderListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "鑾峰彇鎴愬姛"
        data:
          type: object
          properties:
            total:
              type: integer
              example: 5
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 10
            orders:
              type: array
              items:
                $ref: '#/components/schemas/OrderItem'
      required:
        - success
        - data
    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "TENANT_ROLE_NOT_ENABLED"
        message:
          type: string
          example: "褰撳墠绉熸埛鏈惎鐢ㄥ鎴疯鑹?

    # --- 绉熸埛绠＄悊鐩稿叧琛ュ厖妯″瀷 ---
    TenantListItem:
      type: object
      properties:
        id:
          type: integer
        name:
          $ref: '#/components/schemas/Name'
        contact_person:
          $ref: '#/components/schemas/Name'
        contact_phone:
          type: string
          pattern: '^1[3-9][0-9]{9}$'
        email:
          type: string
          format: email
        status:
          type: string
          enum: [pending, approved, rejected, active, inactive]
        created_at:
          type: string
          format: date-time
        address:
          type: string
        service_radius_km:
          type: integer
        capacity_kg:
          type: number
        capacity_m3:
          type: number
        base_price_per_km:
          type: number
        avg_rating:
          type: number
          minimum: 0
          maximum: 5

    TenantDetail:
      allOf:
        - $ref: '#/components/schemas/TenantListItem'
        - type: object
          properties:
            updated_at:
              type: string
              format: date-time
            vehicles:
              type: array
              items:
                $ref: '#/components/schemas/VehicleInfo'
            financial_info:
              $ref: '#/components/schemas/TenantFinancialInfo'
            contact_info:
              $ref: '#/components/schemas/TenantContactInfo'

    VehicleInfo:
      type: object
      properties:
        id:
          type: integer
        plate_number:
          type: string
        type:
          type: string
        length:
          type: number
        width:
          type: number
        height:
          type: number
        max_weight:
          type: number
        volume:
          type: number
        status:
          type: string
        driver_name:
          type: string
        driver_phone:
          type: string
        image_url:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TenantFinancialInfo:
      type: object
      properties:
        bank_account_number:
          type: string
        bank_name:
          type: string
        tax_id:
          type: string
        settlement_cycle:
          type: string
        credit_limit:
          type: number
        outstanding_balance:
          type: number
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TenantContactInfo:
      type: object
      properties:
        finance_contact_name:
          type: string
        finance_contact_phone:
          type: string
        finance_contact_email:
          type: string
        support_contact_name:
          type: string
        support_contact_phone:
          type: string
        support_contact_email:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PaginationInfo:
      type: object
      properties:
        current_page:
          type: integer
        total_pages:
          type: integer
        total_items:
          type: integer
        per_page:
          type: integer

  responses:
    UnauthorizedError:
      description: 鏈璇?
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ForbiddenError:
      description: 鏉冮檺涓嶈冻锛堝瑙掕壊涓嶅尮閰嶏級
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFoundError:
      description: 璧勬簮涓嶅瓨鍦?
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: 鍐呴儴鏈嶅姟鍣ㄩ敊璇?
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

paths:
  /api/admin/tenants:
    get:
      tags:
        - admin-tenant
      operationId: listAllTenants
      summary: 鑾峰彇鎵€鏈夌鎴凤紙鍒嗛〉銆佸彲绛涢€夛級
      description: 鑾峰彇骞冲彴鎵€鏈夌鎴风殑鍒楄〃锛屾敮鎸佸垎椤点€佺姸鎬佺瓫閫夊拰鍏抽敭璇嶆悳绱€?
      security:
        - AdminSessionAuth: []
      parameters:
        - name: page
          in: query
          description: 椤电爜
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: 姣忛〉鏁伴噺
          required: false
          schema:
            type: integer
            default: 10
        - name: status
          in: query
          description: 绛涢€夌鎴风姸鎬?
          required: false
          schema:
            type: string
            enum: [pending, approved, rejected, active, inactive]
        - name: search
          in: query
          description: 鎼滅储绉熸埛鍚嶇О鎴栬仈绯讳汉
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 绉熸埛鍒楄〃
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tenants:
                        type: array
                        items:
                          $ref: '#/components/schemas/TenantListItem'
                      pagination:
                        $ref: '#/components/schemas/PaginationInfo'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/admin/tenants/{id}:
    get:
      tags:
        - admin-tenant
      operationId: getTenantById
      summary: 鑾峰彇鍗曚釜绉熸埛璇︽儏
      description: 鑾峰彇鎸囧畾ID绉熸埛鐨勫畬鏁翠俊鎭紝鍖呮嫭鍩烘湰淇℃伅銆佽溅杈嗐€佽储鍔″拰瀹㈡湇淇℃伅銆?
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 绉熸埛璇︽儏
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantDetail'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    put:
      tags:
        - admin-tenant
      operationId: updateTenantBasicInfo
      summary: 鏇存柊绉熸埛鍩烘湰淇℃伅
      description: 鏇存柊鎸囧畾ID绉熸埛鐨勫熀鏈俊鎭紙濡傜姸鎬併€佽仈绯讳汉绛夛級銆?
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                contact_person:
                  type: string
                contact_phone:
                  type: string
                email:
                  type: string
                  format: email
                status:
                  type: string
                  enum: [pending, approved, rejected, active, inactive]
                address:
                  type: string
      responses:
        '200':
          description: 鏇存柊鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantListItem'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/financial:
    put:
      tags:
        - admin-tenant
      operationId: updateTenantFinancialInfo
      summary: 鏇存柊绉熸埛璐㈠姟淇℃伅
      description: 鏇存柊鎸囧畾ID绉熸埛鐨勮储鍔′俊鎭€?
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantFinancialInfo'
      responses:
        '200':
          description: 鏇存柊鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantFinancialInfo'
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/contact:
    put:
      tags:
        - admin-tenant
      operationId: updateTenantContactInfo
      summary: 鏇存柊绉熸埛鑱旂郴淇℃伅
      description: 鏇存柊鎸囧畾ID绉熸埛鐨勮储鍔″拰瀹㈡湇鑱旂郴淇℃伅銆?
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantContactInfo'
      responses:
        '200':
          description: 鏇存柊鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TenantContactInfo'
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/vehicles:
    post:
      tags:
        - admin-tenant
      operationId: addTenantVehicle
      summary: 娣诲姞绉熸埛杞﹁締
      description: 涓烘寚瀹欼D鐨勭鎴锋坊鍔犱竴杈嗚溅杈嗕俊鎭€?
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VehicleInfo'
      responses:
        '201':
          description: 娣诲姞鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/VehicleInfo'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/health:
    get:
      summary: 鍋ュ悍妫€鏌?
      operationId: healthCheck
      tags:
        - public
      responses:
        '200':
          description: 鏈嶅姟姝ｅ父杩愯
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
        '500':
          description: 鏈嶅姟鍐呴儴閿欒
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/customer/order/bind:
    post:
      summary: 灏嗚鍗曠粦瀹氬埌瀹㈡埛锛堥€氳繃鎵嬫満鍙凤級
      operationId: bindOrderToCustomer
      security:
       - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                order_id:
                  type: integer
                  example: 123456
              required:
                - order_id
      responses:
        '200':
          description: 缁戝畾鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
        '400':
          description: 鍙傛暟閿欒鎴栧鎴蜂笉瀛樺湪
        '401':
          description: 鏈櫥褰?
        '404':
          description: 璁㈠崟鏈壘鍒版垨宸茬粦瀹?

  /api/customer/orders:
    post:
      tags:
        - customer-order
      summary: 瀹㈡埛鍒涘缓鏂拌鍗?
      operationId: createCustomerOrder
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: 璁㈠崟鍒涘缓鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  order_id:
                    type: string
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    get:
      tags:
        - customer-order
      summary: 鑾峰彇瀹㈡埛鑷繁鐨勮鍗曞垪琛?
      operationId: listCustomerOrders
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: 璁㈠崟鍒楄〃
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/customer/orders/{order_id}:
    get:
      tags:
        - customer-order
      summary: 鑾峰彇鍗曚釜瀹㈡埛璁㈠崟璇︽儏
      operationId: getCustomerOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 璁㈠崟璇︽儏
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    put:
      tags:
        - customer-order
      summary: 鏇存柊瀹㈡埛璁㈠崟锛堝淇敼鍦板潃銆佸娉ㄧ瓑锛?
      operationId: updateCustomerOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pickup_address:
                  type: string
                delivery_address:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: 鏇存柊鎴愬姛
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    delete:
      tags:
        - customer-order
      summary: 鍒犻櫎瀹㈡埛璁㈠崟锛堜粎闄愭湭璁ら鐘舵€侊級
      operationId: deleteCustomerOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 鍒犻櫎鎴愬姛
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/customer/orders/{order_id}/quotes:
    get:
      tags:
        - customer-order
      summary: 鑾峰彇璁㈠崟鐨勬姤浠峰垪琛?
      operationId: getOrderQuotes
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
          description: 璁㈠崟ID
      responses:
        '200':
          description: 鎶ヤ环鍒楄〃
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      order_id:
                        type: string
                        example: "order_123"
                      quotes:
                        type: array
                        items:
                          type: object
                          properties:
                            carrier:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                                tenant_name:
                                  type: string
                            price:
                              type: number
                              example: 150.0
                            delivery_time:
                              type: string
                              format: date-time
                              example: "2026-01-14T18:00:00Z"
                            remarks:
                              type: string
                              example: "鍙姞鎬ワ紝浣嗛渶棰濆璐圭敤"
                            status:
                              type: string
                              example: "pending"
                            created_at:
                              type: string
                              format: date-time
                              example: "2026-01-13T10:00:00Z"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/setup/status:
    get:
      tags:
        - setup
      summary: 妫€鏌ュ钩鍙版槸鍚﹀凡瀹屾垚鍒濆鍖栵紙鏄惁瀛樺湪绠＄悊鍛橈級
      operationId: getSetupStatus
      responses:
        '200':
          description: 杩斿洖鍒濆鍖栫姸鎬?
          content:
            application/json:
              schema:
                type: object
                properties:
                  initialized:
                    type: boolean
                    example: false
        '500':
          description: 鏈嶅姟鍐呴儴閿欒
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/setup/admin:
    post:
      tags:
        - setup
      summary: 鍒涘缓棣栦釜骞冲彴绠＄悊鍛橈紙浠呴檺鏈垵濮嬪寲鏃惰皟鐢級
      operationId: createFirstAdmin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - email
                - platform_name
              properties:
                username:
                  $ref: '#/components/schemas/Username'
                password:
                  type: string
                  minLength: 8
                  example: "SecurePass123!"
                email:
                  type: string
                  format: email
                  example: "admin@yourlogistics.com"
                platform_name:
                  type: string
                  description: 璇ュ钩鍙板疄渚嬬殑鍚嶇О锛堝鈥滃崕涓滅墿娴佷簯鈥濓級
                  example: "鎴戠殑鐗╂祦骞冲彴"
                license_key:
                  type: string
                  description: 鎺堟潈瀵嗛挜锛堝彲閫夛紝鐢ㄤ簬浜у搧鎺堟潈楠岃瘉锛?
                  example: "LIC-2026-XXXX-YYYY-ZZZZ"
      responses:
        '201':
          description: 鍒濆鍖栨垚鍔?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "骞冲彴鍒濆鍖栨垚鍔?
        '400':
          description: 璇锋眰鍙傛暟閿欒
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 骞冲彴宸插垵濮嬪寲锛岀姝㈤噸澶嶅垱寤?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/ping:
    get:
      summary: 妫€鏌ュ綋鍓嶄細璇濇槸鍚︽湁鏁?
      description: 鐢ㄤ簬楠岃瘉鐢ㄦ埛鐧诲綍鐘舵€侊紙Session 鏄惁鏈夋晥锛夈€?
      security:
      - TenantSessionAuth: []
      tags:
        - auth 
      responses:
        '200':
          description: Session 鏈夋晥
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Session is valid"
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "user_123"
                      name:
                        type: string
                        example: "寮犱笁"
        '401':
          description: Session 鏃犳晥鎴栨湭鐧诲綍
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Session is invalid or not logged in"
  /api/admin/login:
    post:
      tags:
        - admin-auth
      summary: 骞冲彴绠＄悊鍛樼櫥褰?
      operationId: adminLogin
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  $ref: '#/components/schemas/Username'
                password:
                  type: string
                  example: "SecurePass123!"
      responses:
        '200':
          description: 鐧诲綍鎴愬姛,Set-Cookie 鑷姩璁剧疆 session
        '401':
          description: 鐢ㄦ埛鍚嶆垨瀵嗙爜閿欒
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/admin/logout:
    post:
      tags:
        - admin-auth
      summary: 骞冲彴绠＄悊鍛樼櫥鍑?
      operationId: adminLogout
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: 鐧诲嚭鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "宸插畨鍏ㄩ€€鍑?

  /api/admin/profile:
    get:
      tags:
        - admin-auth
      summary: 鑾峰彇褰撳墠绠＄悊鍛樺熀鏈俊鎭?
      operationId: getAdminProfile
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: 绠＄悊鍛樹俊鎭?
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  username:
                    type: string
                  email:
                    type: string
                  platform_name:
                    type: string
                  created_at:
                    type: string
                    format: date-time
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/admin/users:
    post:
      tags:
        - admin-user
      summary: 鍒涘缓鏂扮殑骞冲彴绠＄悊鍛樼敤鎴凤紙闇€褰撳墠绠＄悊鍛樻潈闄愶級
      operationId: createAdminUser
      security:
        - AdminSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
                - email
              properties:
                username:
                  $ref: '#/components/schemas/Username'
                password:
                  type: string
                  minLength: 8
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [admin, operator]
                  default: admin
      responses:
        '201':
          description: 绠＄悊鍛樺垱寤烘垚鍔?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '409':
          description: 鐢ㄦ埛鍚嶆垨閭宸插瓨鍦?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/admin/tenants/pending:
    get:
      tags:
        - admin-tenant
      operationId: listPendingTenants
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: 寰呭鏍哥鎴峰垪琛?
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TenantApplication'

  /api/admin/tenants/{id}/approve:
    put:
      tags:
        - admin-tenant
      summary: 鎵瑰噯绉熸埛鐢宠
      operationId: approveTenant
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: string
                    enum: [customer, carrier]
      responses:
        '200':
          description: 瀹℃牳閫氳繃
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/tenants/{id}/reject:
    put:
      tags:
        - admin-tenant
      summary: 鎷掔粷绉熸埛鐢宠
      operationId: rejectTenant
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                  description: 鎷掔粷鍘熷洜锛堝彲閫夛級
      responses:
        '200':
          description: 鎷掔粷鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "绉熸埛鐢宠宸叉嫆缁?
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/orders:
    get:
      tags:
        - admin-order
      operationId: listAdminOrders
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: 鎵€鏈夎鍗曞垪琛?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'

  /api/admin/orders/{id}/status:
    put:
      tags:
        - admin-order
      summary: 鎬诲悗鍙拌皟搴﹁鍗?
      operationId: updateOrderStatus
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [pending,pending_claim, available,created, claimed, awarded, dispatched, in_transit, delivered, cancelled]
                  example: "cancelled"
      responses:
        '200':
          description: 鐘舵€佹洿鏂版垚鍔?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "璁㈠崟鐘舵€佸凡鏇存柊"
        '400':
          description: 鐘舵€佸€兼棤鏁?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
  
  /api/public/orders/{id}:
    get:
      operationId: fetchPublicOrder
      summary: 鑾峰彇鍏紑璁㈠崟璇︽儏
      description: 閫氳繃杩借釜鍙疯幏鍙栬鍗曠殑鍏紑淇℃伅銆?
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: 璁㈠崟鐨勮拷韪彿 (tracking_number)
      responses:
        '200':
          description: 璁㈠崟淇℃伅鑾峰彇鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  order:
                    $ref: '#/components/schemas/OrderItem'
        '404':
          description: 璁㈠崟鏈壘鍒?
        '500':
          description: 鏈嶅姟鍣ㄥ唴閮ㄩ敊璇?
  
  /api/public/orders:
    post:
      tags:
        - public
      summary: 灏忕▼搴忓垱寤鸿鍗曪紙涓存椂锛?
      operationId: createPublicOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: 璁㈠崟鍒涘缓鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  order_id:
                    type: string
        '400':
          $ref: '#/components/responses/ForbiddenError'

  /api/carrier/orders:
    get:
      tags:
        - carrier-order
      summary: 鑾峰彇鍙棰嗙殑璁㈠崟鍒楄〃锛堢姸鎬?pending_claim)
      operationId: listCarrierOrders
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: 鍙棰嗚鍗曞垪琛?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/carrier/orders/{order_id}/claim:
    put:
      tags:
        - carrier-order
      summary: 鎵胯繍鍟嗚棰嗚鍗?
      operationId: claimCarrierOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: integer
          description: 璁㈠崟鍞竴鏍囪瘑锛堝 tracking_number 鎴栫郴缁?ID锛?
      responses:
        '200':
          description: 璁ら鎴愬姛锛岃繑鍥炴洿鏂板悗鐨勫畬鏁磋鍗曚俊鎭?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItem'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/carrier/orders/{order_id}/complete:
    put:
      tags:
        - carrier-order
      summary: 鎵胯繍鏂瑰畬鎴愯鍗?
      operationId: completeCarrierOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 瀹屾垚鎴愬姛
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/carrier/orders/{order_id}/start-delivery:
    put:
      tags:
        - carrier-order
      summary: 鎵胯繍鏂瑰紑濮嬮厤閫佽鍗?
      operationId: startDelivery
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
          description: 璁㈠崟ID
      responses:
        '200':
          description: 寮€濮嬮厤閫佹垚鍔?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery started successfully"
                  data:
                    type: object
                    properties:
                      order_id:
                        type: string
                        example: "order_123"
                      status:
                        type: string
                        example: "in_transit"
        '400':
          description: 璁㈠崟鐘舵€佷笉鍏佽寮€濮嬮厤閫?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/carrier/orders/{order_id}/quote:
    post:
      operationId: submitCarrierQuote
      summary: 鎵胯繍鍟嗕负鎸囧畾璁㈠崟鎻愪氦鎶ヤ环
      description: |
        鎵胯繍鍟嗘彁浜や竴涓姤浠凤紙浠锋牸銆侀璁￠€佽揪鏃堕棿銆佸娉級缁欐寚瀹氱殑璁㈠崟銆?
        姝ゆ搷浣滀笉浼氭敼鍙樿鍗曠殑涓荤姸鎬?status)鎶ヤ环淇℃伅灏嗗瓨鍌ㄥ湪 quotes 琛ㄤ腑銆?
        璁㈠崟鐘舵€佺殑鍙樻洿灏嗗湪鍚庣画鐨勫鎴烽€夋嫨鎴栧钩鍙版寚娲剧幆鑺傚彂鐢熴€?
      tags:
        - Carrier
        - Quote
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: integer
          description: 瑕佹姤浠风殑璁㈠崟ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                price:
                  type: number
                  format: float
                  minimum: 0.01
                  description: 鎶ヤ环閲戦
                  example: 150.75
                deliveryTime:
                  type: string
                  description: 棰勮閫佽揪鏃堕棿 (ISO 8601 鏍煎紡鎴栬嚜瀹氫箟鏍煎紡)
                  example: "2024-05-25T18:00:00Z"
                remarks:
                  type: string
                  maxLength: 500
                  description: 鎶ヤ环澶囨敞
                  example: "鍙姞鎬ワ紝浣嗛渶棰濆璐圭敤"
              required:
                - price
                - deliveryTime
      responses:
        '201':
          description: 鎶ヤ环鎻愪氦鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Quote submitted successfully"
                  data:
                    type: object
                    properties:
                      order_id:
                        type: integer
                        example: 123
                      quote:
                        type: object
                        properties:
                          price:
                            type: number
                            format: float
                            example: 150.75
                          deliveryTime:
                            type: string
                            example: "2024-05-25T18:00:00Z"
                          remarks:
                            type: string
                            example: "鍙姞鎬ワ紝浣嗛渶棰濆璐圭敤"
                      carrierId:
                        type: integer
                        example: 456
        '400':
          description: 璇锋眰鍙傛暟閿欒
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: 璁㈠崟鏈壘鍒版垨涓嶅厑璁告姤浠?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 鎵胯繍鍟嗗凡涓烘璁㈠崟鎻愪氦杩囨姤浠?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
         $ref: '#/components/responses/InternalServerError'

# ... (schemas, securitySchemes, responses remain unchanged)
# If you don't have an Error schema defined, add it under components/schemas:
#   Error:
#     type: object
#     properties:
#       success:
#         type: boolean
#         example: false
#       error:
#         type: string
#         example: "ERROR_CODE"
#       message:
#         type: string
#         example: "Human-readable error message" # Optional
#     required:
#       - success
#       - error

  /api/customer/orders/{order_id}/award:
    post:
      tags:
        - customer-order
      summary: 瀹㈡埛閫夋嫨鎵胯繍鏂癸紙鎴愪氦锛?
      operationId: awardOrderToCarrier
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                carrier_tenant_id:
                  type: string
                  description: 琚€変腑鐨勬壙杩愭柟绉熸埛ID
              required:
                - carrier_tenant_id
      responses:
        '200':
          description: 璁㈠崟宸插垎閰嶇粰鎵胯繍鏂?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "璁㈠崟宸叉垚浜わ紝鎵胯繍鏂瑰凡閫氱煡"
        '400':
          description: 璇锋眰鍙傛暟閿欒锛堝 carrier_tenant_id 鏃犳晥锛?
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/tenant-web/register:
    post:
      tags:
        - auth # 鍙互褰掔被鍒?auth锛屾垨鑰呮柊寤轰竴涓?'registration' tag
      summary: 绉熸埛/瀹㈡埛娉ㄥ唽
      operationId: registerTenantWeb
      description: 鏂扮鎴锋垨瀹㈡埛鎻愪氦娉ㄥ唽淇℃伅锛屽垱寤鸿处鎴枫€?
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerWebRegistration'
      responses:
        '201':
          description: 娉ㄥ唽鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Tenant registered successfully"
                  data:
                    type: object
                    description: "鍙€夛細杩斿洖鏂板垱寤虹殑绉熸埛淇℃伅鎴栫櫥褰曞嚟鎹?
                    properties:
                      tenant_id:
                        type: string
                        example: "tenant_abc123"
                      # 濡傛灉娉ㄥ唽鍚庤嚜鍔ㄧ櫥褰曪紝涔熷彲浠ヨ繑鍥?sessionData 鎴?token
                      # sessionData:
                      #   type: object
                      #   description: "Session 鏁版嵁锛岀敱 server.js 澶勭悊"
                      #   properties: ...
        '400':
          description: 璇锋眰鍙傛暟涓嶅畬鏁存垨鏍煎紡閿欒
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 閭鎴栨墜鏈哄彿宸插瓨鍦?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 鏈嶅姟鍣ㄥ唴閮ㄩ敊璇?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/tenant-web/login:
    post:
      tags:
        - auth
      summary: 绉熸埛鐧诲綍/瀹㈡埛鐧诲綍
      operationId: loginTenantWeb
      description: |
        绉熸埛鎴栧鎴蜂娇鐢ㄩ偖绠辨垨鎵嬫満鍙风櫥褰曘€?
        - 璇锋眰浣撳繀椤诲寘鍚?`email` 鎴?`phone` 涓殑 **浠绘剰涓€涓?*锛屼互鍙?`password`銆?
        - 绀轰緥 1: { "email": "user@example.com", "password": "..." }
        - 绀轰緥 2: { "phone": "13800138000", "password": "..." }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              # 绉婚櫎鍘熸湁鐨勫己鍒惰姹?email 鍜?password 鐨?required 鏁扮粍
              # required:
              #   - email
              #   - password
              properties:
                email:
                  type: string
                  format: email
                  description: "绉熸埛/瀹㈡埛娉ㄥ唽閭"
                  example: "user@example.com"
                phone:
                  type: string
                  pattern: '^1[3-9][0-9]{9}$' # 涓浗鎵嬫満鍙锋牸寮?
                  description: "绉熸埛/瀹㈡埛娉ㄥ唽鎵嬫満鍙?
                  example: "13800138000"
                password:
                  type: string
                  description: "鐧诲綍瀵嗙爜"
                  example: "SecurePassword123!"
              # 浠呭湪姝ゅ鏍囪 password 涓哄繀闇€锛宔mail 鍜?phone 鐢卞悗绔€昏緫鏍￠獙
              required:
                - password
      responses:
        '200':
          description: 鐧诲綍鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Login successful"
                  data:
                    type: object
                    properties:
                      tenant_id:
                        type: string
                        example: "tenant_12345"
                      name:
                        type: string
                        example: "Example Tenant"
                      roles:
                        type: array
                        items:
                          type: string
                          enum: [customer, carrier]
                        example: ["customer"]
                      # ... 鍙兘杩樻湁鍏朵粬瀛楁锛屽 token (濡傛灉浣跨敤 JWT) 绛?
                    required:
                      - tenant_id
                      - name
                      - roles
        '400':
          description: 璇锋眰鍙傛暟閿欒 (缂哄皯 email 鎴?phone锛屾垨鏍煎紡閿欒)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Either email or phone must be provided along with password."
        '401':
          description: 閭鎴栧瘑鐮侀敊璇?/ 鎵嬫満鍙锋垨瀵嗙爜閿欒 / 璐︽埛鏈縺娲?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid credentials" # 鎴?"Account is not active..."

  /api/tenant-web/profile:
    get:
      tags:
        - auth
      summary: 鑾峰彇绉熸埛鍩烘湰淇℃伅
      operationId: getTenantProfile
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: 绉熸埛淇℃伅
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantProfile'
    put:
      tags:
        - auth
      summary: 鏇存柊绉熸埛鍩烘湰淇℃伅
      operationId: updateTenantProfile
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contact_person:
                  type: string
                contact_phone:
                  type: string
                address:
                  type: string
      responses:
        '200':
          description: 淇℃伅鏇存柊鎴愬姛
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - auth
      summary: 绉熸埛鍒涘缓鏂拌鍗?
      operationId: createTenantOrder
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - customer_name
                - customer_phone
                - address
                - weight
              properties:
                customer_name:
                  type: string
                customer_phone:
                  type: string
                  pattern: '^1[3-9][0-9]{9}$'
                address:
                  type: string
                weight:
                  type: number
                  minimum: 0.1
      responses:
        '201':
          description: 璁㈠崟鍒涘缓鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  order_id:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/profile/roles:
    get:
      tags:
        - auth
      summary: 鑾峰彇绉熸埛鍚敤鐨勮鑹插垪琛?
      operationId: getTenantRoles
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: 瑙掕壊鍒楄〃
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
                      enum: [customer, carrier]

  /api/pc-tenant/apply:
    post:
      operationId: applyPcTenant
      summary: 绉熸埛鍏ラ┗鐢宠
      description: 鏂扮鎴锋彁浜ゅ叆椹荤敵璇凤紝鍒涘缓鏂扮鎴疯处鎴?
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - contact_person
                - contact_phone
                - email
                - password
                - roles
              properties:
                name:
                  type: string
                  description: 鍏徃鍚嶇О
                contact_person:
                  type: string
                  description: 鑱旂郴浜哄鍚?
                contact_phone:
                  type: string
                  description: 鑱旂郴鐢佃瘽
                email:
                  type: string
                  description: 閭鍦板潃
                password:
                  type: string
                  minLength: 6
                  description: 瀵嗙爜锛堣嚦灏?浣嶏級
                roles:
                  type: array
                  items:
                    type: string
                    enum: [customer, carrier]
                  description: 瑙掕壊鍒楄〃
                address:
                  type: string
                  description: 鍏徃鍦板潃
      responses:
        '201':
          description: 绉熸埛鍒涘缓鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: 绉熸埛ID
                  name:
                    type: string
                  contact_person:
                    type: string
                  contact_phone:
                    type: string
                  email:
                    type: string
                  roles:
                    type: array
                    items:
                      type: string
                  address:
                    type: string
                  created_at:
                    type: string
                    format: date-time
        '400':
          description: 璇锋眰鍙傛暟涓嶅畬鏁存垨鏍煎紡閿欒
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: MISSING_REQUIRED_FIELDS
        '409':
          description: 閭宸插瓨鍦?
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: EMAIL_ALREADY_REGISTERED
        '500':
          description: 鏈嶅姟鍣ㄥ唴閮ㄩ敊璇?

  /api/tenant-web/orders/pending:
    get:
      tags:
        - auth
      summary: 鑾峰彇鍙棰嗙殑璁㈠崟鍒楄〃锛堢姸鎬?created锛?
      operationId: listPendingOrders
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: 鍙棰嗚鍗曞垪琛?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/orders/{order_id}/claim:
    put:
      tags:
        - auth
      summary: 绉熸埛璁ら璁㈠崟
      operationId: claimOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 璁ら鎴愬姛
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/orders/{order_id}/complete:
    put:
      tags:
        - auth
      summary: 绉熸埛瀹屾垚璁㈠崟
      operationId: completeOrder
      security:
        - TenantSessionAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 瀹屾垚鎴愬姛
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/tenant-web/logout:
    post:
      tags:
        - auth
      summary: 绉熸埛鐧诲嚭
      operationId: logoutTenant
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: 鐧诲嚭鎴愬姛
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "宸插畨鍏ㄩ€€鍑?

  # ======================
  # 馃敻 鏂板锛氭櫤鑳藉尮閰嶆帴鍙ｏ紙鍏ㄦ柊璺緞锛屼笉骞叉壈鏃ф祦绋嬶級
  /api/matching/search-carriers:
    post:
      tags:
        - matching
      summary: 鏍规嵁璁㈠崟闇€姹傛悳绱㈠尮閰嶇殑鎵胯繍鏂?
      operationId: searchMatchingCarriers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - pickup_address
                - delivery_address
                - weight_kg
              properties:
                pickup_address:
                  type: string
                  example: "鍖椾含甯傛湞闃冲尯XX澶у帵"
                delivery_address:
                  type: string
                  example: "涓婃捣甯傛郸涓滄柊鍖篩Y鍥尯"
                weight_kg:
                  type: number
                  format: float
                  minimum: 0.1
                  example: 25.5
                # === 鏂板鍙€夊瓧娈?===
                volume_m3:
                  type: number
                  minimum: 0.01
                  example: 1.2
                required_delivery_time:
                  type: string
                  format: date-time
                  example: "2026-01-15T12:00:00Z"
                preferred_carrier_ids:
                  type: array
                  items:
                    type: string
                  description: "浼樺厛鍖归厤鐨勬壙杩愭柟ID鍒楄〃"
      responses:
        '200':
          description: 鍖归厤鐨勬壙杩愭柟鍒楄〃
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QuoteItem'
        '400':
          $ref: '#/components/responses/ForbiddenError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/matching/get-quote-suggestions:
    get:
      tags:
        - matching
      summary: 鑾峰彇閽堝鐗瑰畾璁㈠崟鐨勯浼版姤浠峰缓璁?
      operationId: getQuoteSuggestions
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
          description: 璁㈠崟ID
      responses:
        '200':
          description: 棰勪及鎶ヤ环寤鸿鍒楄〃
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QuoteItem'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/admin/reports/overview-stats:
    get:
      tags:
        - admin-reports
      summary: 获取概览统计数据
      operationId: getOverviewStats
      security:
        - AdminSessionAuth: []
      responses:
        '200':
          description: 概览统计数据
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      total_orders:
                        type: integer
                        example: 150
                      completed_orders:
                        type: integer
                        example: 120
                      in_transit_orders:
                        type: integer
                        example: 15
                      pending_orders:
                        type: integer
                        example: 10
                      processing_orders:
                        type: integer
                        example: 5
                      cancelled_orders:
                        type: integer
                        example: 0
                      total_customers:
                        type: integer
                        example: 50
                      recent_orders:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            tracking_number:
                              type: string
                            status:
                              type: string
                            created_at:
                              type: string
                              format: date-time
                            weight_kg:
                              type: number
                            customer_tenant_name:
                              type: string
                            sender_info:
                              type: object
                              properties:
                                name:
                                  type: string
                                phone:
                                  type: string
                            receiver_info:
                              type: object
                              properties:
                                name:
                                  type: string
                                phone:
                                  type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
