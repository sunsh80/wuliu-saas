<!-- pages/orderTrack/orderTrack.wxml -->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-title">订单跟踪</view>

  <!-- 订单编号 -->
  <view class="order-id-container">
    <text class="order-id-text">订单编号: {{ order.id }}</text>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{ loading }}" class="loading-container">
    <text>加载中...</text>
  </view>

  <!-- 错误状态 -->
  <view wx:elif="{{ error }}" class="error-container">
    <text class="error-text">{{ error }}</text>
    <button class="retry-btn" bindtap="onRefresh">重新加载</button>
  </view>

  <!-- 登录提示 -->
  <view wx:elif="{{ showLoginPrompt }}" class="login-prompt">
    <text>该订单已被承运商报价或接单，请登录以查看详细信息并进行操作。</text>
    <button bindtap="onLoginClick">去登录</button>
  </view>

  <!-- 报价选择状态 -->
  <view wx:elif="{{ order && order.status === 'quoted' }}" class="quotes-section">
    <!-- 说明文字 -->
    <view class="instructions">
      <text>以下承运商已报价，请选择您满意的方案：</text>
    </view>

    <!-- 承运商报价卡片列表 -->
    <view class="quote-card-wrapper">
      <view
        class="quote-card {{ selectedCarrierId === quote.carrier_tenant_id ? 'selected' : '' }}"
        wx:for="{{ carrierQuotes }}"
        wx:key="carrier_tenant_id"
        bindtap="onQuoteCardTap"
        data-carrier-id="{{ quote.carrier_tenant_id }}"
      >
        <!-- 承运商名称 -->
        <view class="carrier-name">
          <text>{{ quote.carrier_tenant_name || '未知承运商' }}</text>
        </view>

        <!-- 报价金额 -->
        <view class="quote-price">
          <text class="price-label">报价:</text>
          <text class="price-amount">¥{{ quote.price.toFixed(2) }}</text>
        </view>

        <!-- 预计送达时间 -->
        <view class="delivery-time" wx:if="{{ quote.estimated_arrival }}">
          <text class="time-label">预计送达:</text>
          <text class="time-value">{{ formatTime(quote.estimated_arrival) }}</text>
        </view>

        <!-- 备注 -->
        <view class="remarks" wx:if="{{ quote.note }}">
          <text class="remarks-label">备注:</text>
          <text class="remarks-content">{{ quote.note }}</text>
        </view>

        <!-- 选中状态图标 -->
        <view class="selection-icon" wx:if="{{ selectedCarrierId === quote.carrier_tenant_id }}">
          <text class="icon-selected">✓</text>
        </view>
      </view>
    </view>

    <!-- 确认选择按钮 -->
    <view class="action-buttons">
      <button
        class="confirm-btn {{ selectedCarrierId ? 'active' : 'disabled' }}"
        bindtap="onConfirmTap"
        disabled="{{ !selectedCarrierId }}"
      >
        确认选择
      </button>
    </view>
  </view>

  <!-- 其他订单状态的原有跟踪逻辑 -->
  <view wx:elif="{{ order }}" class="order-tracking-details">
    <!-- 订单状态 -->
    <view class="status-section">
      <text class="status-text">当前状态: {{ getStatusText(order.status) }}</text>
    </view>

    <!-- 订单详细信息 -->
    <view class="order-details">
      <view class="detail-item">
        <text class="label">起点:</text>
        <text class="value">{{ order.from_address }}</text>
      </view>
      <view class="detail-item">
        <text class="label">终点:</text>
        <text class="value">{{ order.to_address }}</text>
      </view>
      <view class="detail-item">
        <text class="label">货物描述:</text>
        <text class="value">{{ order.goods_description }}</text>
      </view>
      <view class="detail-item">
        <text class="label">下单时间:</text>
        <text class="value">{{ formatTime(order.created_at) }}</text>
      </view>
      <!-- 可能还有承运商信息、物流节点等... -->
      <view class="detail-item" wx:if="{{ order.claimed_at }}">
        <text class="label">被接单时间:</text>
        <text class="value">{{ formatTime(order.claimed_at) }}</text>
      </view>
      <view class="detail-item" wx:if="{{ order.claimed_by_carrier_name }}">
        <text class="label">承运商:</text>
        <text class="value">{{ order.claimed_by_carrier_name }}</text>
      </view>
      <!-- ... 其他状态特有信息 ... -->
    </view>
  </view>
</view>