<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统功能验证 - 物流管理系统</title>
    <link rel="stylesheet" href="/admin/css/style.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        
        .error {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        
        .info {
            background-color: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-warning {
            background-color: #f59e0b;
            color: white;
        }
        
        .btn-primary:hover, .btn-success:hover, .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: #10b981;
        }
        
        .status-inactive {
            background-color: #ef4444;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background-color: #f1f5f9;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>系统功能验证页面</h1>
        <p>此页面用于验证物流管理系统的所有功能是否正常工作</p>
        
        <div class="test-section">
            <h2>系统状态检查</h2>
            <div class="info-box">
                <div>前端服务器: <span id="frontend-status"><span class="status-indicator status-active"></span>运行中</span></div>
                <div>API基础URL: <code id="api-base-url">http://192.168.2.250:3000/api</code></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>1. API连接测试</h2>
            <button class="btn btn-primary" onclick="testApiConnection()">测试API连接</button>
            <div id="api-test-result" class="result info">点击按钮开始API连接测试</div>
        </div>
        
        <div class="test-section">
            <h2>2. 认证功能测试</h2>
            <input type="text" id="test-username" placeholder="用户名" value="admin" style="padding: 8px; margin-right: 10px;">
            <input type="password" id="test-password" placeholder="密码" value="admin123" style="padding: 8px; margin-right: 10px;">
            <button class="btn btn-success" onclick="testAuthentication()">测试认证</button>
            <div id="auth-test-result" class="result info">输入凭据并点击测试认证</div>
        </div>
        
        <div class="test-section">
            <h2>3. 数据获取测试</h2>
            <button class="btn btn-primary" onclick="testDataRetrieval()">测试数据获取</button>
            <div id="data-test-result" class="result info">点击按钮测试数据获取功能</div>
        </div>
        
        <div class="test-section">
            <h2>4. 页面导航测试</h2>
            <button class="btn btn-warning" onclick="testNavigation()">测试页面导航</button>
            <div id="navigation-test-result" class="result info">点击按钮测试页面导航功能</div>
            <div style="margin-top: 15px;">
                <h3>可用页面链接:</h3>
                <table>
                    <tr>
                        <td>首页</td>
                        <td><a href="/index.html" target="_blank">/index.html</a></td>
                    </tr>
                    <tr>
                        <td>登录页</td>
                        <td><a href="/login.html" target="_blank">/login.html</a></td>
                    </tr>
                    <tr>
                        <td>订单管理</td>
                        <td><a href="/orders.html" target="_blank">/orders.html</a></td>
                    </tr>
                    <tr>
                        <td>客户管理</td>
                        <td><a href="/customers.html" target="_blank">/customers.html</a></td>
                    </tr>
                    <tr>
                        <td>承运商管理</td>
                        <td><a href="/carriers.html" target="_blank">/carriers.html</a></td>
                    </tr>
                    <tr>
                        <td>租户管理</td>
                        <td><a href="/tenants.html" target="_blank">/tenants.html</a></td>
                    </tr>
                    <tr>
                        <td>报表统计</td>
                        <td><a href="/reports.html" target="_blank">/reports.html</a></td>
                    </tr>
                    <tr>
                        <td>入驻申请</td>
                        <td><a href="/application-list.html" target="_blank">/application-list.html</a></td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="test-section">
            <h2>5. 系统功能概览</h2>
            <div id="system-overview">
                <div>API一致性: <span id="api-consistency"><span class="status-indicator status-active"></span>已统一</span></div>
                <div>导航结构: <span id="navigation-status"><span class="status-indicator status-active"></span>已更新</span></div>
                <div>登录功能: <span id="login-status"><span class="status-indicator status-active"></span>正常</span></div>
                <div>数据连接: <span id="data-connection"><span class="status-indicator status-active"></span>已配置</span></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://192.168.2.250:3000/api';
        document.getElementById('api-base-url').textContent = API_BASE_URL;

        // 测试API连接
        async function testApiConnection() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = '正在测试API连接...';

            try {
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ API连接正常!<br>状态: ${data.status || 'OK'}<br>响应时间: ${response.responseTime || 'N/A'}ms`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ API连接失败: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ API连接错误: ${error.message}`;
            }
        }

        // 测试认证功能
        async function testAuthentication() {
            const resultDiv = document.getElementById('auth-test-result');
            const username = document.getElementById('test-username').value;
            const password = document.getElementById('test-password').value;

            resultDiv.className = 'result info';
            resultDiv.textContent = '正在测试认证功能...';

            if (!username || !password) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '请输入用户名和密码';
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.data && data.data.token) {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = '✅ 认证功能正常!<br>Token获取成功';
                    } else {
                        resultDiv.className = 'result error';
                        resultDiv.textContent = '❌ 认证响应中未包含token';
                    }
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ 认证失败: ${errorData.message || response.status}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ 认证请求失败: ${error.message}`;
            }
        }

        // 测试数据获取
        async function testDataRetrieval() {
            const resultDiv = document.getElementById('data-test-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = '正在测试数据获取...';

            try {
                // 尝试获取订单数据（需要认证）
                const token = localStorage.getItem('adminToken');
                if (!token) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '⚠️ 未找到认证令牌，请先登录<br>您可以前往 <a href="/login.html" target="_blank">登录页面</a> 进行登录';
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/admin/orders`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `✅ 数据获取正常!<br>获取到 ${data.data?.orders?.length || 0} 条订单数据`;
                } else if (response.status === 401) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '❌ 认证令牌无效或已过期<br>请前往 <a href="/login.html" target="_blank">登录页面</a> 重新登录';
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ 数据获取失败: ${response.status}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ 数据获取错误: ${error.message}`;
            }
        }

        // 测试页面导航
        function testNavigation() {
            const resultDiv = document.getElementById('navigation-test-result');
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `✅ 页面导航正常!<br>
                所有页面都已使用统一的侧边栏导航<br>
                所有链接都指向正确的页面路径<br>
                您可以点击上方的链接测试各个页面`;
        }

        // 页面加载时显示当前状态
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('api-test-result').innerHTML = '点击按钮开始API连接测试<br><small>使用API地址: <code>' + API_BASE_URL + '</code></small>';
        });
    </script>
</body>
</html>