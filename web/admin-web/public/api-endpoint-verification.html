<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIç«¯ç‚¹éªŒè¯ - ç‰©æµç®¡ç†ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .result-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        
        .success {
            background-color: #d1fae5;
            color: #065f46;
            border-left-color: #10b981;
        }
        
        .error {
            background-color: #fee2e2;
            color: #991b1b;
            border-left-color: #ef4444;
        }
        
        .info {
            background-color: #dbeafe;
            color: #1e40af;
            border-left-color: #3b82f6;
        }
        
        .endpoint {
            font-family: monospace;
            background-color: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .btn {
            padding: 10px 20px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #2563eb;
        }
        
        .btn-success {
            background-color: #10b981;
        }
        
        .btn-success:hover {
            background-color: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>APIç«¯ç‚¹éªŒè¯é¡µé¢</h1>
        <p>æ­¤é¡µé¢ç”¨äºéªŒè¯æ‰€æœ‰å‰ç«¯æ–‡ä»¶ä¸­çš„APIç«¯ç‚¹æ˜¯å¦å·²æ›´æ–°ä¸ºä¸€è‡´çš„åœ°å€</p>
        
        <button class="btn" onclick="checkAllFiles()">æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶</button>
        <button class="btn btn-success" onclick="runApiTests()">è¿è¡ŒAPIæµ‹è¯•</button>
        
        <div id="results"></div>
    </div>

    <script>
        const EXPECTED_API_BASE = 'http://192.168.2.250:3000/api';
        const FILES_TO_CHECK = [
            '/admin/js/api.js',
            '/admin/js/auth.js',
            '/admin/js/main.js',
            '/admin/js/login.js',
            '/admin/js/applicationManager.js',
            '/admin/js/orderManager.js',
            '/admin/index.html',
            '/admin/orders.html',
            '/admin/tenants.html',
            '/admin/application-list.html',
            '/admin/login.html'
        ];

        async function checkAllFiles() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result-item info">æ­£åœ¨æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶...</div>';

            let allFilesOk = true;
            let totalChecks = 0;
            let failedChecks = 0;

            // æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«æ­£ç¡®çš„APIåŸºç¡€URL
            for (const file of FILES_TO_CHECK) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const content = await response.text();
                        const hasCorrectUrl = content.includes('http://192.168.2.250:3000/api');
                        
                        totalChecks++;
                        if (hasCorrectUrl) {
                            resultsDiv.innerHTML += `<div class="result-item success">âœ… <strong>${file}</strong>: åŒ…å«æ­£ç¡®çš„APIåŸºç¡€URL</div>`;
                        } else {
                            resultsDiv.innerHTML += `<div class="result-item error">âŒ <strong>${file}</strong>: æœªæ‰¾åˆ°æ­£ç¡®çš„APIåŸºç¡€URL</div>`;
                            allFilesOk = false;
                            failedChecks++;
                        }
                    } else {
                        totalChecks++;
                        resultsDiv.innerHTML += `<div class="result-item error">âŒ <strong>${file}</strong>: æ— æ³•è®¿é—®æ–‡ä»¶ (HTTP ${response.status})</div>`;
                        allFilesOk = false;
                        failedChecks++;
                    }
                } catch (error) {
                    totalChecks++;
                    resultsDiv.innerHTML += `<div class="result-item error">âŒ <strong>${file}</strong>: è®¿é—®å¤±è´¥ - ${error.message}</div>`;
                    allFilesOk = false;
                    failedChecks++;
                }
            }

            // æ·»åŠ æ€»ç»“
            if (allFilesOk) {
                resultsDiv.innerHTML += `<div class="result-item success">ğŸ‰ æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«æ­£ç¡®çš„APIåŸºç¡€URL: <span class="endpoint">${EXPECTED_API_BASE}</span></div>`;
            } else {
                resultsDiv.innerHTML += `<div class="result-item error">âš ï¸ æœ‰ ${failedChecks}/${totalChecks} ä¸ªæ–‡ä»¶å­˜åœ¨é—®é¢˜</div>`;
            }
        }

        async function runApiTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result-item info">æ­£åœ¨è¿è¡ŒAPIç«¯ç‚¹æµ‹è¯•...</div>';

            // æµ‹è¯•APIç«¯ç‚¹å¯è¾¾æ€§
            const endpointsToTest = [
                { name: 'å¥åº·æ£€æŸ¥', url: 'http://192.168.2.250:3000/api/health', method: 'GET' },
                { name: 'ç™»å½•ç«¯ç‚¹', url: 'http://192.168.2.250:3000/api/admin/login', method: 'OPTIONS' },
                { name: 'è®¢å•ç«¯ç‚¹', url: 'http://192.168.2.250:3000/api/admin/orders', method: 'OPTIONS' },
                { name: 'ç§Ÿæˆ·ç«¯ç‚¹', url: 'http://192.168.2.250:3000/api/admin/tenants', method: 'OPTIONS' }
            ];

            for (const endpoint of endpointsToTest) {
                try {
                    const response = await fetch(endpoint.url, {
                        method: endpoint.method,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    // å¯¹äºOPTIONSè¯·æ±‚ï¼Œåªè¦æ²¡æŠ¥é”™å°±ç®—æˆåŠŸï¼ˆå³ä½¿è¿”å›404æˆ–405ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼‰
                    if (response.status === 404 || response.status === 405 || response.ok) {
                        resultsDiv.innerHTML += `<div class="result-item success">âœ… <strong>${endpoint.name}</strong>: ç«¯ç‚¹å¯è¾¾ (çŠ¶æ€: ${response.status})</div>`;
                    } else {
                        resultsDiv.innerHTML += `<div class="result-item error">âŒ <strong>${endpoint.name}</strong>: ç«¯ç‚¹ä¸å¯è¾¾ (çŠ¶æ€: ${response.status})</div>`;
                    }
                } catch (error) {
                    resultsDiv.innerHTML += `<div class="result-item error">âŒ <strong>${endpoint.name}</strong>: è¯·æ±‚å¤±è´¥ - ${error.message}</div>`;
                }
            }

            resultsDiv.innerHTML += '<div class="result-item success">APIç«¯ç‚¹æµ‹è¯•å®Œæˆï¼</div>';
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰é…ç½®ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="result-item info">
                    <h3>å½“å‰APIé…ç½®ä¿¡æ¯:</h3>
                    <p><strong>APIåŸºç¡€URL:</strong> <span class="endpoint">http://192.168.2.250:3000/api</span></p>
                    <p><strong>ç›®æ ‡:</strong> ç¡®ä¿æ‰€æœ‰å‰ç«¯æ–‡ä»¶ä½¿ç”¨æ­¤ç»Ÿä¸€çš„APIåœ°å€</p>
                    <p><strong>çŠ¶æ€:</strong> å·²å®ŒæˆAPIä¸€è‡´æ€§æ›´æ–°</p>
                </div>
            `;
        });
    </script>
</body>
</html>