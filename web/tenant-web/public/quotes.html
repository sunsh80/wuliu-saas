<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>报价管理 - 承运商系统</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    :root {
      --primary-color: #f97316; /* 橙色主色调 */
      --primary-dark: #ea580c; /* 深橙色 */
      --primary-light: #fb923c; /* 浅橙色 */
      --sidebar-bg: #1e293b; /* 深蓝灰色侧边栏 */
      --sidebar-item-hover: #334155; /* 侧边栏项目悬停色 */
      --topbar-bg: #ffffff; /* 顶部栏白色 */
      --topbar-text: #1e293b; /* 顶部栏文字深色 */
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8fafc;
      margin: 0;
      padding: 0;
      color: #334960;
    }

    .header {
      background-color: var(--topbar-bg);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 250px;
      right: 0;
      height: 60px;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary-color);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 250px;
      background-color: var(--sidebar-bg);
      color: white;
      padding: 20px 0;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      margin-top: 60px;
    }

    /* 自定义滚动条样式 */
    .sidebar-nav::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar-nav::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
    }

    .sidebar-nav::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.6);
      border-radius: 4px;
    }

    .sidebar-nav::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.9);
    }

    .nav-item {
      padding: 12px 24px;
      color: #cbd5e1;
      text-decoration: none;
      display: block;
      transition: all 0.3s;
    }

    .nav-item:hover, .nav-item.active {
      background-color: var(--sidebar-item-hover);
      color: white;
      border-left: 4px solid var(--primary-color);
    }

    .main-content {
      margin-left: 250px;
      margin-top: 60px;
      padding: 24px;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #1e293b;
      margin: 0;
    }

    .quote-management-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .pricing-config-section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .pricing-config-section h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    .config-tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 20px;
    }

    .tab-btn {
      padding: 10px 20px;
      border: none;
      background: #f8f9fa;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }

    .tab-btn.active {
      background: white;
      border-bottom: 3px solid var(--primary-color);
      color: var(--primary-color);
      font-weight: bold;
    }

    .tab-content {
      padding: 15px 0;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }

    .form-group input[type="number"],
    .form-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .time-pricing-sliders {
      margin-top: 15px;
    }

    .slider-item {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .slider-item label {
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    .slider {
      width: 100%;
      margin-bottom: 5px;
    }

    .slider-value {
      align-self: flex-end;
      font-size: 14px;
      color: #666;
    }

    .time-period-info {
      margin-top: 15px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
      font-size: 14px;
    }

    .weather-strategy {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 15px;
    }

    .strategy-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 4px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider-toggle {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider-toggle:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider-toggle {
      background-color: var(--primary-color);
    }

    input:checked + .slider-toggle:before {
      transform: translateX(26px);
    }

    .strategy-label {
      font-weight: bold;
      min-width: 80px;
    }

    .surcharge-input {
      width: 100px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
    }

    .surcharge-label {
      margin-left: 5px;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .checkbox-label input[type="checkbox"] {
      width: auto;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .suggestion-panel {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .suggestion-panel h2 {
      color: white;
      margin-top: 0;
    }

    .suggestions-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .suggestion-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 15px;
      backdrop-filter: blur(10px);
    }

    .suggestion-card h3 {
      margin-top: 0;
      color: white;
    }

    .suggestion-actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    .market-data ul {
      list-style: none;
      padding: 0;
    }

    .market-data li {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .quote-calculator-section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .quote-calculator-section h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    .calculator-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .calculator-result {
      background: #e8f5e9;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4caf50;
    }

    .calculator-result h3 {
      margin-top: 0;
      color: #2e7d32;
    }

    .quote-breakdown p {
      margin: 5px 0;
      color: #666;
      font-size: 14px;
    }
    
    .calculator-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
    }
    
    .control-group label {
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }
    
    .control-group input,
    .control-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .hourly-quote-table {
      overflow-x: auto;
    }
    
    .quote-hourly-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .quote-hourly-table th,
    .quote-hourly-table td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }
    
    .quote-hourly-table th {
      background-color: #f8f9fa;
      font-weight: bold;
      color: #555;
      position: sticky;
      top: 0;
    }
    
    .quote-hourly-table td {
      min-width: 80px;
      white-space: nowrap;
    }
    
    .time-slot-selector {
      margin-bottom: 20px;
    }
    
    .time-slot-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .time-slot-controls select {
      flex: 1;
      min-width: 200px;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .quote-dynamic-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .quote-dynamic-table th,
    .quote-dynamic-table td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    
    .quote-dynamic-table th {
      background-color: #f8f9fa;
      font-weight: bold;
      color: #555;
    }
    
    .quote-dynamic-table th small {
      display: block;
      font-weight: normal;
      color: #6c757d;
      font-size: 0.8em;
      margin-top: 4px;
    }
    
    .quote-dynamic-table td input,
    .quote-dynamic-table td select {
      width: 100%;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 3px;
      text-align: center;
    }
    
    .standard-price-row {
      background-color: #e9ecef !important;
    }
    
    .standard-price-cell {
      padding: 10px !important;
      vertical-align: top;
    }
    
    .standard-price-header {
      font-weight: bold;
      color: #495057;
      margin-bottom: 8px;
      font-size: 0.9em;
    }
    
    .standard-price-values {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    
    .standard-price-values span {
      background-color: #dee2e6;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85em;
    }
    
    .active-price {
      background-color: #d4edda !important;
    }
    
    .active-input {
      background-color: #e2e3e5 !important;
      opacity: 0.7;
    }
    
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .action-buttons .btn {
      margin: 2px 0;
      padding: 4px 8px;
      font-size: 12px;
    }
    
    .standard-reference {
      font-size: 0.7em;
      color: #6c757d;
      margin-top: 4px;
      padding: 2px 4px;
      background-color: #f8f9fa;
      border-radius: 3px;
      display: inline-block;
    }
    
    .standard-value {
      background-color: #f0f8ff;
      font-weight: 500;
      color: #0066cc;
      text-align: center;
    }
    
    .quote-dynamic-table th[rowspan], .quote-dynamic-table td[rowspan] {
      vertical-align: middle;
      text-align: center;
    }
    
    .quote-dynamic-table input, .quote-dynamic-table select {
      width: 100%;
      box-sizing: border-box;
    }
    
    .btn-success {
      background-color: #28a745;
      color: white;
    }
    
    .btn-success:hover:not(:disabled) {
      background-color: #218838;
    }
    
    .btn-warning {
      background-color: #ffc107;
      color: #212529;
    }
    
    .btn-warning:hover:not(:disabled) {
      background-color: #e0a800;
    }
    
    .total-price {
      font-weight: bold;
      color: #007bff;
    }
    
    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }
    
    .quote-low {
      background-color: #d4edda;
      color: #155724;
    }
    
    .quote-medium {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .quote-high {
      background-color: #f8d7da;
      color: #721c24;
    }

    .pending-orders-section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .pending-orders-section h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    .order-table-container {
      overflow-x: auto;
    }

    .quote-table {
      width: 100%;
      border-collapse: collapse;
    }

    .quote-table th,
    .quote-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .quote-table th {
      background-color: #f8f9fa;
      font-weight: bold;
      color: #555;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      transition: background-color 0.3s;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background-color: var(--primary-dark);
    }

    .btn-success {
      background-color: #28a745;
      color: white;
    }

    .btn-success:hover:not(:disabled) {
      background-color: #1e7e34;
    }

    .btn-outline {
      background-color: transparent;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .btn-outline:hover:not(:disabled) {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background-color: #545b62;
    }

    .btn:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid #fff;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- 侧边栏 -->
  <div class="sidebar">
    <div class="logo">承运商系统</div>
    <nav class="sidebar-nav">
      <a href="./carrier-dashboard.html" class="nav-item"><i class="fas fa-tachometer-alt"></i> 控制台</a>
      <a href="./orders.html" class="nav-item"><i class="fas fa-shipping-fast"></i> 订单管理</a>
      <a href="./quotes.html" class="nav-item active"><i class="fas fa-tags"></i> 报价管理</a>
      <a href="./vehicles.html" class="nav-item"><i class="fas fa-truck"></i> 车辆管理</a>
      <a href="./applications.html" class="nav-item"><i class="fas fa-file-alt"></i> 申请资料</a>
      <a href="./carrier-stop-points.html" class="nav-item"><i class="fas fa-map-marker-alt"></i> 停靠点管理</a>
      <a href="./map.html" class="nav-item"><i class="fas fa-map-marked-alt"></i> 地图服务</a>
      <a href="./profile.html" class="nav-item"><i class="fas fa-user"></i> 个人资料</a>
      <a href="./violations.html" class="nav-item"><i class="fas fa-exclamation-triangle"></i> 违规处理</a>

      <div class="nav-item has-submenu open">
        <div class="submenu-toggle">
          <span><i class="fas fa-yen-sign"></i> 财务管理</span>
          <i class="fas fa-chevron-down submenu-arrow"></i>
        </div>
        <ul class="submenu">
          <li><a href="./carrier-finance.html" class="nav-item">财务概览</a></li>
          <li><a href="./carrier-wallet.html" class="nav-item">钱包管理</a></li>
          <li><a href="./carrier-commissions.html" class="nav-item">抽佣管理</a></li>
          <li><a href="./carrier-settlements.html" class="nav-item">结算管理</a></li>
        </ul>
      </div>
      <a href="./settings.html" class="nav-item"><i class="fas fa-cog"></i> 内部设置</a>
      <a href="#" id="logout-btn" class="nav-item"><i class="fas fa-sign-out-alt"></i> 退出登录</a>
    </nav>
  </div>

  <!-- 顶部栏 -->
  <header class="header">
    <div class="logo">报价管理</div>
    <div class="user-info">
      <span id="welcome-message">欢迎，承运商</span>
      <div class="user-menu">
        <i class="fas fa-user-circle fa-lg"></i>
      </div>
    </div>
  </header>

  <!-- 主内容 -->
  <div id="app" class="main-content">
    <div class="page-header">
      <h1 class="page-title">报价管理系统</h1>
    </div>
    
    <div class="quote-management-container">
      <!-- 报价配置面板 -->
      <section class="pricing-config-section">
        <h2>报价配置</h2>
        <div class="config-tabs">
          <button 
            :class="['tab-btn', { active: activeTab === 'basic' }]" 
            @click="activeTab = 'basic'"
          >
            基础配置
          </button>
          <button 
            :class="['tab-btn', { active: activeTab === 'time' }]" 
            @click="activeTab = 'time'"
          >
            时间定价
          </button>
          <button 
            :class="['tab-btn', { active: activeTab === 'weather' }]" 
            @click="activeTab = 'weather'"
          >
            天气策略
          </button>
          <button 
            :class="['tab-btn', { active: activeTab === 'addons' }]" 
            @click="activeTab = 'addons'"
          >
            附加服务
          </button>
        </div>
        
        <!-- 基础配置 -->
        <div v-show="activeTab === 'basic'" class="tab-content">
          <div class="form-grid">
            <div class="form-group">
              <label for="basePrice">起步价 (元)</label>
              <input 
                type="number" 
                id="basePrice" 
                v-model="pricingConfig.basePrice" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                :disabled="loading"
              />
            </div>
            
            <div class="form-group">
              <label for="mileageRate">里程单价 (元/公里)</label>
              <input 
                type="number" 
                id="mileageRate" 
                v-model="pricingConfig.mileageRate" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                :disabled="loading"
              />
            </div>
            
            <div class="form-group">
              <label for="timeRate">时长单价 (元/分钟)</label>
              <input 
                type="number" 
                id="timeRate" 
                v-model="pricingConfig.timeRate" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                :disabled="loading"
              />
            </div>
            
            <div class="form-group">
              <label for="refrigeratedSurcharge">冷藏附加费 (元/单)</label>
              <input 
                type="number" 
                id="refrigeratedSurcharge" 
                v-model="pricingConfig.refrigeratedSurcharge" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                :disabled="loading"
              />
            </div>
          </div>
        </div>
        
        <!-- 时间定价 -->
        <div v-show="activeTab === 'time'" class="tab-content">
          <div class="time-pricing-sliders">
            <div class="slider-item">
              <label>高峰时段加价: {{ timePricing.peakMultiplier }}%</label>
              <input 
                type="range" 
                min="0" 
                max="100" 
                v-model.number="timePricing.peakMultiplier"
                @change="updateConfig"
                class="slider"
                :disabled="loading"
              />
              <span class="slider-value">{{ timePricing.peakMultiplier }}%</span>
            </div>
            
            <div class="slider-item">
              <label>平峰时段加价: {{ timePricing.normalMultiplier }}%</label>
              <input 
                type="range" 
                min="0" 
                max="50" 
                v-model.number="timePricing.normalMultiplier"
                @change="updateConfig"
                class="slider"
                :disabled="loading"
              />
              <span class="slider-value">{{ timePricing.normalMultiplier }}%</span>
            </div>
            
            <div class="slider-item">
              <label>低谷时段加价: {{ timePricing.offPeakMultiplier }}%</label>
              <input 
                type="range" 
                min="-20" 
                max="30" 
                v-model.number="timePricing.offPeakMultiplier"
                @change="updateConfig"
                class="slider"
                :disabled="loading"
              />
              <span class="slider-value">{{ timePricing.offPeakMultiplier }}%</span>
            </div>
          </div>
          
          <div class="time-period-info">
            <p><strong>高峰时段:</strong> 07:00-09:00, 17:00-19:00</p>
            <p><strong>平峰时段:</strong> 09:00-17:00</p>
            <p><strong>低谷时段:</strong> 19:00-07:00</p>
          </div>
        </div>
        
        <!-- 天气策略 -->
        <div v-show="activeTab === 'weather'" class="tab-content">
          <div class="weather-strategy">
            <div class="strategy-item" v-for="(strategy, weather) in weatherStrategies" :key="weather">
              <label class="switch">
                <input 
                  type="checkbox" 
                  :checked="strategy.enabled"
                  @change="toggleWeatherStrategy(weather)"
                  :disabled="loading"
                />
                <span class="slider-toggle"></span>
              </label>
              <span class="strategy-label">{{ getWeatherLabel(weather) }}</span>
              <input 
                type="number" 
                v-if="strategy.enabled"
                :value="strategy.surcharge"
                @change="updateWeatherSurcharge(weather, $event.target.value)"
                min="0"
                step="0.5"
                class="surcharge-input"
                :disabled="loading"
              />
              <span v-if="strategy.enabled" class="surcharge-label">元附加费</span>
            </div>
          </div>
        </div>
        
        <!-- 附加服务 -->
        <div v-show="activeTab === 'addons'" class="tab-content">
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  v-model="additionalServices.loadingEnabled"
                  @change="updateConfig"
                  :disabled="loading"
                />
                装卸服务
              </label>
              <input 
                v-if="additionalServices.loadingEnabled"
                type="number" 
                v-model="additionalServices.loadingFee" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                placeholder="装卸服务费用"
                :disabled="loading"
              />
            </div>
            
            <div class="form-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  v-model="additionalServices.waitingEnabled"
                  @change="updateConfig"
                  :disabled="loading"
                />
                等待费
              </label>
              <input 
                v-if="additionalServices.waitingEnabled"
                type="number" 
                v-model="additionalServices.waitingFeePerHour" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                placeholder="每小时等待费"
                :disabled="loading"
              />
            </div>
            
            <div class="form-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  v-model="additionalServices.insuranceEnabled"
                  @change="updateConfig"
                  :disabled="loading"
                />
                保险服务
              </label>
              <input 
                v-if="additionalServices.insuranceEnabled"
                type="number" 
                v-model="additionalServices.insuranceRate" 
                @change="updateConfig"
                min="0" 
                step="0.01"
                placeholder="保险费率 (%)"
                :disabled="loading"
              />
            </div>
            
            <div class="form-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  v-model="additionalServices.expressEnabled"
                  @change="updateConfig"
                  :disabled="loading"
                />
                加急服务
              </label>
              <input 
                v-if="additionalServices.expressEnabled"
                type="number" 
                v-model="additionalServices.expressMultiplier" 
                @change="updateConfig"
                min="1.1" 
                step="0.1"
                placeholder="加急倍数"
                :disabled="loading"
              />
            </div>
          </div>
        </div>
        
        <!-- 操作按钮 -->
        <div class="action-buttons">
          <button @click="saveConfig" class="btn btn-primary" :disabled="loading">
            {{ loading ? '保存中...' : '保存配置' }}
          </button>
          <button @click="resetConfig" class="btn btn-secondary" :disabled="loading">重置</button>
        </div>
      </section>
      
      <!-- 智能建议面板 -->
      <section class="suggestion-panel">
        <h2>智能建议</h2>
        <div class="suggestions-grid">
          <div class="suggestion-card">
            <h3>{{ currentSuggestion.title }}</h3>
            <p>{{ currentSuggestion.description }}</p>
            <div class="suggestion-actions">
              <button @click="applySuggestion(currentSuggestion)" class="btn btn-success">采纳建议</button>
              <button @click="nextSuggestion" class="btn btn-outline">跳过</button>
            </div>
          </div>
          <div class="market-data">
            <h3>市场参考数据</h3>
            <ul>
              <li>平均报价: ¥{{ marketData.averageQuote }}/单</li>
              <li>竞争报价范围: ¥{{ marketData.minQuote }} - ¥{{ marketData.maxQuote }}</li>
              <li>您的当前报价: ¥{{ currentQuote }}/单</li>
              <li>竞争力评分: {{ marketData.competitiveness }}/10</li>
            </ul>
          </div>
        </div>
      </section>
      
      <!-- 报价计算器 -->
      <section class="quote-calculator-section">
        <h2>报价计算器</h2>
        
        <!-- 时间段选择 -->
        <div class="time-slot-selector">
          <h3>选择时间段</h3>
          <div class="time-slot-controls">
            <select v-model="selectedTimeSlot">
              <option value="">选择时间段...</option>
              <option v-for="slot in timeSlots" :key="slot" :value="slot">{{ slot }}</option>
            </select>
            <button @click="addTimeSlot" class="btn btn-primary" :disabled="!selectedTimeSlot || timeSlotExists(selectedTimeSlot)">添加时间段</button>
          </div>
        </div>
        
        <!-- 动态报价表格 -->
        <div class="dynamic-quote-table">
          <div class="table-header">
            <h3>报价管理</h3>
            <button @click="toggleTable" class="btn btn-secondary">
              {{ showTable ? '折叠' : '展开' }}
            </button>
          </div>
          
          <div v-show="showTable" class="table-container">
            <table class="quote-dynamic-table">
              <thead>
                <tr>
                  <th>时间段</th>
                  <th>起步价 (元)</th>
                  <th>里程 (公里)</th>
                  <th>超时附加费</th>
                  <th>天气附加费</th>
                  <th>车型</th>
                  <th>加急服务</th>
                  <th>附加费 (元)</th>
                  <th>总计</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <template v-for="slot in selectedTimeSlots" :key="slot.timeSlot">
                  <!-- 标准价格行 -->
                  <tr class="standard-price-row">
                    <td>{{ slot.timeSlot }}</td>
                    <td class="standard-value">¥{{ getStandardPriceForTimeSlot(slot.timeSlot).basePrice.toFixed(2) }}</td>
                    <td class="standard-value">{{ getStandardPriceForTimeSlot(slot.timeSlot).distanceRate.toFixed(2) }}/km</td>
                    <td class="standard-value">{{ getStandardPriceForTimeSlot(slot.timeSlot).overtimeSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).overtimeSurcharge.toFixed(2) : '无' }}</td>
                    <td class="standard-value">{{ getStandardPriceForTimeSlot(slot.timeSlot).weatherSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).weatherSurcharge.toFixed(2) : '无' }}</td>
                    <td class="standard-value">{{ getStandardPriceForTimeSlot(slot.timeSlot).vehicleSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).vehicleSurcharge.toFixed(2) : '无' }}</td>
                    <td class="standard-value">{{ getStandardPriceForTimeSlot(slot.timeSlot).expressSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).expressSurcharge.toFixed(2) : '无' }}</td>
                    <td class="standard-value">¥{{ getStandardPriceForTimeSlot(slot.timeSlot).additionalFee.toFixed(2) }}</td>
                    <td class="standard-value">¥{{ getStandardPriceForTimeSlot(slot.timeSlot).total.toFixed(2) }}</td>
                    <td></td>
                  </tr>

                  <!-- 承运商自定义价格行 -->
                  <tr :class="{ 'active-price': slot.isActive }">
                    <td>{{ slot.timeSlot }}</td>
                    <td>
                      <input
                        type="number"
                        v-model.number="slot.params.basePrice"
                        @input="updateSlotQuote(slot)"
                        min="0"
                        step="0.01"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }"
                      />
                      <div class="standard-reference">标准: ¥{{ getStandardPriceForTimeSlot(slot.timeSlot).basePrice.toFixed(2) }}</div>
                    </td>
                    <td>
                      <input
                        type="number"
                        v-model.number="slot.params.distance"
                        @input="updateSlotQuote(slot)"
                        min="0"
                        step="0.1"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }"
                      />
                      <div class="standard-reference">标准: {{ getStandardPriceForTimeSlot(slot.timeSlot).distanceRate.toFixed(2) }}/km</div>
                    </td>
                    <td>
                      <select
                        v-model="slot.params.overtimeCharge"
                        @change="updateSlotQuote(slot)"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }">
                        <option value="false">无附加费</option>
                        <option value="true">启用附加费</option>
                      </select>
                      <div class="standard-reference">标准: {{ getStandardPriceForTimeSlot(slot.timeSlot).overtimeSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).overtimeSurcharge.toFixed(2) : '无' }}</div>
                    </td>
                    <td>
                      <select
                        v-model="slot.params.weather"
                        @change="updateSlotQuote(slot)"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }">
                        <option value="normal">正常</option>
                        <option value="rain">雨天</option>
                        <option value="snow">雪天</option>
                        <option value="storm">风暴</option>
                      </select>
                      <div class="standard-reference">标准: {{ getStandardPriceForTimeSlot(slot.timeSlot).weatherSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).weatherSurcharge.toFixed(2) : '无' }}</div>
                    </td>
                    <td>
                      <select
                        v-model="slot.params.vehicleType"
                        @change="updateSlotQuote(slot)"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }">
                        <option value="normal">常温车</option>
                        <option value="refrigerated">冷藏车</option>
                      </select>
                      <div class="standard-reference">标准: {{ getStandardPriceForTimeSlot(slot.timeSlot).vehicleSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).vehicleSurcharge.toFixed(2) : '无' }}</div>
                    </td>
                    <td>
                      <select
                        v-model="slot.params.isExpress"
                        @change="updateSlotQuote(slot)"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }">
                        <option :value="false">否</option>
                        <option :value="true">是</option>
                      </select>
                      <div class="standard-reference">标准: {{ getStandardPriceForTimeSlot(slot.timeSlot).expressSurcharge > 0 ? '¥' + getStandardPriceForTimeSlot(slot.timeSlot).expressSurcharge.toFixed(2) : '无' }}</div>
                    </td>
                    <td>
                      <input
                        type="number"
                        v-model.number="slot.params.additionalFee"
                        @input="updateSlotQuote(slot)"
                        min="0"
                        step="0.01"
                        :disabled="loading || slot.isActive"
                        :class="{ 'active-input': slot.isActive }"
                      />
                      <div class="standard-reference">标准: ¥{{ getStandardPriceForTimeSlot(slot.timeSlot).additionalFee.toFixed(2) }}</div>
                    </td>
                    <td class="total-price">
                      ¥{{ slot.quote.toFixed(2) }}
                      <div class="standard-reference">标准: ¥{{ getStandardPriceForTimeSlot(slot.timeSlot).total.toFixed(2) }}</div>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <button
                          v-if="!slot.isActive"
                          @click="activateSlot(slot)"
                          class="btn btn-success btn-sm"
                          :disabled="loading"
                        >
                          生效
                        </button>
                        <button
                          v-if="slot.isActive"
                          @click="deactivateSlot(slot)"
                          class="btn btn-warning btn-sm"
                          :disabled="loading"
                        >
                          修改
                        </button>
                        <button
                          @click="removeTimeSlot(slot.timeSlot)"
                          class="btn btn-danger btn-sm"
                          :disabled="loading || slot.isActive"
                        >
                          删除
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </section>
      
      <!-- 待报价订单列表 -->
      <section class="pending-orders-section">
        <h2>待报价订单</h2>
        <div class="order-table-container">
          <table class="quote-table">
            <thead>
              <tr>
                <th>订单号</th>
                <th>客户</th>
                <th>起始地</th>
                <th>目的地</th>
                <th>距离(km)</th>
                <th>货物信息</th>
                <th>预估报价</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="order in pendingOrders" :key="order.id">
                <td>{{ order.orderNumber }}</td>
                <td>{{ order.customerName }}</td>
                <td>{{ order.origin }}</td>
                <td>{{ order.destination }}</td>
                <td>{{ order.distance }}</td>
                <td>{{ order.cargoDescription }}</td>
                <td>¥{{ (order.calculatedQuote || 0).toFixed(2) }}</td>
                <td>
                  <button 
                    @click="submitQuote(order)" 
                    class="btn btn-sm btn-primary"
                    :disabled="loading"
                  >
                    提交报价
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      
      <!-- 加载遮罩层 -->
      <div v-if="loading" class="loading-overlay">
        <div class="spinner"></div>
      </div>
    </div>
  </div>

  <script src="/js/carrier-dashboard.js"></script>
  <script>
    // 检查登录状态
    function checkLoginStatus() {
      const token = localStorage.getItem('tenantToken');
      if (!token) {
        window.location.href = './login.html';
        return false;
      }
      return true;
    }

    // 退出登录
    document.getElementById('logout-btn').addEventListener('click', function(e) {
      e.preventDefault();
      localStorage.removeItem('tenantToken');
      localStorage.removeItem('userRole');
      window.location.href = './login.html';
    });

    // Vue应用
    const { createApp, ref, reactive, onMounted, computed } = Vue;

    createApp({
      setup() {
        // 当前激活的标签页
        const activeTab = ref('basic')
        
        // 基础定价配置
        const pricingConfig = reactive({
          basePrice: 10.00,
          mileageRate: 2.00,
          timeRate: 0.50,
          refrigeratedSurcharge: 5.00
        })
        
        // 时间定价配置
        const timePricing = reactive({
          peakMultiplier: 30,    // 高峰时段加价30%
          normalMultiplier: 10,  // 平峰时段加价10%
          offPeakMultiplier: -5  // 低谷时段减价5%
        })
        
        // 天气策略
        const weatherStrategies = reactive({
          rain: { enabled: false, surcharge: 10.00 },
          snow: { enabled: false, surcharge: 15.00 },
          fog: { enabled: false, surcharge: 5.00 },
          storm: { enabled: true, surcharge: 20.00 },
          extreme_heat: { enabled: false, surcharge: 8.00 },
          extreme_cold: { enabled: false, surcharge: 12.00 }
        })
        
        // 附加服务
        const additionalServices = reactive({
          loadingEnabled: true,
          loadingFee: 20.00,
          waitingEnabled: true,
          waitingFeePerHour: 30.00,
          insuranceEnabled: false,
          insuranceRate: 1.00,
          expressEnabled: false,
          expressMultiplier: 1.5
        })
        
        // 智能建议
        const suggestions = ref([
          {
            title: "提高高峰时段定价",
            description: "根据市场数据分析，高峰时段可适当提高定价至40%，以增加收益。",
            action: () => { timePricing.peakMultiplier = 40; }
          },
          {
            title: "优化冷藏服务定价",
            description: "建议将冷藏基础费用调整为12元，以匹配市场平均水平。",
            action: () => { pricingConfig.refrigeratedSurcharge = 12.00; }
          },
          {
            title: "添加加急服务选项",
            description: "开启加急服务并设置1.8倍定价，可吸引紧急订单。",
            action: () => { 
              additionalServices.expressEnabled = true;
              additionalServices.expressMultiplier = 1.8;
            }
          },
          {
            title: "降低低谷时段定价",
            description: "考虑在低谷时段提供-10%折扣，以增加订单量。",
            action: () => { timePricing.offPeakMultiplier = -10; }
          }
        ])
        
        const currentSuggestionIndex = ref(0)
        const currentSuggestion = computed(() => suggestions.value[currentSuggestionIndex.value])
        
        // 市场数据
        const marketData = reactive({
          averageQuote: 85.50,
          minQuote: 65.00,
          maxQuote: 120.00,
          competitiveness: 7
        })
        
        // 当前报价（模拟）
        const currentQuote = ref(82.30)
        
        // 计算器
        const calculator = reactive({
          basePrice: 10.00,
          distance: 10,
          overtimeCharge: false,
          weather: 'normal',
          vehicleType: 'normal',
          isExpress: false,
          additionalFee: 0
        })
        
        // 时间槽数组（每15分钟一个）
        const timeSlots = ref([])
        for (let hour = 0; hour < 24; hour++) {
          for (let minute = 0; minute < 60; minute += 15) {
            const startHour = String(hour).padStart(2, '0')
            const startMinute = String(minute).padStart(2, '0')
            const endHour = minute === 45 ? String(hour + 1).padStart(2, '0') : startHour
            const endMinute = minute === 45 ? '00' : String(minute + 15).padStart(2, '0')
            timeSlots.value.push(`${startHour}:${startMinute}-${endHour}:${endMinute}`)
          }
        }
        
        // 选择的时间段
        const selectedTimeSlot = ref('')
        const selectedTimeSlots = ref([])
        const showTable = ref(true)
        
        // 平台标准定价
        const standardPricing = reactive({
          basePrice: 10.00,
          distance: 2.00,
          overtimeCharge: false,
          weather: 'normal',
          vehicleType: 'normal',
          isExpress: false,
          additionalFee: 0,
          total: 0
        })
        
        // 初始化每个小时的报价
        timeSlots.value.forEach(timeSlot => {
          // 这里不再初始化所有时间段，而是按需添加
        })
        
        // 计算结果
        const calculatedQuote = ref(0)
        const quoteBreakdown = reactive({
          baseFee: 0,
          distanceFee: 0,
          durationFee: 0,
          overtimeSurcharge: 0,
          vehicleSurcharge: 0,
          weatherSurcharge: 0,
          expressSurcharge: 0,
          additionalFee: 0,
          timeMultiplier: 1
        })
        
        // 待报价订单
        const pendingOrders = ref([
          {
            id: 1,
            orderNumber: 'ORD20231101001',
            customerName: '张三',
            origin: '北京市朝阳区',
            destination: '上海市浦东新区',
            distance: 1200,
            cargoDescription: '电子产品',
            calculatedQuote: 0
          },
          {
            id: 2,
            orderNumber: 'ORD20231101002',
            customerName: '李四',
            origin: '广州市天河区',
            destination: '深圳市南山区',
            distance: 150,
            cargoDescription: '服装',
            calculatedQuote: 0
          },
          {
            id: 3,
            orderNumber: 'ORD20231101003',
            customerName: '王五',
            origin: '杭州市西湖区',
            destination: '南京市鼓楼区',
            distance: 300,
            cargoDescription: '食品',
            calculatedQuote: 0
          }
        ])
        
        // 加载状态
        const loading = ref(false)
        
        // 更新配置
        const updateConfig = () => {
          console.log('配置已更新:', {
            pricingConfig,
            timePricing,
            weatherStrategies,
            additionalServices
          })
          // 重新计算所有待报价订单
          recalculatePendingOrders()
        }
        
        // 切换天气策略启用状态
        const toggleWeatherStrategy = (weatherType) => {
          weatherStrategies[weatherType].enabled = !weatherStrategies[weatherType].enabled
          updateConfig()
        }
        
        // 更新天气附加费
        const updateWeatherSurcharge = (weatherType, value) => {
          weatherStrategies[weatherType].surcharge = parseFloat(value) || 0
          updateConfig()
        }
        
        // 获取天气标签
        const getWeatherLabel = (weatherType) => {
          const labels = {
            rain: '雨天',
            snow: '雪天',
            fog: '雾天',
            storm: '风暴',
            extreme_heat: '高温',
            extreme_cold: '严寒'
          }
          return labels[weatherType] || weatherType
        }
        
        // 计算报价
        const calculateQuote = () => {
          // 更新已选时间段的报价
          selectedTimeSlots.value.forEach((slot, index) => {
            const breakdown = calculateQuoteForTimeSlotWithParams(slot.timeSlot, slot.params)
            selectedTimeSlots.value[index].quote = breakdown.total
            selectedTimeSlots.value[index].breakdown = breakdown
          })

          // 计算标准价格
          calculateStandardPricing()

          // 更新当前选择时间段的报价到主显示（如果有已选时间段）
          if (selectedTimeSlots.value.length > 0) {
            calculatedQuote.value = selectedTimeSlots.value[0].quote
          } else {
            // 如果没有已选时间段，计算一个默认时间段的报价
            const breakdown = calculateQuoteForTimeSlotWithParams('08:00-08:15', calculator)
            calculatedQuote.value = breakdown.total
          }
        }
        
        // 计算标准价格
        const calculateStandardPricing = () => {
          // 使用默认参数计算标准价格
          const defaultParams = {
            basePrice: pricingConfig.basePrice,
            distance: 10, // 默认10公里
            overtimeCharge: false,
            weather: 'normal',
            vehicleType: 'normal',
            isExpress: false,
            additionalFee: 0
          }
          
          const breakdown = calculateQuoteForTimeSlotWithParams('08:00-08:15', defaultParams)
          
          // 更新标准定价数据
          standardPricing.basePrice = pricingConfig.basePrice
          standardPricing.distance = pricingConfig.mileageRate
          standardPricing.overtimeCharge = false
          standardPricing.weather = 'normal'
          standardPricing.vehicleType = 'normal'
          standardPricing.isExpress = false
          standardPricing.additionalFee = 0
          standardPricing.total = breakdown.total
        }
        
        // 添加时间段
        const addTimeSlot = () => {
          console.log('addTimeSlot called, selectedTimeSlot.value:', selectedTimeSlot.value);
          console.log('selectedTimeSlot type:', typeof selectedTimeSlot.value);
          console.log('selectedTimeSlot length:', selectedTimeSlot.value.length);

          if (!selectedTimeSlot.value) {
            alert('请选择一个时间段');
            return;
          }

          // 检查是否已存在
          if (timeSlotExists(selectedTimeSlot.value)) {
            alert('该时间段已添加')
            return
          }

          // 创建新的时间段条目，包含参数和报价
          const newSlot = {
            timeSlot: selectedTimeSlot.value,
            params: {
              basePrice: calculator.basePrice,
              distance: calculator.distance,
              overtimeCharge: calculator.overtimeCharge,
              weather: calculator.weather,
              vehicleType: calculator.vehicleType,
              isExpress: calculator.isExpress,
              additionalFee: calculator.additionalFee
            },
            quote: 0,
            breakdown: {},
            isActive: false, // 默认不激活
            originalParams: {} // 用于存储原始参数
          }

          // 计算该时间段的报价
          const breakdown = calculateQuoteForTimeSlotWithParams(selectedTimeSlot.value, newSlot.params)
          newSlot.quote = breakdown.total
          newSlot.breakdown = breakdown

          // 添加到已选时间段列表
          selectedTimeSlots.value.push(newSlot)
          console.log('New time slot added, total count:', selectedTimeSlots.value.length);

          // 清空选择
          selectedTimeSlot.value = ''
          
          // 重新计算所有待报价订单，因为添加了新的时间段
          recalculatePendingOrders()
        }
        
        // 检查时间段是否已存在
        const timeSlotExists = (timeSlot) => {
          return selectedTimeSlots.value.some(slot => slot.timeSlot === timeSlot)
        }
        
        // 删除时间段
        const removeTimeSlot = (timeSlot) => {
          const index = selectedTimeSlots.value.findIndex(slot => slot.timeSlot === timeSlot)
          if (index !== -1) {
            selectedTimeSlots.value.splice(index, 1)
          }
        }
        
        // 为特定时间段计算报价
        const calculateQuoteForTimeSlot = (timeSlot) => {
          let baseFee = calculator.basePrice || pricingConfig.basePrice
          let distanceFee = calculator.distance * pricingConfig.mileageRate
          
          // 时长费用（使用距离估算时长，例如每公里5分钟）
          let duration = calculator.distance * 5 // 估算时长（分钟）
          let durationFee = duration * pricingConfig.timeRate
          
          // 超时附加费
          let overtimeSurcharge = 0
          if (calculator.overtimeCharge === 'true' || calculator.overtimeCharge === true) {
            // 偶定超过15分钟后每分钟加收0.5元
            let extraMinutes = Math.max(0, duration - 15)
            overtimeSurcharge = extraMinutes * 0.5
          }
          
          // 车型附加费（冷藏车）
          let vehicleSurcharge = 0
          if (calculator.vehicleType === 'refrigerated') {
            vehicleSurcharge = pricingConfig.refrigeratedSurcharge
          }
          
          // 天气附加费
          let weatherSurcharge = 0
          if (calculator.weather !== 'normal' && weatherStrategies[calculator.weather]?.enabled) {
            weatherSurcharge = weatherStrategies[calculator.weather].surcharge
          }
          
          // 加急附加费
          let expressSurcharge = 0
          if (calculator.isExpress && additionalServices.expressEnabled) {
            expressSurcharge = baseFee * (additionalServices.expressMultiplier - 1)
          }
          
          // 时间段影响（根据时间段设置不同的倍数）
          let timeMultiplier = 1
          const startHour = parseInt(timeSlot.split(':')[0])
          
          // 根据时间段设置不同的倍数
          if ((startHour >= 7 && startHour < 9) || (startHour >= 17 && startHour < 19)) {
            // 高峰时段
            timeMultiplier = 1 + (timePricing.peakMultiplier / 100)
          } else if (startHour >= 9 && startHour < 17) {
            // 平峰时段
            timeMultiplier = 1 + (timePricing.normalMultiplier / 100)
          } else {
            // 低谷时段
            timeMultiplier = 1 + (timePricing.offPeakMultiplier / 100)
          }
          
          // 附加费
          let additionalFee = calculator.additionalFee || 0
          
          // 总计
          let total = (baseFee + distanceFee + durationFee + vehicleSurcharge + weatherSurcharge + expressSurcharge + overtimeSurcharge + additionalFee) * timeMultiplier
          
          return {
            baseFee,
            distanceFee,
            durationFee,
            overtimeSurcharge,
            vehicleSurcharge,
            weatherSurcharge,
            expressSurcharge,
            additionalFee,
            total
          }
        }
        
        // 为特定时间段和参数计算报价
        const calculateQuoteForTimeSlotWithParams = (timeSlot, params) => {
          let baseFee = params.basePrice || pricingConfig.basePrice
          let distanceFee = params.distance * pricingConfig.mileageRate
          
          // 时长费用（使用距离估算时长，例如每公里5分钟）
          let duration = params.distance * 5 // 估算时长（分钟）
          let durationFee = duration * pricingConfig.timeRate
          
          // 超时附加费
          let overtimeSurcharge = 0
          if (params.overtimeCharge === 'true' || params.overtimeCharge === true) {
            // 偶定超过15分钟后每分钟加收0.5元
            let extraMinutes = Math.max(0, duration - 15)
            overtimeSurcharge = extraMinutes * 0.5
          }
          
          // 车型附加费（冷藏车）
          let vehicleSurcharge = 0
          if (params.vehicleType === 'refrigerated') {
            vehicleSurcharge = pricingConfig.refrigeratedSurcharge
          }
          
          // 天气附加费
          let weatherSurcharge = 0
          if (params.weather !== 'normal' && weatherStrategies[params.weather]?.enabled) {
            weatherSurcharge = weatherStrategies[params.weather].surcharge
          }
          
          // 加急附加费
          let expressSurcharge = 0
          if (params.isExpress && additionalServices.expressEnabled) {
            expressSurcharge = baseFee * (additionalServices.expressMultiplier - 1)
          }
          
          // 时间段影响（根据时间段设置不同的倍数）
          let timeMultiplier = 1
          const startHour = parseInt(timeSlot.split(':')[0])
          
          // 根据时间段设置不同的倍数
          if ((startHour >= 7 && startHour < 9) || (startHour >= 17 && startHour < 19)) {
            // 高峰时段
            timeMultiplier = 1 + (timePricing.peakMultiplier / 100)
          } else if (startHour >= 9 && startHour < 17) {
            // 平峰时段
            timeMultiplier = 1 + (timePricing.normalMultiplier / 100)
          } else {
            // 低谷时段
            timeMultiplier = 1 + (timePricing.offPeakMultiplier / 100)
          }
          
          // 附加费
          let additionalFee = params.additionalFee || 0
          
          // 总计
          let total = (baseFee + distanceFee + durationFee + vehicleSurcharge + weatherSurcharge + expressSurcharge + overtimeSurcharge + additionalFee) * timeMultiplier
          
          return {
            baseFee,
            distanceFee,
            durationFee,
            overtimeSurcharge,
            vehicleSurcharge,
            weatherSurcharge,
            expressSurcharge,
            additionalFee,
            total
          }
        }
        
        // 更新时间段报价
        const updateSlotQuote = (slot) => {
          const breakdown = calculateQuoteForTimeSlotWithParams(slot.timeSlot, slot.params)
          slot.quote = breakdown.total
          slot.breakdown = breakdown
        }
        
        // 获取特定时间段的标准价格
        const getStandardPriceForTimeSlot = (timeSlot) => {
          // 根据时间段设置不同的标准价格
          const startHour = parseInt(timeSlot.split(':')[0])
          let timeMultiplier = 1

          // 根据时间段设置不同的倍数
          if ((startHour >= 7 && startHour < 9) || (startHour >= 17 && startHour < 19)) {
            // 高峰时段
            timeMultiplier = 1 + (timePricing.peakMultiplier / 100)
          } else if (startHour >= 9 && startHour < 17) {
            // 平峰时段
            timeMultiplier = 1 + (timePricing.normalMultiplier / 100)
          } else {
            // 低谷时段
            timeMultiplier = 1 + (timePricing.offPeakMultiplier / 100)
          }

          // 计算标准价格
          const basePrice = pricingConfig.basePrice
          const distanceRate = pricingConfig.mileageRate
          const distance = 10 // 默认10公里
          const distanceFee = distance * distanceRate
          const duration = distance * 5 // 估算时长（分钟）
          const durationFee = duration * pricingConfig.timeRate
          const vehicleSurcharge = pricingConfig.refrigeratedSurcharge // 冷藏附加费
          const weatherSurcharge = 0 // 默认天气附加费
          const overtimeSurcharge = 0 // 默认超时附加费
          const expressSurcharge = 0 // 默认加急附加费
          const additionalFee = 0 // 默认附加费

          // 总计
          const total = (basePrice + distanceFee + durationFee + vehicleSurcharge + weatherSurcharge + overtimeSurcharge + expressSurcharge + additionalFee) * timeMultiplier

          return {
            basePrice,
            distanceRate,
            distanceFee,
            durationFee,
            vehicleSurcharge,
            weatherSurcharge,
            overtimeSurcharge,
            expressSurcharge,
            additionalFee,
            total
          }
        }
        
        // 激活时间段（生效）
        const activateSlot = async (slot) => {
          // 检查是否有正在执行的订单
          const hasActiveOrders = await checkActiveOrdersForTimeSlot(slot.timeSlot);
          
          if (hasActiveOrders) {
            const confirmChange = confirm(`该时间段有正在执行的订单，确认后将影响新订单使用此价格，是否继续？`);
            if (!confirmChange) return;
          }
          
          // 激活时间段
          slot.isActive = true;
          slot.originalParams = { ...slot.params }; // 保存原始参数
          
          // 更新UI状态
          console.log(`时间段 ${slot.timeSlot} 已生效`);
          alert(`时间段 ${slot.timeSlot} 已生效，价格已锁定`);
        }
        
        // 取消激活时间段（修改）
        const deactivateSlot = async (slot) => {
          // 检查是否有正在执行的订单
          const hasActiveOrders = await checkActiveOrdersForTimeSlot(slot.timeSlot);
          
          if (hasActiveOrders) {
            const confirmChange = confirm(`该时间段有正在执行的订单，修改后仅对新订单生效，是否继续？`);
            if (!confirmChange) return;
          }
          
          // 取消激活时间段
          slot.isActive = false;
          
          // 更新UI状态
          console.log(`时间段 ${slot.timeSlot} 已进入修改状态`);
          alert(`时间段 ${slot.timeSlot} 已进入修改状态`);
        }
        
        // 检查时间段是否有正在执行的订单
        const checkActiveOrdersForTimeSlot = async (timeSlot) => {
          // 这里模拟检查逻辑，实际应用中应调用后端API
          // 模拟返回false表示没有活跃订单
          return false;
        }
        
        // 切叠/展开表格
        const toggleTable = () => {
          showTable.value = !showTable.value
        }
        
        // 获取报价等级的CSS类
        const getQuoteClass = (quote) => {
          if (quote < 50) return 'quote-low'
          if (quote < 100) return 'quote-medium'
          return 'quote-high'
        }
        
        // 重新计算待报价订单
        const recalculatePendingOrders = () => {
          // 保存当前计算器的参数
          const originalDistance = calculator.distance;
          const originalOvertimeCharge = calculator.overtimeCharge;
          const originalWeather = calculator.weather;
          const originalTimeSlot = calculator.timeSlot; // 保存用户选择的时间段
          const originalIsExpress = calculator.isExpress;
          const originalBasePrice = calculator.basePrice;
          const originalAdditionalFee = calculator.additionalFee;
          const originalVehicleType = calculator.vehicleType;

          pendingOrders.value.forEach(order => {
            if (!order) return; // 确保订单存在
            
            // 使用订单的具体参数来计算报价
            // 这里简化处理，实际应用中需要根据每个订单的具体信息来计算
            calculator.basePrice = originalBasePrice;
            calculator.distance = order.distance;
            calculator.overtimeCharge = originalOvertimeCharge;
            calculator.weather = originalWeather;
            calculator.vehicleType = originalVehicleType;
            calculator.isExpress = originalIsExpress;
            calculator.additionalFee = originalAdditionalFee;
            // 使用用户在计算器中选择的时间段
            calculator.timeSlot = originalTimeSlot;

            // 重新计算报价
            calculateQuote();
            order.calculatedQuote = calculatedQuote.value || 0; // 确保值存在
          });

          // 恢复原始计算器参数
          calculator.distance = originalDistance;
          calculator.overtimeCharge = originalOvertimeCharge;
          calculator.weather = originalWeather;
          calculator.timeSlot = originalTimeSlot;
          calculator.isExpress = originalIsExpress;
          calculator.basePrice = originalBasePrice;
          calculator.additionalFee = originalAdditionalFee;
          calculator.vehicleType = originalVehicleType;
        }
        
        // 应用智能建议
        const applySuggestion = (suggestion) => {
          suggestion.action()
          nextSuggestion()
          updateConfig()
        }
        
        // 下一个建议
        const nextSuggestion = () => {
          currentSuggestionIndex.value = (currentSuggestionIndex.value + 1) % suggestions.value.length
        }
        
        // 保存配置到后端
        const saveConfig = async () => {
          try {
            loading.value = true
            
            // 构造完整的配置对象
            const configData = {
              pricingConfig,
              timePricing,
              weatherStrategies,
              additionalServices
            }
            
            // 模拟API调用
            console.log('保存配置到服务器:', configData)
            
            // 这里应该调用实际的API
            // const response = await fetch('/api/carrier/pricing-configs', {
            //   method: 'PUT',
            //   headers: {
            //     'Content-Type': 'application/json',
            //     'Authorization': `Bearer ${localStorage.getItem('tenantToken')}`
            //   },
            //   body: JSON.stringify(configData)
            // });
            
            // if (response.ok) {
            //   const result = await response.json();
            //   console.log('承运商配置保存成功:', result);
            //   alert('报价配置保存成功！');
            // } else {
            //   throw new Error('保存失败');
            // }
            
            // 模拟成功
            await new Promise(resolve => setTimeout(resolve, 500));
            alert('报价配置保存成功！')
          } catch (error) {
            console.error('保存承运商配置失败:', error)
            alert(`保存失败: ${error.message || '未知错误'}`)
          } finally {
            loading.value = false
          }
        }
        
        // 重置配置
        const resetConfig = () => {
          if (confirm('确定要重置所有配置吗？')) {
            // 重置基础定价
            pricingConfig.basePrice = 10.00
            pricingConfig.mileageRate = 2.00
            pricingConfig.timeRate = 0.50
            pricingConfig.refrigeratedSurcharge = 5.00
            
            // 重置时间定价
            timePricing.peakMultiplier = 30
            timePricing.normalMultiplier = 10
            timePricing.offPeakMultiplier = -5
            
            // 重置天气策略
            weatherStrategies.rain.enabled = false
            weatherStrategies.rain.surcharge = 10.00
            weatherStrategies.snow.enabled = false
            weatherStrategies.snow.surcharge = 15.00
            weatherStrategies.fog.enabled = false
            weatherStrategies.fog.surcharge = 5.00
            weatherStrategies.storm.enabled = true
            weatherStrategies.storm.surcharge = 20.00
            weatherStrategies.extreme_heat.enabled = false
            weatherStrategies.extreme_heat.surcharge = 8.00
            weatherStrategies.extreme_cold.enabled = false
            weatherStrategies.extreme_cold.surcharge = 12.00
            
            // 重置附加服务
            additionalServices.loadingEnabled = true
            additionalServices.loadingFee = 20.00
            additionalServices.waitingEnabled = true
            additionalServices.waitingFeePerHour = 30.00
            additionalServices.insuranceEnabled = false
            additionalServices.insuranceRate = 1.00
            additionalServices.expressEnabled = false
            additionalServices.expressMultiplier = 1.5
            
            // 重新计算
            updateConfig()
          }
        }
        
        // 提交报价
        const submitQuote = (order) => {
          console.log(`提交订单 ${order.orderNumber} 的报价: ¥${order.calculatedQuote.toFixed(2)}`)
          // 这里应该调用API提交报价
          alert(`已提交订单 ${order.orderNumber} 的报价: ¥${order.calculatedQuote.toFixed(2)}`)
        }
        
        // 组件挂载时加载现有配置
        onMounted(async () => {
          try {
            loading.value = true

            // 模拟从后端API加载现有配置
            // const response = await fetch('/api/carrier/pricing-configs', {
            //   headers: {
            //     'Authorization': `Bearer ${localStorage.getItem('tenantToken')}`
            //   }
            // });

            // if (response.ok) {
            //   const data = await response.json();
            //   // 这里可以根据实际API返回的数据结构来更新配置
            //   console.log('承运商配置加载完成:', data);
            // }

            // 模拟加载成功
            await new Promise(resolve => setTimeout(resolve, 300));

            // 初始化报价计算
            calculateQuote()
            calculateStandardPricing() // 确保标准价格也被计算
            recalculatePendingOrders()

            console.log('报价管理配置加载完成')
          } catch (error) {
            console.error('加载报价管理配置失败:', error)
            // 如果加载失败，使用默认值并提示用户
            alert(`加载配置失败: ${error.message || '使用默认配置'}`)
          } finally {
            loading.value = false
          }
        })
        
        return {
          activeTab,
          pricingConfig,
          timePricing,
          weatherStrategies,
          additionalServices,
          suggestions,
          currentSuggestionIndex,
          currentSuggestion,
          marketData,
          currentQuote,
          calculator,
          calculatedQuote,
          quoteBreakdown,
          timeSlots,
          selectedTimeSlot,
          selectedTimeSlots,
          showTable,
          standardPricing,
          addTimeSlot,
          removeTimeSlot,
          timeSlotExists,
          toggleTable,
          updateSlotQuote,
          calculateStandardPricing,
          getStandardPriceForTimeSlot,
          activateSlot,
          deactivateSlot,
          checkActiveOrdersForTimeSlot,
          getQuoteClass,
          pendingOrders,
          loading,
          updateConfig,
          toggleWeatherStrategy,
          updateWeatherSurcharge,
          getWeatherLabel,
          calculateQuote,
          recalculatePendingOrders,
          applySuggestion,
          nextSuggestion,
          saveConfig,
          resetConfig,
          submitQuote
        }
      }
    }).mount('#app');

    // 二级导航菜单交互
    document.querySelectorAll('.submenu-toggle').forEach(toggle => {
      toggle.addEventListener('click', function(e) {
        e.preventDefault();
        const parentLi = this.closest('.has-submenu');
        if (parentLi) {
          parentLi.classList.toggle('open');
        }
      });
    });
  </script>
</body>
</html>