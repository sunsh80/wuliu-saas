<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åœé ç‚¹ä¸Šä¼  - ç§Ÿæˆ·ç«¯</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Microsoft YaHei', Arial, sans-serif; background: #f5f5f5; }

    .header {
      background: linear-gradient(135deg, #722ed1 0%, #531dab 100%);
      color: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header h1 { font-size: 20px; }
    .header-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }
    .header-btn:hover { background: rgba(255,255,255,0.3); }

    .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; }

    .notice-card {
      background: #fffbe6;
      border: 1px solid #ffe58f;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 24px;
    }
    .notice-card h4 { color: #b7791f; margin-bottom: 10px; font-size: 16px; }
    .notice-card ul { margin-left: 20px; color: #666; line-height: 1.8; }
    .notice-card li { margin: 4px 0; }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.07);
    }
    .stat-card h3 { font-size: 14px; color: #666; margin-bottom: 10px; }
    .stat-card .num { font-size: 28px; font-weight: bold; color: #722ed1; }
    .stat-card.pending .num { color: #faad14; }
    .stat-card.approved .num { color: #52c41a; }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.07);
      padding: 24px;
      margin-bottom: 24px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .card-title { font-size: 18px; font-weight: bold; color: #333; }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
    }
    .btn-primary { background: #722ed1; color: white; }
    .btn-primary:hover { background: #9254de; transform: translateY(-1px); }
    .btn-success { background: #52c41a; color: white; }
    .btn-success:hover { background: #73d13d; }
    .btn-danger { background: #ff4d4f; color: white; }
    .btn-danger:hover { background: #ff7875; }
    .btn-secondary { background: #f0f0f0; color: #333; }
    .btn-secondary:hover { background: #d9d9d9; }
    .btn-sm { padding: 6px 12px; font-size: 13px; }

    .btn-group { display: flex; gap: 8px; }

    .filter-row {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .filter-row input, .filter-row select {
      padding: 10px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      font-size: 14px;
    }
    .filter-row input { min-width: 200px; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 14px 12px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    th { background: #fafafa; font-weight: 600; color: #333; font-size: 14px; }
    tr:hover { background: #f5f5f5; }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .status-pending { background: #fffbe6; color: #faad14; border: 1px solid #ffe58f; }
    .status-approved { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
    .status-rejected { background: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e; }

    .deletable-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      background: #fff7e6;
      color: #fa8c16;
      border: 1px solid #ffd591;
    }
    .deletable-badge.disabled {
      background: #f5f5f5;
      color: #999;
      border-color: #d9d9d9;
    }

    .type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      background: #f0f0f0;
      color: #666;
    }

    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    .pagination-info { color: #666; font-size: 14px; }
    .pagination-btns { display: flex; gap: 8px; }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }
    .modal.show { display: flex; justify-content: center; align-items: center; }
    .modal-content {
      background: white;
      border-radius: 12px;
      width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h3 { font-size: 18px; color: #333; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
    .modal-close:hover { color: #333; }
    .modal-body { padding: 20px; }
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .form-item { margin-bottom: 16px; }
    .form-item label { display: block; margin-bottom: 6px; font-weight: 500; color: #333; }
    .form-item input, .form-item select, .form-item textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 6px;
      font-size: 14px;
    }
    .form-item input:focus, .form-item select:focus, .form-item textarea:focus {
      outline: none;
      border-color: #722ed1;
      box-shadow: 0 0 0 2px rgba(114,46,209,0.1);
    }
    .form-item textarea { resize: vertical; min-height: 80px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .help-text { font-size: 12px; color: #999; margin-top: 4px; }
    .reject-reason { color: #ff4d4f; font-size: 13px; margin-top: 6px; background: #fff1f0; padding: 8px; border-radius: 4px; }

    .loading { text-align: center; padding: 40px; color: #999; }
    .error { color: #ff4d4f; padding: 12px; background: #fff1f0; border-radius: 6px; margin: 10px 0; }
    .success { color: #52c41a; padding: 12px; background: #f6ffed; border-radius: 6px; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ“ åœé ç‚¹ä¸Šä¼ ä¸ç®¡ç†</h1>
    <div>
      <button class="header-btn" onclick="location.href='/carrier-dashboard.html'">è¿”å›ä»ªè¡¨æ¿</button>
      <button class="header-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
    </div>
  </div>
  
  <div class="container">
    <!-- æ³¨æ„äº‹é¡¹ -->
    <div class="notice-card">
      <h4>ğŸ“Œ æ³¨æ„äº‹é¡¹</h4>
      <ul>
        <li>ä¸Šä¼ çš„åœé ç‚¹éœ€è¦<strong>ç®¡ç†å‘˜å®¡æ‰¹é€šè¿‡</strong>åæ‰ä¼šæ˜¾ç¤ºåœ¨å…¬å…±åˆ—è¡¨ä¸­</li>
        <li>ä¸Šä¼ å <strong>3 å¤©å†…</strong> å¯ä»¥åˆ é™¤æˆ–ä¿®æ”¹ï¼Œè¶…è¿‡ 3 å¤©å°†æ— æ³•åˆ é™¤ï¼ˆé˜²æ­¢æ¶æ„æ‰¹é‡åˆ é™¤ï¼‰</li>
        <li>å·²é€šè¿‡å®¡æ‰¹çš„åœé ç‚¹<strong>ä¸å¯åˆ é™¤</strong>ï¼Œä½†å¯è”ç³»ç®¡ç†å‘˜å¤„ç†</li>
        <li>å•æ¬¡æ‰¹é‡ä¸Šä¼ æœ€å¤š <strong>100 æ¡</strong> æ•°æ®</li>
      </ul>
    </div>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-row">
      <div class="stat-card">
        <h3>æˆ‘çš„åœé ç‚¹æ€»æ•°</h3>
        <div class="num" id="statTotal">-</div>
      </div>
      <div class="stat-card pending">
        <h3>å¾…å®¡æ‰¹</h3>
        <div class="num" id="statPending">-</div>
      </div>
      <div class="stat-card approved">
        <h3>å·²é€šè¿‡</h3>
        <div class="num" id="statApproved">-</div>
      </div>
    </div>
    
    <!-- ä¸Šä¼ è¡¨å• -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ä¸Šä¼ åœé ç‚¹</div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="showUploadModal()">å•ä¸ªä¸Šä¼ </button>
          <button class="btn btn-secondary" onclick="showBatchUploadModal()">æ‰¹é‡ä¸Šä¼ </button>
        </div>
      </div>
    </div>
    
    <!-- æˆ‘çš„åœé ç‚¹åˆ—è¡¨ -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">æˆ‘çš„åœé ç‚¹</div>
      </div>
      <div class="filter-row">
        <input type="text" id="search" placeholder="æœç´¢åç§°/åœ°å€">
        <select id="approvalFilter">
          <option value="">å…¨éƒ¨å®¡æ‰¹çŠ¶æ€</option>
          <option value="pending">å¾…å®¡æ‰¹</option>
          <option value="approved">å·²é€šè¿‡</option>
          <option value="rejected">å·²é©³å›</option>
        </select>
        <button class="btn btn-primary" onclick="loadMyStopPoints()">æœç´¢</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>åç§°</th>
            <th>åœ°å€</th>
            <th>ç±»å‹</th>
            <th>åŒºåŸŸ</th>
            <th>åæ ‡</th>
            <th>å®¡æ‰¹çŠ¶æ€</th>
            <th>ä¸Šä¼ æ—¶é—´</th>
            <th>å¯åˆ é™¤</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="myList"></tbody>
      </table>
      <div class="pagination">
        <div class="pagination-info" id="paginationInfo"></div>
        <div class="pagination-btns">
          <button class="btn btn-secondary" onclick="prevPage()">ä¸Šä¸€é¡µ</button>
          <button class="btn btn-secondary" onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- å•ä¸ªä¸Šä¼ å¼¹çª— -->
  <div class="modal" id="uploadModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ä¸Šä¼ åœé ç‚¹</h3>
        <button class="modal-close" onclick="closeUploadModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-item">
            <label>åç§° *</label>
            <input type="text" id="formName" required>
          </div>
          <div class="form-item">
            <label>ç±»å‹</label>
            <select id="formType">
              <option value="other">å…¶ä»–</option>
              <option value="residential">ä½å®…åŒº</option>
              <option value="commercial">å•†ä¸šåŒº</option>
              <option value="industrial">å·¥ä¸šåŒº</option>
            </select>
          </div>
        </div>
        <div class="form-item">
          <label>åœ°å€ *</label>
          <input type="text" id="formAddress" required>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>çº¬åº¦ *</label>
            <input type="number" step="0.000001" id="formLat" required>
            <div class="help-text">èŒƒå›´ï¼š-90 åˆ° 90</div>
          </div>
          <div class="form-item">
            <label>ç»åº¦ *</label>
            <input type="number" step="0.000001" id="formLng" required>
            <div class="help-text">èŒƒå›´ï¼š-180 åˆ° 180</div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>åŒºåŸŸ</label>
            <input type="text" id="formRegion">
          </div>
          <div class="form-item">
            <label>å®¹é‡</label>
            <input type="number" id="formCapacity" value="1">
          </div>
        </div>
        <div class="form-item">
          <label>æè¿°</label>
          <textarea id="formDescription" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeUploadModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="submitUpload()">ä¸Šä¼ </button>
      </div>
    </div>
  </div>
  
  <!-- æ‰¹é‡ä¸Šä¼ å¼¹çª— -->
  <div class="modal" id="batchUploadModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æ‰¹é‡ä¸Šä¼ åœé ç‚¹</h3>
        <button class="modal-close" onclick="closeBatchUploadModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-item">
          <label>JSON æ•°æ®</label>
          <textarea id="batchData" rows="15" placeholder='[{"name":"ç«™ç‚¹ 1","address":"åœ°å€ 1","lat":39.9,"lng":116.4,"type":"commercial","region":"åŒ—äº¬","capacity":10,"description":"æè¿°"}]'></textarea>
          <div class="help-text">æ ¼å¼ï¼šJSON æ•°ç»„ï¼Œå¿…å¡«å­—æ®µï¼šname, address, lat, lng</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBatchUploadModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="submitBatchUpload()">ä¸Šä¼ </button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3000/api';
    let currentPage = 1;
    let currentLimit = 20;
    let myStats = { total: 0, pending: 0, approved: 0 };
    let editingId = null;

    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    const tenantToken = localStorage.getItem('tenantToken');
    if (!tenantToken) {
      window.location.href = '/carrier-login.html';
    }

    async function fetchApi(url, options = {}) {
      const res = await fetch(url, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          ...options.headers
        }
      });
      return res.json();
    }

    async function loadMyStats() {
      try {
        const [allRes, pendingRes, approvedRes] = await Promise.all([
          fetchApi(`${API_BASE}/tenant/stop-points?page=1&limit=1`),
          fetchApi(`${API_BASE}/tenant/stop-points?approvalStatus=pending&limit=1`),
          fetchApi(`${API_BASE}/tenant/stop-points?approvalStatus=approved&limit=1`)
        ]);

        if (allRes.success) {
          myStats.total = allRes.data.pagination?.total || 0;
          document.getElementById('statTotal').textContent = myStats.total;
        }
        if (pendingRes.success) {
          myStats.pending = pendingRes.data.pagination?.total || 0;
          document.getElementById('statPending').textContent = myStats.pending;
        }
        if (approvedRes.success) {
          myStats.approved = approvedRes.data.pagination?.total || 0;
          document.getElementById('statApproved').textContent = myStats.approved;
        }
      } catch (err) {
        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', err);
      }
    }

    async function loadMyStopPoints() {
      const search = document.getElementById('search').value;
      const approvalStatus = document.getElementById('approvalFilter').value;
      
      const params = new URLSearchParams({
        page: currentPage,
        limit: currentLimit,
        ...(search && { search }),
        ...(approvalStatus && { approvalStatus })
      });

      try {
        const res = await fetchApi(`${API_BASE}/tenant/stop-points?${params}`);
        const container = document.getElementById('myList');
        
        if (res.success && res.data.list.length > 0) {
          container.innerHTML = res.data.list.map(sp => {
            const deletableInfo = sp.deletable 
              ? '<span class="deletable-badge">å¯åˆ é™¤</span>' 
              : '<span class="deletable-badge disabled">ä¸å¯åˆ é™¤</span>';
            const rejectReason = sp.rejection_reason 
              ? `<div class="reject-reason">é©³å›åŸå› ï¼š${sp.rejection_reason}</div>` 
              : '';
            
            return `
              <tr>
                <td>${sp.id}</td>
                <td>${sp.name}</td>
                <td>${sp.address}</td>
                <td><span class="type-badge">${sp.type || 'å…¶ä»–'}</span></td>
                <td>${sp.region || '-'}</td>
                <td>${sp.lat.toFixed(4)}, ${sp.lng.toFixed(4)}</td>
                <td>
                  <span class="status-badge ${sp.approval_status === 'approved' ? 'status-approved' : sp.approval_status === 'rejected' ? 'status-rejected' : 'status-pending'}">
                    ${sp.approval_status === 'approved' ? 'å·²é€šè¿‡' : sp.approval_status === 'rejected' ? 'å·²é©³å›' : 'å¾…å®¡æ‰¹'}
                  </span>
                  ${rejectReason}
                </td>
                <td>${new Date(sp.created_at).toLocaleString('zh-CN')}</td>
                <td>${deletableInfo}</td>
                <td>
                  <div class="btn-group">
                    ${sp.approval_status === 'pending' ? `<button class="btn btn-secondary btn-sm" onclick="editStopPoint(${sp.id})">ç¼–è¾‘</button>` : ''}
                    ${sp.deletable ? `<button class="btn btn-danger btn-sm" onclick="deleteStopPoint(${sp.id})">åˆ é™¤</button>` : ''}
                  </div>
                </td>
              </tr>
            `;
          }).join('');
          
          document.getElementById('paginationInfo').textContent = 
            `ç¬¬ ${res.data.pagination.page} é¡µï¼Œå…± ${res.data.pagination.totalPages} é¡µï¼Œæ€»è®¡ ${res.data.pagination.total} æ¡`;
        } else {
          container.innerHTML = '<tr><td colspan="10" class="loading">æš‚æ— æ•°æ®</td></tr>';
        }
      } catch (err) {
        document.getElementById('myList').innerHTML = '<tr><td colspan="10" class="error">åŠ è½½å¤±è´¥</td></tr>';
      }
    }

    function showUploadModal() {
      editingId = null;
      document.getElementById('formName').value = '';
      document.getElementById('formAddress').value = '';
      document.getElementById('formLat').value = '';
      document.getElementById('formLng').value = '';
      document.getElementById('formType').value = 'other';
      document.getElementById('formRegion').value = '';
      document.getElementById('formCapacity').value = 1;
      document.getElementById('formDescription').value = '';
      document.getElementById('uploadModal').classList.add('show');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.remove('show');
    }

    function showBatchUploadModal() {
      document.getElementById('batchData').value = '';
      document.getElementById('batchUploadModal').classList.add('show');
    }

    function closeBatchUploadModal() {
      document.getElementById('batchUploadModal').classList.remove('show');
    }

    async function submitUpload() {
      const data = {
        name: document.getElementById('formName').value,
        address: document.getElementById('formAddress').value,
        lat: parseFloat(document.getElementById('formLat').value),
        lng: parseFloat(document.getElementById('formLng').value),
        type: document.getElementById('formType').value,
        region: document.getElementById('formRegion').value,
        capacity: parseInt(document.getElementById('formCapacity').value),
        description: document.getElementById('formDescription').value
      };

      if (!data.name || !data.address || !data.lat || !data.lng) {
        alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
        return;
      }

      if (data.lat < -90 || data.lat > 90 || data.lng < -180 || data.lng > 180) {
        alert('åæ ‡è¶…å‡ºæœ‰æ•ˆèŒƒå›´');
        return;
      }

      try {
        const url = editingId ? `${API_BASE}/tenant/stop-points/${editingId}` : `${API_BASE}/tenant/stop-points`;
        const method = editingId ? 'PUT' : 'POST';
        const res = await fetchApi(url, { method, body: JSON.stringify(data) });
        
        if (res.success) {
          alert(editingId ? 'æ›´æ–°æˆåŠŸï¼Œéœ€é‡æ–°å®¡æ‰¹' : 'ä¸Šä¼ æˆåŠŸï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ‰¹');
          closeUploadModal();
          editingId = null;
          loadMyStopPoints();
          loadMyStats();
        } else {
          alert(res.message || 'æ“ä½œå¤±è´¥');
        }
      } catch (err) {
        alert('æ“ä½œå¤±è´¥');
      }
    }

    async function submitBatchUpload() {
      try {
        const stopPoints = JSON.parse(document.getElementById('batchData').value);
        if (!Array.isArray(stopPoints) || stopPoints.length === 0) {
          alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ JSON æ•°ç»„');
          return;
        }
        if (stopPoints.length > 100) {
          alert('å•æ¬¡æœ€å¤šä¸Šä¼  100 æ¡');
          return;
        }

        const res = await fetchApi(`${API_BASE}/tenant/stop-points/batch-upload`, {
          method: 'POST',
          body: JSON.stringify({ stopPoints })
        });
        
        if (res.success) {
          alert(res.message + `\næˆåŠŸï¼š${res.data.inserted.length}, å¤±è´¥ï¼š${res.data.errors.length}`);
          if (res.data.errors.length > 0) {
            console.error('å¤±è´¥è¯¦æƒ…:', res.data.errors);
          }
          closeBatchUploadModal();
          loadMyStopPoints();
          loadMyStats();
        } else {
          alert(res.message || 'ä¸Šä¼ å¤±è´¥');
        }
      } catch (err) {
        alert('JSON æ ¼å¼é”™è¯¯');
      }
    }

    async function editStopPoint(id) {
      try {
        const res = await fetchApi(`${API_BASE}/tenant/stop-points/${id}`);
        if (!res.success) {
          alert('åŠ è½½å¤±è´¥');
          return;
        }
        const sp = res.data;
        
        editingId = id;
        document.getElementById('formName').value = sp.name;
        document.getElementById('formAddress').value = sp.address;
        document.getElementById('formLat').value = sp.lat;
        document.getElementById('formLng').value = sp.lng;
        document.getElementById('formType').value = sp.type || 'other';
        document.getElementById('formRegion').value = sp.region || '';
        document.getElementById('formCapacity').value = sp.capacity || 1;
        document.getElementById('formDescription').value = sp.description || '';
        
        document.getElementById('uploadModal').classList.add('show');
      } catch (err) {
        alert('åŠ è½½å¤±è´¥');
      }
    }

    async function deleteStopPoint(id) {
      if (!confirm('ç¡®è®¤åˆ é™¤è¯¥åœé ç‚¹ï¼Ÿ\næ³¨æ„ï¼šåªæœ‰ä¸Šä¼  3 å¤©å†…ä¸”æœªå®¡æ‰¹çš„åœé ç‚¹æ‰èƒ½åˆ é™¤ã€‚')) return;
      try {
        const res = await fetchApi(`${API_BASE}/tenant/stop-points/${id}`, { method: 'DELETE' });
        if (res.success) {
          alert('åˆ é™¤æˆåŠŸ');
          loadMyStopPoints();
          loadMyStats();
        } else {
          alert(res.message || 'åˆ é™¤å¤±è´¥');
        }
      } catch (err) {
        alert('åˆ é™¤å¤±è´¥');
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        loadMyStopPoints();
      }
    }

    function nextPage() {
      currentPage++;
      loadMyStopPoints();
    }

    function logout() {
      localStorage.removeItem('tenantToken');
      window.location.href = '/carrier-login.html';
    }

    // åˆå§‹åŒ–
    loadMyStats();
    loadMyStopPoints();
  </script>
</body>
</html>
