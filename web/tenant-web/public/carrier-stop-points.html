<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœé ç‚¹ç®¡ç† - æ‰¿è¿å•†ç³»ç»Ÿ</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #f97316;
      --primary-dark: #ea580c;
      --primary-light: #fb923c;
      --sidebar-bg: #1e293b;
      --sidebar-item-hover: #334155;
      --topbar-bg: #ffffff;
      --topbar-text: #1e293b;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8fafc;
      margin: 0;
      padding: 0;
      color: #334960;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 250px;
      background-color: var(--sidebar-bg);
      color: white;
      padding: 20px 0;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      margin-top: 60px;
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .sidebar-nav::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar-nav::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
    }

    .sidebar-nav::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.6);
      border-radius: 4px;
    }

    .sidebar-nav::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.9);
    }

    .nav-item {
      padding: 12px 24px;
      color: #cbd5e1;
      text-decoration: none;
      display: block;
      transition: all 0.3s;
    }

    .nav-item:hover, .nav-item.active {
      background-color: var(--sidebar-item-hover);
      color: white;
      border-left: 4px solid var(--primary-color);
    }

    .header {
      background-color: var(--topbar-bg);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 250px;
      right: 0;
      height: 60px;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary-color);
    }

    .main-content {
      margin-left: 250px;
      margin-top: 60px;
      padding: 24px;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #1e293b;
      margin: 0;
    }

    .page-description {
      color: #64748b;
      margin-top: 4px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      text-align: center;
    }

    .stat-card i {
      font-size: 32px;
      color: var(--primary-color);
      margin-bottom: 12px;
    }

    .stat-card h3 {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }

    .stat-card .num {
      font-size: 28px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-dark), #c2410c);
      transform: translateY(-2px);
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    .filter-row {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-row input, .filter-row select {
      padding: 10px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
    }

    .filter-row input:focus, .filter-row select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 14px 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background-color: #f1f5f9;
      font-weight: 600;
      color: #334155;
      font-size: 14px;
    }

    tr:hover {
      background-color: #f8fafc;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-active { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
    .status-inactive { background: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e; }
    .status-pending { background: #fffbe6; color: #faad14; border: 1px solid #ffe58f; }
    .status-approved { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
    .status-rejected { background: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e; }

    .type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      background: #f0f0f0;
      color: #666;
    }

    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
    }

    .modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 18px;
      color: #333;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .form-item {
      margin-bottom: 16px;
    }

    .form-item label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #333;
    }

    .form-item input, .form-item select, .form-item textarea {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
    }

    .form-item input:focus, .form-item select:focus, .form-item textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .help-text {
      font-size: 12px;
      color: #999;
      margin-top: 4px;
    }

    .error {
      color: #dc2626;
      padding: 12px;
      background: #fef2f2;
      border-radius: 6px;
      margin: 10px 0;
    }

    .success {
      color: #16a34a;
      padding: 12px;
      background: #f0fdf4;
      border-radius: 6px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <!-- ä¾§è¾¹æ  -->
  <div class="sidebar">
    <div class="logo">æ‰¿è¿å•†ç³»ç»Ÿ</div>
    <nav class="sidebar-nav">
      <a href="./carrier-dashboard.html" class="nav-item"><i class="fas fa-tachometer-alt"></i> æ§åˆ¶å°</a>
      <a href="./orders.html" class="nav-item"><i class="fas fa-shipping-fast"></i> è®¢å•ç®¡ç†</a>
      <a href="./quotes.html" class="nav-item"><i class="fas fa-tags"></i> æŠ¥ä»·ç®¡ç†</a>
      <a href="./vehicles.html" class="nav-item"><i class="fas fa-truck"></i> è½¦è¾†ç®¡ç†</a>
      <a href="./applications.html" class="nav-item"><i class="fas fa-file-alt"></i> ç”³è¯·èµ„æ–™</a>
      <a href="./carrier-stop-points.html" class="nav-item active"><i class="fas fa-map-marker-alt"></i> åœé ç‚¹ç®¡ç†</a>
      <a href="./map.html" class="nav-item"><i class="fas fa-map-marked-alt"></i> åœ°å›¾æœåŠ¡</a>
      <a href="./profile.html" class="nav-item"><i class="fas fa-user"></i> ä¸ªäººèµ„æ–™</a>
      <a href="./violations.html" class="nav-item"><i class="fas fa-exclamation-triangle"></i> è¿è§„å¤„ç†</a>

      <div class="nav-item has-submenu open">
        <div class="submenu-toggle">
          <span><i class="fas fa-yen-sign"></i> è´¢åŠ¡ç®¡ç†</span>
          <i class="fas fa-chevron-down submenu-arrow"></i>
        </div>
        <ul class="submenu">
          <li><a href="./carrier-finance.html" class="nav-item">è´¢åŠ¡æ¦‚è§ˆ</a></li>
          <li><a href="./carrier-wallet.html" class="nav-item">é’±åŒ…ç®¡ç†</a></li>
          <li><a href="./carrier-commissions.html" class="nav-item">æŠ½ä½£ç®¡ç†</a></li>
          <li><a href="./carrier-settlements.html" class="nav-item">ç»“ç®—ç®¡ç†</a></li>
        </ul>
      </div>
      <a href="./settings.html" class="nav-item"><i class="fas fa-cog"></i> å†…éƒ¨è®¾ç½®</a>
      <a href="#" id="logout-btn" class="nav-item"><i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•</a>
    </nav>
  </div>

  <!-- é¡¶éƒ¨æ  -->
  <header class="header">
    <div class="logo">æ‰¿è¿å•†æ§åˆ¶å°</div>
    <div class="user-info">
      <span id="userName">æ‰¿è¿å•†</span>
      <a href="#" id="logout-btn-header" style="color: #64748b; text-decoration: none;"><i class="fas fa-sign-out-alt"></i> é€€å‡º</a>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <div class="main-content">
    <div class="page-header">
      <div>
        <h1 class="page-title">ğŸ“ åœé ç‚¹ç®¡ç†</h1>
        <p class="page-description">ç®¡ç†æ‚¨çš„åœé ç‚¹ä¿¡æ¯ï¼Œæäº¤æ–°åœé ç‚¹ç”³è¯·</p>
      </div>
      <button class="btn btn-primary" onclick="showCreateModal()">
        <i class="fas fa-plus"></i> æ–°å¢åœé ç‚¹
      </button>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-grid">
      <div class="stat-card">
        <i class="fas fa-map-marker-alt"></i>
        <h3>æ€»è®¡</h3>
        <div class="num" id="statTotal">-</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-clock"></i>
        <h3>å¾…å®¡æ‰¹</h3>
        <div class="num" id="statPending">-</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-check-circle"></i>
        <h3>å·²é€šè¿‡</h3>
        <div class="num" id="statApproved">-</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-times-circle"></i>
        <h3>å·²é©³å›</h3>
        <div class="num" id="statRejected">-</div>
      </div>
    </div>

    <!-- åœé ç‚¹åˆ—è¡¨ -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">æˆ‘çš„åœé ç‚¹</div>
      </div>
      <div class="filter-row">
        <input type="text" id="search" placeholder="æœç´¢åç§°/åœ°å€">
        <select id="typeFilter">
          <option value="">å…¨éƒ¨ç±»å‹</option>
          <option value="residential">ä½å®…åŒº</option>
          <option value="commercial">å•†ä¸šåŒº</option>
          <option value="industrial">å·¥ä¸šåŒº</option>
          <option value="other">å…¶ä»–</option>
        </select>
        <select id="approvalFilter">
          <option value="">å…¨éƒ¨å®¡æ‰¹çŠ¶æ€</option>
          <option value="pending">å¾…å®¡æ‰¹</option>
          <option value="approved">å·²é€šè¿‡</option>
          <option value="rejected">å·²é©³å›</option>
        </select>
        <button class="btn btn-primary" onclick="loadStopPoints()">æœç´¢</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>åç§°</th>
            <th>åœ°å€</th>
            <th>ç±»å‹</th>
            <th>åŒºåŸŸ</th>
            <th>åæ ‡</th>
            <th>å®¡æ‰¹çŠ¶æ€</th>
            <th>æäº¤æ—¶é—´</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="stopPointsList"></tbody>
      </table>
      <div class="pagination">
        <div class="pagination-info" id="paginationInfo"></div>
        <div class="pagination-btns">
          <button class="btn btn-primary" onclick="prevPage()">ä¸Šä¸€é¡µ</button>
          <button class="btn btn-primary" onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- æ–°å¢/ç¼–è¾‘å¼¹çª— -->
  <div class="modal" id="createModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">æ–°å¢åœé ç‚¹</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-item">
            <label>åç§° *</label>
            <input type="text" id="formName" required>
          </div>
          <div class="form-item">
            <label>ç±»å‹</label>
            <select id="formType">
              <option value="other">å…¶ä»–</option>
              <option value="residential">ä½å®…åŒº</option>
              <option value="commercial">å•†ä¸šåŒº</option>
              <option value="industrial">å·¥ä¸šåŒº</option>
            </select>
          </div>
        </div>
        <div class="form-item" style="position: relative;">
          <label>åœ°å€ *</label>
          <input type="text" id="formAddress" required placeholder="è¾“å…¥å…³é”®è¯æ¨¡ç³Šæœç´¢åœ°å€">
          <div style="margin-top: 5px;">
            <button type="button" onclick="getCoordsFromAddress()" style="padding: 4px 10px; font-size: 12px; margin-right: 5px;">æ ¹æ®åœ°å€è·å–åæ ‡</button>
            <button type="button" onclick="testApiKey()" style="padding: 4px 10px; font-size: 12px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer;">æµ‹è¯• API</button>
          </div>
          <div id="searchResults" style="display:none; position:absolute; left:0; right:0; top:100%; z-index:9999; background:white; border:1px solid #d9d9d9; border-radius:4px; max-height:250px; overflow-y:auto; box-shadow:0 2px 8px rgba(0,0,0,0.15);"></div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>çº¬åº¦ *</label>
            <input type="number" step="0.001" id="formLat" required>
            <div class="help-text">èŒƒå›´ï¼š-90 ~ 90ï¼ˆä¿ç•™ 3 ä½å°æ•°å³å¯ï¼‰</div>
          </div>
          <div class="form-item">
            <label>ç»åº¦ *</label>
            <input type="number" step="0.001" id="formLng" required>
            <div class="help-text">èŒƒå›´ï¼š-180 ~ 180ï¼ˆä¿ç•™ 3 ä½å°æ•°å³å¯ï¼‰</div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>åŒºåŸŸ</label>
            <input type="text" id="formRegion">
          </div>
          <div class="form-item">
            <label>å®¹é‡</label>
            <input type="number" id="formCapacity" value="1">
          </div>
        </div>
        <div class="form-item">
          <label>æè¿°</label>
          <textarea id="formDescription" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-warning" onclick="closeModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="submitForm()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- æŸ¥çœ‹è¯¦æƒ…å¼¹çª— -->
  <div class="modal" id="viewModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>åœé ç‚¹è¯¦æƒ…</h3>
        <button class="modal-close" onclick="closeViewModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-item">
            <label>åç§°</label>
            <p id="viewName" style="margin: 5px 0; font-weight: 500;">-</p>
          </div>
          <div class="form-item">
            <label>ç±»å‹</label>
            <p id="viewType" style="margin: 5px 0;">-</p>
          </div>
        </div>
        <div class="form-item">
          <label>åœ°å€</label>
          <p id="viewAddress" style="margin: 5px 0;">-</p>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>çº¬åº¦</label>
            <p id="viewLat" style="margin: 5px 0;">-</p>
          </div>
          <div class="form-item">
            <label>ç»åº¦</label>
            <p id="viewLng" style="margin: 5px 0;">-</p>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>åŒºåŸŸ</label>
            <p id="viewRegion" style="margin: 5px 0;">-</p>
          </div>
          <div class="form-item">
            <label>å®¹é‡</label>
            <p id="viewCapacity" style="margin: 5px 0;">-</p>
          </div>
        </div>
        <div class="form-item">
          <label>æè¿°</label>
          <p id="viewDescription" style="margin: 5px 0; white-space: pre-wrap;">-</p>
        </div>
        <div class="form-item">
          <label>çŠ¶æ€</label>
          <p id="viewStatus" style="margin: 5px 0;">-</p>
        </div>
        <div class="form-item">
          <label>å®¡æ‰¹çŠ¶æ€</label>
          <p id="viewApprovalStatus" style="margin: 5px 0;">-</p>
        </div>
        <div class="form-item" id="viewRejectionReasonBox" style="display: none;">
          <label>é©³å›åŸå› </label>
          <p id="viewRejectionReason" style="margin: 5px 0; color: #ff4d4f;">-</p>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>åˆ›å»ºæ—¶é—´</label>
            <p id="viewCreatedAt" style="margin: 5px 0;">-</p>
          </div>
          <div class="form-item">
            <label>æ›´æ–°æ—¶é—´</label>
            <p id="viewUpdatedAt" style="margin: 5px 0;">-</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeViewModal()">å…³é—­</button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3000/api';
    let currentPage = 1;
    let currentLimit = 20;
    let editingId = null;

    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    function checkLoginStatus() {
      const token = localStorage.getItem('tenantToken');
      if (!token) {
        window.location.href = './carrier-login.html';
      }
    }

    // é€€å‡ºç™»å½•
    document.getElementById('logout-btn')?.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        const token = localStorage.getItem('tenantToken');
        await fetch(`${API_BASE}/tenant-web/logout`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        localStorage.removeItem('tenantToken');
        window.location.href = './carrier-login.html';
      } catch (error) {
        console.error('ç™»å‡ºå¤±è´¥:', error);
        localStorage.removeItem('tenantToken');
        window.location.href = './carrier-login.html';
      }
    });

    document.getElementById('logout-btn-header')?.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        const token = localStorage.getItem('tenantToken');
        await fetch(`${API_BASE}/tenant-web/logout`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        localStorage.removeItem('tenantToken');
        window.location.href = './carrier-login.html';
      } catch (error) {
        console.error('ç™»å‡ºå¤±è´¥:', error);
        localStorage.removeItem('tenantToken');
        window.location.href = './carrier-login.html';
      }
    });

    // åŠ è½½ç»Ÿè®¡æ•°æ®
    async function loadStats() {
      try {
        const token = localStorage.getItem('tenantToken');
        const response = await fetch(`${API_BASE}/carrier/stop-points?page=1&limit=1`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            const total = data.data.pagination?.total || 0;
            document.getElementById('statTotal').textContent = total;
            
            // éœ€è¦åˆ†åˆ«è¯·æ±‚ä¸åŒçŠ¶æ€çš„æ•°é‡
            loadStatsByStatus(token);
          }
        }
      } catch (err) {
        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', err);
      }
    }

    async function loadStatsByStatus(token) {
      try {
        // å¾…å®¡æ‰¹
        const pendingRes = await fetch(`${API_BASE}/carrier/stop-points?page=1&limit=1&approvalStatus=pending`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        const pendingData = await pendingRes.json();
        document.getElementById('statPending').textContent = pendingData.data?.pagination?.total || 0;

        // å·²é€šè¿‡
        const approvedRes = await fetch(`${API_BASE}/carrier/stop-points?page=1&limit=1&approvalStatus=approved`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        const approvedData = await approvedRes.json();
        document.getElementById('statApproved').textContent = approvedData.data?.pagination?.total || 0;

        // å·²é©³å›
        const rejectedRes = await fetch(`${API_BASE}/carrier/stop-points?page=1&limit=1&approvalStatus=rejected`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        const rejectedData = await rejectedRes.json();
        document.getElementById('statRejected').textContent = rejectedData.data?.pagination?.total || 0;
      } catch (err) {
        console.error('åŠ è½½çŠ¶æ€ç»Ÿè®¡å¤±è´¥:', err);
      }
    }

    // åŠ è½½åœé ç‚¹åˆ—è¡¨
    async function loadStopPoints() {
      const token = localStorage.getItem('tenantToken');
      const search = document.getElementById('search').value;
      const type = document.getElementById('typeFilter').value;
      const approvalStatus = document.getElementById('approvalFilter').value;

      const params = new URLSearchParams({
        page: currentPage,
        limit: currentLimit
      });

      if (search) params.append('search', search);
      if (type) params.append('type', type);
      if (approvalStatus) params.append('approvalStatus', approvalStatus);

      try {
        const response = await fetch(`${API_BASE}/carrier/stop-points?${params}`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();
        const container = document.getElementById('stopPointsList');

        if (data.success && data.data.list.length > 0) {
          container.innerHTML = data.data.list.map(sp => `
            <tr>
              <td>${sp.id}</td>
              <td>${sp.name}</td>
              <td>${sp.address}</td>
              <td><span class="type-badge">${sp.type || 'å…¶ä»–'}</span></td>
              <td>${sp.region || '-'}</td>
              <td>${sp.lat}, ${sp.lng}</td>
              <td><span class="status-badge status-${sp.approval_status || 'pending'}">${getApprovalStatusText(sp.approval_status)}</span></td>
              <td>${new Date(sp.created_at).toLocaleString('zh-CN')}</td>
              <td>
                <button class="btn btn-primary btn-sm" onclick="viewStopPoint(${sp.id})">æŸ¥çœ‹</button>
                ${sp.approval_status === 'pending' || sp.approval_status === 'rejected' ? `
                  <button class="btn btn-warning btn-sm" onclick="editStopPoint(${sp.id})">ç¼–è¾‘</button>
                  <button class="btn btn-danger btn-sm" onclick="deleteStopPoint(${sp.id})">åˆ é™¤</button>
                ` : '-'}
              </td>
            </tr>
          `).join('');

          // æ›´æ–°åˆ†é¡µä¿¡æ¯
          const pagination = data.data.pagination;
          document.getElementById('paginationInfo').textContent = 
            `å…± ${pagination.total} æ¡ | ç¬¬ ${pagination.page} é¡µ / å…± ${pagination.totalPages} é¡µ`;
        } else {
          container.innerHTML = '<tr><td colspan="9" style="text-align:center;color:#999;padding:40px;">æš‚æ— æ•°æ®</td></tr>';
          document.getElementById('paginationInfo').textContent = 'å…± 0 æ¡';
        }
      } catch (err) {
        console.error('åŠ è½½åœé ç‚¹åˆ—è¡¨å¤±è´¥:', err);
        document.getElementById('stopPointsList').innerHTML = 
          '<tr><td colspan="9" style="text-align:center;color:#dc2626;padding:40px;">åŠ è½½å¤±è´¥</td></tr>';
      }
    }

    function getApprovalStatusText(status) {
      const statusMap = {
        'pending': 'å¾…å®¡æ‰¹',
        'approved': 'å·²é€šè¿‡',
        'rejected': 'å·²é©³å›'
      };
      return statusMap[status] || status;
    }

    // æ˜¾ç¤ºæ–°å¢å¼¹çª—
    function showCreateModal() {
      editingId = null;
      document.getElementById('modalTitle').textContent = 'æ–°å¢åœé ç‚¹';
      document.getElementById('formName').value = '';
      document.getElementById('formAddress').value = '';
      document.getElementById('formType').value = 'other';
      document.getElementById('formLat').value = '';
      document.getElementById('formLng').value = '';
      document.getElementById('formRegion').value = '';
      document.getElementById('formCapacity').value = '1';
      document.getElementById('formDescription').value = '';
      document.getElementById('createModal').classList.add('show');
    }

    // å…³é—­å¼¹çª—
    function closeModal() {
      document.getElementById('createModal').classList.remove('show');
    }

    // æäº¤è¡¨å•
    async function submitForm() {
      const name = document.getElementById('formName').value;
      const address = document.getElementById('formAddress').value;
      const type = document.getElementById('formType').value;
      const lat = document.getElementById('formLat').value;
      const lng = document.getElementById('formLng').value;
      const region = document.getElementById('formRegion').value;
      const capacity = document.getElementById('formCapacity').value;
      const description = document.getElementById('formDescription').value;

      if (!name || !address || !lat || !lng) {
        alert('è¯·å¡«å†™å¿…å¡«é¡¹');
        return;
      }

      if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
        alert('åæ ‡è¶…å‡ºèŒƒå›´');
        return;
      }

      const token = localStorage.getItem('tenantToken');
      const body = { name, address, lat: parseFloat(lat), lng: parseFloat(lng), type, region, capacity: parseInt(capacity), description };

      try {
        const response = await fetch(`${API_BASE}/carrier/stop-points`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });

        const data = await response.json();
        if (data.success) {
          alert('åœé ç‚¹å·²æäº¤ï¼Œç­‰å¾…å®¡æ‰¹');
          closeModal();
          loadStopPoints();
          loadStats();
        } else {
          alert(`æäº¤å¤±è´¥ï¼š${data.message || data.error}`);
        }
      } catch (err) {
        console.error('æäº¤å¤±è´¥:', err);
        alert('æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      }
    }

    // æŸ¥çœ‹åœé ç‚¹
    async function viewStopPoint(id) {
      const token = localStorage.getItem('tenantToken');
      try {
        const response = await fetch(`${API_BASE}/carrier/stop-points/${id}`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        const data = await response.json();
        if (data.success) {
          const sp = data.data;
          document.getElementById('viewName').textContent = sp.name || '-';
          document.getElementById('viewType').textContent = {
            'other': 'å…¶ä»–',
            'residential': 'ä½å®…åŒº',
            'commercial': 'å•†ä¸šåŒº',
            'industrial': 'å·¥ä¸šåŒº'
          }[sp.type] || '-';
          document.getElementById('viewAddress').textContent = sp.address || '-';
          document.getElementById('viewLat').textContent = sp.lat || '-';
          document.getElementById('viewLng').textContent = sp.lng || '-';
          document.getElementById('viewRegion').textContent = sp.region || '-';
          document.getElementById('viewCapacity').textContent = sp.capacity || '-';
          document.getElementById('viewDescription').textContent = sp.description || '-';
          document.getElementById('viewStatus').textContent = sp.status === 'active' ? 'å¯ç”¨' : 'åœç”¨';
          
          const approvalStatusText = {
            'pending': 'å¾…å®¡æ‰¹',
            'approved': 'å·²é€šè¿‡',
            'rejected': 'å·²é©³å›'
          }[sp.approval_status] || '-';
          document.getElementById('viewApprovalStatus').textContent = approvalStatusText;
          
          if (sp.approval_status === 'rejected' && sp.rejection_reason) {
            document.getElementById('viewRejectionReasonBox').style.display = 'block';
            document.getElementById('viewRejectionReason').textContent = sp.rejection_reason;
          } else {
            document.getElementById('viewRejectionReasonBox').style.display = 'none';
          }
          
          document.getElementById('viewCreatedAt').textContent = sp.created_at || '-';
          document.getElementById('viewUpdatedAt').textContent = sp.updated_at || '-';
          
          document.getElementById('viewModal').classList.add('show');
        } else {
          alert('è·å–åœé ç‚¹è¯¦æƒ…å¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));
        }
      } catch (err) {
        console.error('è·å–åœé ç‚¹è¯¦æƒ…å¤±è´¥:', err);
        alert('è·å–å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    // å…³é—­æŸ¥çœ‹å¼¹çª—
    function closeViewModal() {
      document.getElementById('viewModal').classList.remove('show');
    }

    // ç¼–è¾‘åœé ç‚¹
    async function editStopPoint(id) {
      const token = localStorage.getItem('tenantToken');
      try {
        const response = await fetch(`${API_BASE}/carrier/stop-points/${id}`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();
        if (data.success) {
          const sp = data.data;
          editingId = id;
          document.getElementById('modalTitle').textContent = 'ç¼–è¾‘åœé ç‚¹';
          document.getElementById('formName').value = sp.name;
          document.getElementById('formAddress').value = sp.address;
          document.getElementById('formType').value = sp.type || 'other';
          document.getElementById('formLat').value = sp.lat;
          document.getElementById('formLng').value = sp.lng;
          document.getElementById('formRegion').value = sp.region || '';
          document.getElementById('formCapacity').value = sp.capacity || 1;
          document.getElementById('formDescription').value = sp.description || '';
          document.getElementById('createModal').classList.add('show');
        }
      } catch (err) {
        console.error('è·å–åœé ç‚¹è¯¦æƒ…å¤±è´¥:', err);
        alert('è·å–å¤±è´¥');
      }
    }

    // åˆ é™¤åœé ç‚¹
    async function deleteStopPoint(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¯¥åœé ç‚¹å—ï¼Ÿ\n\næ³¨æ„ï¼šæäº¤è¶…è¿‡ 3 å¤©çš„åœé ç‚¹ä¸èƒ½åˆ é™¤ã€‚')) return;

      const token = localStorage.getItem('tenantToken');
      try {
        const response = await fetch(`${API_BASE}/carrier/stop-points/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();
        if (data.success) {
          alert('åˆ é™¤æˆåŠŸ');
          loadStopPoints();
          loadStats();
        } else {
          alert(`åˆ é™¤å¤±è´¥ï¼š${data.message || data.error}`);
        }
      } catch (err) {
        console.error('åˆ é™¤å¤±è´¥:', err);
        alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      }
    }

    // åˆ†é¡µ
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        loadStopPoints();
      }
    }

    function nextPage() {
      currentPage++;
      loadStopPoints();
    }

    // é¡µé¢åŠ è½½
    document.addEventListener('DOMContentLoaded', () => {
      checkLoginStatus();
      loadStats();
      loadStopPoints();
      initAddressSearch();
    });

    // åˆå§‹åŒ–åœ°å€æœç´¢
    function initAddressSearch() {
      const input = document.getElementById('formAddress');
      const panel = document.getElementById('searchResults');
      console.log('[INIT] input:', input, 'panel:', panel);
      if (!input || !panel) {
        console.error('[INIT] å…ƒç´ ä¸å­˜åœ¨!');
        return;
      }
      console.log('[INIT] åœ°å€æœç´¢åˆå§‹åŒ–æˆåŠŸ');

      let timer;
      input.addEventListener('input', () => {
        const keyword = input.value.trim();
        console.log('[INPUT] è¾“å…¥:', keyword);
        clearTimeout(timer);
        timer = setTimeout(() => {
          console.log('[SEARCH] å¼€å§‹æœç´¢:', keyword);
          if (keyword) searchPlaces(keyword, panel);
          else panel.style.display = 'none';
        }, 300);
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('#formAddress') && !e.target.closest('#searchResults')) {
          panel.style.display = 'none';
        }
      });
    }

    // æ ¹æ®åœ°å€è·å–åæ ‡
    function getCoordsFromAddress() {
      const address = document.getElementById('formAddress').value.trim();
      console.log('[GEO] åœ°å€:', address);
      if (!address) { alert('è¯·å…ˆè¾“å…¥åœ°å€'); return; }
      jsonpRequest('geocoder', address);
    }

    // æ¨¡ç³Šæœç´¢
    function searchPlaces(keyword, panel) {
      console.log('[SEARCH] searchPlaces è°ƒç”¨:', keyword);
      jsonpRequest('search', keyword, panel);
    }

    // JSONP è¯·æ±‚ï¼ˆå¸¦ fetch å¤‡ç”¨æ–¹æ¡ˆï¼‰
    function jsonpRequest(type, keyword, panel) {
      const KEY = 'SRFBZ-3GHEW-ANLRG-YZODQ-LWDXQ-PXFS6';
      const callbackName = 'cb_' + Date.now();
      const urls = {
        geocoder: 'https://apis.map.qq.com/ws/geocoder/v1/',
        search: 'https://apis.map.qq.com/ws/place/v1/suggestion/'
      };
      const baseUrl = urls[type];
      const param = type === 'geocoder' ? 'address=' : 'keyword=';
      const fullUrl = `${baseUrl}?${param}${encodeURIComponent(keyword)}&key=${KEY}&callback=${callbackName}`;
      console.log('[JSONP] URL:', fullUrl);

      // å›è°ƒå‡½æ•°
      window[callbackName] = function(data) {
        console.log('[JSONP] å›è°ƒæ•°æ®:', data);
        delete window[callbackName];
        const script = document.getElementById('s_' + callbackName);
        if (script) script.remove();

        if (type === 'geocoder') {
          if (data.status === 0 && data.result?.location) {
            document.getElementById('formLat').value = data.result.location.lat.toFixed(3);
            document.getElementById('formLng').value = data.result.location.lng.toFixed(3);
            alert('åæ ‡å·²è‡ªåŠ¨å¡«å……ï¼');
          } else {
            alert('æœªæ‰¾åˆ°è¯¥åœ°å€ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));
          }
        } else if (type === 'search' && panel) {
          if (data.status === 0 && data.data && data.data.length > 0) {
            let html = '';
            data.data.forEach(item => {
              const addr = (item.address || item.title).replace(/'/g, "\\'");
              const title = item.title.replace(/'/g, "\\'");
              const lat = item.location.lat;
              const lng = item.location.lng;
              html += `<div onclick="fillAddress('${addr}', ${lat}, ${lng})" style="padding:8px;cursor:pointer;border-bottom:1px solid #f0f0f0;">` +
                `<strong>${title}</strong><br><small style="color:#666;">${item.address || ''}</small></div>`;
            });
            panel.innerHTML = html;
            panel.style.display = 'block';
            console.log('[SEARCH] æ˜¾ç¤º', data.data.length, 'æ¡ç»“æœ');
          } else {
            panel.style.display = 'none';
            console.log('[SEARCH] æ— ç»“æœï¼Œstatus:', data.status);
          }
        }
      };

      // å°è¯• JSONP æ–¹å¼
      const script = document.createElement('script');
      script.id = 's_' + callbackName;
      script.src = fullUrl;
      script.onerror = () => {
        console.error('[JSONP] åŠ è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ fetch å¤‡ç”¨æ–¹æ¡ˆ...');
        delete window[callbackName];
        script.remove();
        // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨åç«¯ä»£ç†
        fetchWithProxy(type, keyword, panel, baseUrl, param, KEY);
      };
      script.onload = () => { console.log('[JSONP] è„šæœ¬åŠ è½½æˆåŠŸ'); };
      document.body.appendChild(script);
      console.log('[JSONP] è„šæœ¬å·²æ·»åŠ ');
    }

    // å¤‡ç”¨æ–¹æ¡ˆï¼šé€šè¿‡åç«¯ä»£ç†è¯·æ±‚ï¼ˆé¿å… CORS é—®é¢˜ï¼‰+ è¯·æ±‚èŠ‚æµå’Œç¼“å­˜
    let lastRequestTime = 0;
    const MIN_REQUEST_INTERVAL = 200; // æœ€å°è¯·æ±‚é—´éš” 200ms
    
    // å‰ç«¯ç¼“å­˜ï¼šå­˜å‚¨æœ€è¿‘è¯·æ±‚çš„ç»“æœï¼ˆ5 åˆ†é’Ÿå†…ï¼‰
    const frontendCache = new Map();
    const CACHE_TTL = 5 * 60 * 1000; // 5 åˆ†é’Ÿ
    
    // è¿›è¡Œä¸­çš„è¯·æ±‚é˜Ÿåˆ—ï¼Œé¿å…é‡å¤è¯·æ±‚ç›¸åŒå…³é”®è¯
    const pendingRequests = new Map();

    function getCacheKey(type, keyword) {
      return `${type}:${keyword}`;
    }

    function isValidCache(cached) {
      if (!cached) return false;
      return Date.now() - cached.timestamp < CACHE_TTL;
    }

    function fetchWithProxy(type, keyword, panel, baseUrl, param, key) {
      const cacheKey = getCacheKey(type, keyword);
      
      // æ£€æŸ¥å‰ç«¯ç¼“å­˜
      const cached = frontendCache.get(cacheKey);
      if (isValidCache(cached)) {
        console.log('[PROXY] âœ… ä½¿ç”¨å‰ç«¯ç¼“å­˜:', cacheKey);
        handleProxyResponse(type, cached.data, panel);
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦æœ‰è¿›è¡Œä¸­çš„ç›¸åŒè¯·æ±‚
      if (pendingRequests.has(cacheKey)) {
        console.log('[PROXY] â³ ç­‰å¾…è¿›è¡Œä¸­çš„è¯·æ±‚:', cacheKey);
        pendingRequests.get(cacheKey).then(data => {
          handleProxyResponse(type, data, panel);
        }).catch(err => {
          console.error('[PROXY] ç­‰å¾…çš„è¯·æ±‚å¤±è´¥:', err);
          alert('åœ°å›¾æœåŠ¡è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•');
        });
        return;
      }
      
      // èŠ‚æµæ£€æŸ¥
      const now = Date.now();
      const timeSinceLastRequest = now - lastRequestTime;

      if (timeSinceLastRequest < MIN_REQUEST_INTERVAL) {
        console.log('[PROXY] è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œå»¶è¿Ÿå‘é€...');
        setTimeout(() => {
          fetchWithProxy(type, keyword, panel, baseUrl, param, key);
        }, MIN_REQUEST_INTERVAL - timeSinceLastRequest);
        return;
      }
      lastRequestTime = now;

      // åˆ›å»ºè¯·æ±‚ Promise
      const requestPromise = fetch(`${API_BASE}/map/proxy?type=${type}&${param}${encodeURIComponent(keyword)}&key=${key}`)
        .then(res => res.json())
        .then(data => {
          console.log('[PROXY] è¿”å›æ•°æ®:', data);
          
          // æ£€æŸ¥è…¾è®¯åœ°å›¾è¿”å›çš„é”™è¯¯
          if (data.status === 120) {
            console.warn('[PROXY] QPS è¶…é™ï¼Œç­‰å¾…åé‡è¯•...');
            // QPS è¶…é™ä¸ç¼“å­˜é”™è¯¯ç»“æœ
            throw new Error('QPS_LIMIT_EXCEEDED');
          }
          
          // æˆåŠŸå“åº”æ‰ç¼“å­˜
          if (data.status === 0) {
            frontendCache.set(cacheKey, { data, timestamp: Date.now() });
            console.log('[PROXY] ğŸ’¾ å·²ç¼“å­˜ç»“æœ:', cacheKey);
          }
          
          return data;
        })
        .catch(err => {
          console.error('[PROXY] è¯·æ±‚å¤±è´¥:', err);
          throw err;
        })
        .finally(() => {
          // è¯·æ±‚å®Œæˆåç§»é™¤ pending çŠ¶æ€
          pendingRequests.delete(cacheKey);
        });
      
      // å­˜å‚¨è¿›è¡Œä¸­çš„è¯·æ±‚
      pendingRequests.set(cacheKey, requestPromise);
      
      requestPromise
        .then(data => handleProxyResponse(type, data, panel))
        .catch(err => {
          if (err.message !== 'QPS_LIMIT_EXCEEDED') {
            alert('åœ°å›¾æœåŠ¡è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•');
          } else {
            // QPS è¶…é™æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
            panel.innerHTML = '<div style="padding:8px;color:#f59e0b;">è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•</div>';
            panel.style.display = 'block';
          }
        });
    }
    
    // å¤„ç†ä»£ç†å“åº”çš„ç»Ÿä¸€å‡½æ•°
    function handleProxyResponse(type, data, panel) {
      if (type === 'geocoder') {
        if (data.status === 0 && data.result?.location) {
          document.getElementById('formLat').value = data.result.location.lat.toFixed(3);
          document.getElementById('formLng').value = data.result.location.lng.toFixed(3);
          alert('åæ ‡å·²è‡ªåŠ¨å¡«å……ï¼');
        } else {
          alert('æœªæ‰¾åˆ°è¯¥åœ°å€ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));
        }
      } else if (type === 'search' && panel) {
        if (data.status === 0 && data.data && data.data.length > 0) {
          let html = '';
          data.data.forEach(item => {
            const addr = (item.address || item.title).replace(/'/g, "\\'");
            const title = item.title.replace(/'/g, "\\'");
            const lat = item.location.lat;
            const lng = item.location.lng;
            html += `<div onclick="fillAddress('${addr}', ${lat}, ${lng})" style="padding:8px;cursor:pointer;border-bottom:1px solid #f0f0f0;">` +
              `<strong>${title}</strong><br><small style="color:#666;">${item.address || ''}</small></div>`;
          });
          panel.innerHTML = html;
          panel.style.display = 'block';
          console.log('[PROXY] æ˜¾ç¤º', data.data.length, 'æ¡ç»“æœ');
        } else {
          panel.style.display = 'none';
          console.log('[PROXY] æ— ç»“æœï¼Œstatus:', data.status);
        }
      }
    }

    // å¡«å……åœ°å€
    function fillAddress(address, lat, lng) {
      console.log('[FILL] å¡«å……åœ°å€:', address, lat, lng);
      document.getElementById('formAddress').value = address;
      document.getElementById('formLat').value = lat.toFixed(3);
      document.getElementById('formLng').value = lng.toFixed(3);
      document.getElementById('searchResults').style.display = 'none';
    }

    // æµ‹è¯• API Key
    function testApiKey() {
      const KEY = 'SRFBZ-3GHEW-ANLRG-YZODQ-LWDXQ-PXFS6';
      const callbackName = 'testcb_' + Date.now();
      console.log('[TEST] å¼€å§‹æµ‹è¯• API Key');
      window[callbackName] = function(data) {
        console.log('[TEST] è¿”å›:', data);
        delete window[callbackName];
        document.getElementById('s_' + callbackName)?.remove();
        if (data.status === 0) {
          alert('API Key æœ‰æ•ˆï¼è¿”å› ' + (data.data?.length || 0) + ' æ¡ç»“æœ');
        } else {
          alert('API Key æ— æ•ˆï¼š' + data.message);
        }
      };
      const script = document.createElement('script');
      script.id = 's_' + callbackName;
      script.src = `https://apis.map.qq.com/ws/place/v1/suggestion/?keyword=åŒ—äº¬&key=${KEY}&callback=${callbackName}`;
      script.onerror = () => { delete window[callbackName]; script.remove(); alert('ç½‘ç»œè¯·æ±‚å¤±è´¥'); };
      document.body.appendChild(script);
      console.log('[TEST] è„šæœ¬å·²æ·»åŠ ');
    }
  </script>
</body>
</html>
