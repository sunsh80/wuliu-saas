openapi: 3.0.3
info:
  title: å¤šç§Ÿæˆ·ç‰©æµå¹³å° API
  version: 1.0.2-safe æŠ€æœ¯æ ˆ:Node.js + Express + SQLite + OpenAPI Backend è®¤è¯æœºåˆ¶:express-session(åŸºäº Cookie çš„ä¼šè¯ï¼‰ å®‰å…¨æ¨¡å‹ï¼šé€šè¿‡ TenantSessionAuth å®‰å…¨å¤„ç†å™¨æ ¡éªŒ req.session.userId å¤šç§Ÿæˆ·æ”¯æŒ:tenants è¡¨å­˜å‚¨ç§Ÿæˆ·,users è¡¨å­˜å‚¨ç§Ÿæˆ·å‘˜å·¥ & å°ç¨‹åºé¡¾å®¢
  description: |
    æ”¯æŒå®¢æˆ·ï¼ˆä¸‹å•æ–¹ï¼‰ä¸æ‰¿è¿æ–¹ï¼ˆæ¥å•æ–¹ï¼‰åŒè§’è‰²çš„ç‰©æµè®¢å•ç³»ç»Ÿã€‚
    - `/api/admin/...`ï¼šå¹³å°ç®¡ç†å‘˜
    - `/api/customer/...`ï¼šå®¢æˆ·ç§Ÿæˆ·
    - `/api/carrier/...`ï¼šæ‰¿è¿æ–¹ç§Ÿæˆ·
    - `/api/public/...`ï¼šå…¬å…±æ¥å£
    ğŸ”¹ æœ¬æ¬¡å¢å®¹(v1.0.2-safe):
    - ä¿ç•™æ‰€æœ‰ v1.0.1 å­—æ®µã€è·¯ç”±ã€çŠ¶æ€ä¸å˜
    - æ–°å¢æ‰¿è¿æ–¹èƒ½åŠ›ç”»åƒï¼ˆå¯é€‰ï¼‰
    - ç§Ÿæˆ·æœ¬èº«å¯ä»¥åœ¨ä¸€å®šæ¡ä»¶ä¸‹è½¬å˜ä¸ºæ‰¿è¿æ–¹ï¼Œå®¢æˆ·ï¼Œä»“åº“å®ä½“
    - æ–°å¢ä½“ç§¯ã€æ—¶æ•ˆç­‰å¯é€‰å­—æ®µ
    - æ–°å¢åŒ¹é…ç›¸å…³æ¥å£ï¼ˆä¸æ”¹åŠ¨åŸæœ‰ claim/award æµç¨‹ï¼‰
servers:
  - url: http://localhost:3000
    description: å¼€å‘ç¯å¢ƒ
tags:
  - name: setup
    description: å¹³å°åˆå§‹åŒ–ï¼ˆé¦–æ¬¡å®‰è£…ï¼‰
  - name: admin-auth
    description: å¹³å°ç®¡ç†å‘˜ - è®¤è¯ä¸ä¼šè¯
  - name: admin-user
    description: å¹³å°ç®¡ç†å‘˜ - ç”¨æˆ·ç®¡ç†
  - name: admin-tenant
    description: å¹³å°ç®¡ç†å‘˜ - ç§Ÿæˆ·ç®¡ç†
  - name: admin-order
    description: å¹³å°ç®¡ç†å‘˜ - è®¢å•ç®¡ç†
  - name: customer-order
    description: å®¢æˆ·ç§Ÿæˆ· - åˆ›å»ºä¸æŸ¥çœ‹è‡ªå·±çš„è®¢å•
  - name: carrier-order
    description: æ‰¿è¿æ–¹ç§Ÿæˆ· - è®¤é¢†ã€æ‰§è¡Œè®¢å•
  - name: public
    description: å…¬å…±æ¥å£ï¼ˆå°ç¨‹åºä½¿ç”¨ï¼Œæœªæ¥åºŸå¼ƒï¼‰
  - name: auth
    description: ç§Ÿæˆ·è®¤è¯ä¸ä¼šè¯
  - name: matching
    description: æ™ºèƒ½åŒ¹é…ï¼ˆæ–°å¢ï¼Œå¯é€‰ä½¿ç”¨ï¼‰
  - name: admin-pricing
    description: å¹³å°ç®¡ç†å‘˜ - å®šä»·è§„åˆ™ç®¡ç†
  - name: carrier-pricing
    description: æ‰¿è¿æ–¹ç§Ÿæˆ· - å®šä»·é…ç½®ç®¡ç†
components:
  securitySchemes:
    AdminSessionAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: å¹³å°ç®¡ç†å‘˜ç™»å½•åè‡ªåŠ¨æºå¸¦ï¼ˆç”± Express Session ç®¡ç†ï¼‰
    TenantSessionAuth:
      type: apiKey
      in: cookie
      name: connect.sid
      description: ç§Ÿæˆ·ç™»å½•åè‡ªåŠ¨æºå¸¦ï¼ˆç”± Express Session ç®¡ç†ï¼‰
  responses:
    UnauthorizedError:
      description: æœªæˆæƒè®¿é—®
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: UNAUTHORIZED
              message:
                type: string
                example: æœªæˆæƒè®¿é—®ï¼Œè¯·å…ˆç™»å½•
    BadRequestError:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: BAD_REQUEST
              message:
                type: string
                example: è¯·æ±‚å‚æ•°é”™è¯¯
    NotFoundError:
      description: èµ„æºæœªæ‰¾åˆ°
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: NOT_FOUND
              message:
                type: string
                example: èµ„æºæœªæ‰¾åˆ°
    InternalServerError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: INTERNAL_SERVER_ERROR
              message:
                type: string
                example: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
    ForbiddenError:
      description: ç¦æ­¢è®¿é—®
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: FORBIDDEN
              message:
                type: string
                example: ç¦æ­¢è®¿é—®æ­¤èµ„æº
  schemas:
    CustomerWebRegistration:
      type: object
      required:
        - contact_phone
        - password
        - roles
      properties:
        contact_phone:
          type: string
          pattern: ^1[3-9][0-9]{9}$
          example: '13800138000'
        password:
          type: string
          minLength: 6
          example: password123
        roles:
          type: array
          items:
            type: string
            enum:
              - customer
          example:
            - customer
    Username:
      type: string
      pattern: ^[a-zA-Z0-9_-]{3,20}$
      example: user_name_123
    Name:
      type: string
      pattern: ^[\u4e00-\u9fa5a-zA-Z0-9_-]{1,50}$
      example: å¼ ä¸‰
    Address:
      type: string
      pattern: ^[\u4e00-\u9fa5a-zA-Z0-9\s\S]{1,200}$
      example: åŒ—äº¬å¸‚æœé˜³åŒºæŸæŸè¡—é“123å·
    TenantApplication:
      type: object
      required:
        - name
        - contact_person
        - contact_phone
        - email
        - password
        - roles
      properties:
        name:
          $ref: '#/components/schemas/Name'
        contact_person:
          $ref: '#/components/schemas/Name'
        contact_phone:
          type: string
          pattern: ^1[3-9][0-9]{9}$
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        roles:
          type: array
          items:
            type: string
            enum:
              - customer
              - carrier
          minItems: 1
          example:
            - customer
            - carrier
        address:
          $ref: '#/components/schemas/Address'
        service_radius_km:
          type: integer
          minimum: 1
          example: 200
        capacity_kg:
          type: number
          minimum: 0.1
          example: 5000
        capacity_m3:
          type: number
          minimum: 0.1
          example: 30
        base_price_per_km:
          type: number
          minimum: 0.01
          example: 2.5
    TenantProfile:
      type: object
      properties:
        id:
          type: string
        name:
          $ref: '#/components/schemas/Name'
        contact_person:
          $ref: '#/components/schemas/Name'
        roles:
          type: array
          items:
            type: string
            enum:
              - customer
              - carrier
        address:
          $ref: '#/components/schemas/Address'
        service_radius_km:
          type: integer
        capacity_kg:
          type: number
        capacity_m3:
          type: number
        base_price_per_km:
          type: number
        avg_rating:
          type: number
          minimum: 0
          maximum: 5
    QuoteRequest:
      type: object
      required:
        - price
      properties:
        price:
          type: number
          minimum: 0.01
          example: 150
        estimated_hours:
          type: integer
          minimum: 1
          example: 24
        estimated_arrival:
          type: string
          format: date-time
          example: '2026-01-14T18:00:00Z'
        note:
          type: string
          example: è‡ªæœ‰è½¦è¾†,24å°æ—¶å†…è£…è½¦
    QuoteItem:
      type: object
      properties:
        id:
          type: string
        order_id:
          type: string
        carrier_tenant_id:
          type: string
        carrier_tenant_name:
          type: string
        price:
          type: number
        estimated_hours:
          type: integer
        estimated_arrival:
          type: string
          format: date-time
        avg_rating:
          type: number
        match_score:
          type: number
        note:
          type: string
        created_at:
          type: string
          format: date-time
    CreateOrderRequest:
      type: object
      required:
        - pickup_address
        - delivery_address
        - weight_kg
      properties:
        pickup_address:
          type: string
          example: åŒ—äº¬å¸‚æœé˜³åŒºXXå¤§å¦
        delivery_address:
          type: string
          example: ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºYYå›­åŒº
        weight_kg:
          type: number
          format: float
          minimum: 0.1
          example: 25.5
        cargo_type:
          type: string
          enum:
            - å®¶å…·å®¶ç”µ
            - è£…ä¿®å»ºæ
            - åŠå…¬ç”¨å“
            - å¿«é€’åŒ…è£¹
            - å…¶ä»–
          description: è´§ç‰©ç±»å‹
          example: å®¶å…·å®¶ç”µ
        cargo_remark:
          type: string
          description: è´§ç‰©å¤‡æ³¨
          example: æ˜“ç¢å“ï¼Œè¯·å°å¿ƒæ¬è¿
        length:
          type: number
          minimum: 0.01
          description: è´§ç‰©é•¿åº¦(ç±³)
          example: 1.2
        width:
          type: number
          minimum: 0.01
          description: è´§ç‰©å®½åº¦(ç±³)
          example: 0.8
        height:
          type: number
          minimum: 0.01
          description: è´§ç‰©é«˜åº¦(ç±³)
          example: 0.6
        vehicle_type:
          type: string
          enum:
            - æ— äººè½¦
            - æœ‰äººè½¦
          description: è½¦å‹è¦æ±‚
          example: æœ‰äººè½¦
        pickup_time:
          type: string
          format: date-time
          description: é¢„çº¦å–è´§æ—¶é—´
          example: '2026-01-15T10:00:00Z'
        volume_m3:
          type: number
          minimum: 0.01
          example: 1.2
        required_delivery_time:
          type: string
          format: date-time
          example: '2026-01-15T12:00:00Z'
        quote_deadline:
          type: string
          format: date-time
          example: '2026-01-14T10:00:00Z'
        customer_name:
          $ref: '#/components/schemas/Name'
        customer_phone:
          type: string
          pattern: ^1[3-9]\d{9}$
          example: '13800138000'
        description:
          type: string
          example: æ˜“ç¢å“ï¼Œè¯·è½»æ‹¿è½»æ”¾
    OrderItem:
      type: object
      properties:
        id:
          type: string
          example: order_123e4567-e89b-12d3-a456-426614174000
        customer_tenant_id:
          type: string
        customer_tenant_name:
          type: string
        carrier_tenant_id:
          type: string
          nullable: true
        carrier_tenant_name:
          type: string
          nullable: true
        pickup_address:
          type: string
        delivery_address:
          type: string
        weight_kg:
          type: number
        volume_m3:
          type: number
        required_delivery_time:
          type: string
          format: date-time
        quote_deadline:
          type: string
          format: date-time
        status:
          type: string
          enum:
            - created
            - pending
            - pending_claim
            - claimed
            - quoted
            - awarded
            - dispatched
            - in_transit
            - delivered
            - cancelled
        created_at:
          type: string
          format: date-time
        quotes:
          type: array
          items:
            $ref: '#/components/schemas/QuoteItem'
          nullable: true
        order_id:
          type: string
          example: ORD-20260205-001
          description: è®¢å•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå‰ç«¯å±•ç¤ºå’Œè·³è½¬è¯¦æƒ…é¡µ
        updated_at:
          type: string
          format: date-time
          example: '2026-02-05T10:35:00Z'
          description: è®¢å•æœ€åæ›´æ–°æ—¶é—´
        sender_info:
          type: string
          example: '{"name": "å¼ ä¸‰", "phone": "13800138000"}'
          description: å‘è´§äººä¿¡æ¯ï¼ˆJSON å­—ç¬¦ä¸²æ ¼å¼ï¼‰
        receiver_info:
          type: string
          example: '{"name": "æå››", "phone": "13900139000"}'
          description: æ”¶è´§äººä¿¡æ¯ï¼ˆJSON å­—ç¬¦ä¸²æ ¼å¼ï¼‰
        cargo_type:
          type: string
          example: furniture
          description: è´§ç‰©ç±»å‹
        length:
          type: number
          example: 1.2
          description: è´§ç‰©é•¿åº¦ï¼ˆç±³ï¼‰
        width:
          type: number
          example: 0.8
          description: è´§ç‰©å®½åº¦ï¼ˆç±³ï¼‰
        height:
          type: number
          example: 0.6
          description: è´§ç‰©é«˜åº¦ï¼ˆç±³ï¼‰
        description:
          type: string
          example: è¯·åŠ¡å¿…å°å¿ƒè½»æ”¾
          description: è®¢å•å¤‡æ³¨
        total_price:
          type: number
          example: 299.99
          description: è®¢å•æ€»ä»·æ ¼
      required:
        - id
        - order_id
        - status
        - created_at
        - pickup_address
        - delivery_address
        - sender_info
        - receiver_info
        - cargo_type
        - weight_kg
        - length
        - width
        - height
        - volume_m3
        - total_price
        - customer_tenant_id
        - customer_tenant_name
    OrderListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: è·å–æˆåŠŸ
        data:
          type: object
          properties:
            total:
              type: integer
              example: 5
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 10
            orders:
              type: array
              items:
                $ref: '#/components/schemas/OrderItem'
      required:
        - success
        - data
    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: TENANT_ROLE_NOT_ENABLED
        message:
          type: string
          example: å½“å‰ç§Ÿæˆ·æœªå¯ç”¨å®¢æˆ·è§’è‰²
    TenantListItem:
      type: object
      properties:
        id:
          type: integer
        name:
          $ref: '#/components/schemas/Name'
        contact_person:
          $ref: '#/components/schemas/Name'
        contact_phone:
          type: string
          pattern: ^1[3-9][0-9]{9}$
        email:
          type: string
          format: email
        status:
          type: string
          enum:
            - pending
            - approved
            - rejected
            - active
            - inactive
        created_at:
          type: string
          format: date-time
        address:
          type: string
        service_radius_km:
          type: integer
        capacity_kg:
          type: number
        capacity_m3:
          type: number
        base_price_per_km:
          type: number
        avg_rating:
          type: number
          minimum: 0
          maximum: 5
    TenantDetail:
      allOf:
        - $ref: '#/components/schemas/TenantListItem'
        - type: object
          properties:
            updated_at:
              type: string
              format: date-time
            vehicles:
              type: array
              items:
                $ref: '#/components/schemas/VehicleInfo'
            financial_info:
              $ref: '#/components/schemas/TenantFinancialInfo'
            contact_info:
              $ref: '#/components/schemas/TenantContactInfo'
    VehicleInfo:
      type: object
      properties:
        id:
          type: integer
        plate_number:
          type: string
        type:
          type: string
        length:
          type: number
        width:
          type: number
        height:
          type: number
        max_weight:
          type: number
        volume:
          type: number
        status:
          type: string
        driver_name:
          type: string
        driver_phone:
          type: string
        image_url:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    TenantFinancialInfo:
      type: object
      properties:
        bank_account_number:
          type: string
        bank_name:
          type: string
        tax_id:
          type: string
        settlement_cycle:
          type: string
        credit_limit:
          type: number
        outstanding_balance:
          type: number
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    TenantContactInfo:
      type: object
      properties:
        finance_contact_name:
          type: string
        finance_contact_phone:
          type: string
        finance_contact_email:
          type: string
        support_contact_name:
          type: string
        support_contact_phone:
          type: string
        support_contact_email:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PaginationInfo:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 10
        total:
          type: integer
          example: 100
        total_pages:
          type: integer
          example: 10
        has_next:
          type: boolean
          example: true
        has_prev:
          type: boolean
          example: false
    PricingRule:
      type: object
      properties:
        id:
          type: integer
          example: 1
        rule_name:
          type: string
          example: æ ‡å‡†å®šä»·è§„åˆ™
        base_price:
          type: number
          example: 10
        price_per_km:
          type: number
          example: 2.5
        price_per_hour:
          type: number
          example: 5
        price_per_kg:
          type: number
          example: 1
        cold_storage_surcharge:
          type: number
          example: 0.5
        peak_hour_multiplier:
          type: number
          example: 1.5
        off_peak_hour_multiplier:
          type: number
          example: 0.8
        weather_multiplier:
          type: number
          example: 1.2
        min_price:
          type: number
          example: 5
        max_price:
          type: number
          example: 1000
        time_slot_rules:
          type: object
          example: {}
        region_rules:
          type: object
          example: {}
        vehicle_type_rules:
          type: object
          example: {}
        active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: '2026-01-25T15:30:00Z'
        updated_at:
          type: string
          format: date-time
          example: '2026-01-25T15:30:00Z'
    CreatePricingRuleRequest:
      type: object
      required:
        - rule_name
      properties:
        rule_name:
          type: string
          example: æ ‡å‡†å®šä»·è§„åˆ™
          description: å®šä»·è§„åˆ™åç§°
        base_price:
          type: number
          example: 10
          description: åŸºç¡€ä»·æ ¼
        price_per_km:
          type: number
          example: 2.5
          description: æ¯å…¬é‡Œä»·æ ¼
        price_per_hour:
          type: number
          example: 5
          description: æ¯å°æ—¶ä»·æ ¼
        price_per_kg:
          type: number
          example: 1
          description: æ¯å…¬æ–¤ä»·æ ¼
        cold_storage_surcharge:
          type: number
          example: 0.5
          description: å†·è—é™„åŠ è´¹
        peak_hour_multiplier:
          type: number
          example: 1.5
          description: é«˜å³°æ—¶æ®µå€ç‡
        off_peak_hour_multiplier:
          type: number
          example: 0.8
          description: éé«˜å³°æ—¶æ®µå€ç‡
        weather_multiplier:
          type: number
          example: 1.2
          description: å¤©æ°”å€ç‡
        min_price:
          type: number
          example: 5
          description: æœ€ä½ä»·æ ¼
        max_price:
          type: number
          example: 1000
          description: æœ€é«˜ä»·æ ¼
        time_slot_rules:
          type: object
          description: æ—¶æ®µè§„åˆ™
        region_rules:
          type: object
          description: åœ°åŒºè§„åˆ™
        vehicle_type_rules:
          type: object
          description: è½¦å‹è§„åˆ™
        active:
          type: boolean
          example: true
          description: æ˜¯å¦æ¿€æ´»
    UpdatePricingRuleRequest:
      type: object
      properties:
        rule_name:
          type: string
          example: æ ‡å‡†å®šä»·è§„åˆ™
          description: å®šä»·è§„åˆ™åç§°
        base_price:
          type: number
          example: 10
          description: åŸºç¡€ä»·æ ¼
        price_per_km:
          type: number
          example: 2.5
          description: æ¯å…¬é‡Œä»·æ ¼
        price_per_hour:
          type: number
          example: 5
          description: æ¯å°æ—¶ä»·æ ¼
        price_per_kg:
          type: number
          example: 1
          description: æ¯å…¬æ–¤ä»·æ ¼
        cold_storage_surcharge:
          type: number
          example: 0.5
          description: å†·è—é™„åŠ è´¹
        peak_hour_multiplier:
          type: number
          example: 1.5
          description: é«˜å³°æ—¶æ®µå€ç‡
        off_peak_hour_multiplier:
          type: number
          example: 0.8
          description: éé«˜å³°æ—¶æ®µå€ç‡
        weather_multiplier:
          type: number
          example: 1.2
          description: å¤©æ°”å€ç‡
        min_price:
          type: number
          example: 5
          description: æœ€ä½ä»·æ ¼
        max_price:
          type: number
          example: 1000
          description: æœ€é«˜ä»·æ ¼
        time_slot_rules:
          type: object
          description: æ—¶æ®µè§„åˆ™
        region_rules:
          type: object
          description: åœ°åŒºè§„åˆ™
        vehicle_type_rules:
          type: object
          description: è½¦å‹è§„åˆ™
        active:
          type: boolean
          description: æ˜¯å¦æ¿€æ´»
    Pagination:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 10
        total:
          type: integer
          example: 100
        total_pages:
          type: integer
          example: 10
        has_next:
          type: boolean
          example: true
        has_prev:
          type: boolean
          example: false
    CarrierPricingConfig:
      type: object
      properties:
        id:
          type: integer
          example: 1
        carrier_id:
          type: integer
          example: 1
        config_name:
          type: string
          example: æ ‡å‡†é…é€å®šä»·
        base_price:
          type: number
          example: 15
        price_per_km:
          type: number
          example: 3
        price_per_hour:
          type: number
          example: 6
        price_per_kg:
          type: number
          example: 1.5
        cold_storage_surcharge:
          type: number
          example: 0.8
        peak_hour_multiplier:
          type: number
          example: 1.8
        off_peak_hour_multiplier:
          type: number
          example: 0.7
        weather_multiplier:
          type: number
          example: 1.3
        min_price:
          type: number
          example: 8
        max_price:
          type: number
          example: 200
        time_slot_rules:
          type: object
          example: {}
        region_rules:
          type: object
          example: {}
        vehicle_type_rules:
          type: object
          example: {}
        active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: '2026-01-25T15:30:00Z'
        updated_at:
          type: string
          format: date-time
          example: '2026-01-25T15:30:00Z'
    CreateCarrierPricingConfigRequest:
      type: object
      required:
        - carrier_id
        - config_name
      properties:
        carrier_id:
          type: integer
          example: 1
          description: æ‰¿è¿å•†ID
        config_name:
          type: string
          example: æ ‡å‡†é…é€å®šä»·
          description: é…ç½®åç§°
        base_price:
          type: number
          example: 15
          description: åŸºç¡€ä»·æ ¼
        price_per_km:
          type: number
          example: 3
          description: æ¯å…¬é‡Œä»·æ ¼
        price_per_hour:
          type: number
          example: 6
          description: æ¯å°æ—¶ä»·æ ¼
        price_per_kg:
          type: number
          example: 1.5
          description: æ¯å…¬æ–¤ä»·æ ¼
        cold_storage_surcharge:
          type: number
          example: 0.8
          description: å†·è—é™„åŠ è´¹
        peak_hour_multiplier:
          type: number
          example: 1.8
          description: é«˜å³°æ—¶æ®µå€ç‡
        off_peak_hour_multiplier:
          type: number
          example: 0.7
          description: éé«˜å³°æ—¶æ®µå€ç‡
        weather_multiplier:
          type: number
          example: 1.3
          description: å¤©æ°”å€ç‡
        min_price:
          type: number
          example: 8
          description: æœ€ä½ä»·æ ¼
        max_price:
          type: number
          example: 200
          description: æœ€é«˜ä»·æ ¼
        time_slot_rules:
          type: object
          description: æ—¶æ®µè§„åˆ™
        region_rules:
          type: object
          description: åœ°åŒºè§„åˆ™
        vehicle_type_rules:
          type: object
          description: è½¦å‹è§„åˆ™
        active:
          type: boolean
          example: true
          description: æ˜¯å¦æ¿€æ´»
    UpdateCarrierPricingConfigRequest:
      type: object
      properties:
        config_name:
          type: string
          example: æ ‡å‡†é…é€å®šä»·
          description: é…ç½®åç§°
        base_price:
          type: number
          example: 15
          description: åŸºç¡€ä»·æ ¼
        price_per_km:
          type: number
          example: 3
          description: æ¯å…¬é‡Œä»·æ ¼
        price_per_hour:
          type: number
          example: 6
          description: æ¯å°æ—¶ä»·æ ¼
        price_per_kg:
          type: number
          example: 1.5
          description: æ¯å…¬æ–¤ä»·æ ¼
        cold_storage_surcharge:
          type: number
          example: 0.8
          description: å†·è—é™„åŠ è´¹
        peak_hour_multiplier:
          type: number
          example: 1.8
          description: é«˜å³°æ—¶æ®µå€ç‡
        off_peak_hour_multiplier:
          type: number
          example: 0.7
          description: éé«˜å³°æ—¶æ®µå€ç‡
        weather_multiplier:
          type: number
          example: 1.3
          description: å¤©æ°”å€ç‡
        min_price:
          type: number
          example: 8
          description: æœ€ä½ä»·æ ¼
        max_price:
          type: number
          example: 200
          description: æœ€é«˜ä»·æ ¼
        time_slot_rules:
          type: object
          description: æ—¶æ®µè§„åˆ™
        region_rules:
          type: object
          description: åœ°åŒºè§„åˆ™
        vehicle_type_rules:
          type: object
          description: è½¦å‹è§„åˆ™
        active:
          type: boolean
          description: æ˜¯å¦æ¿€æ´»
    CarrierQuote:
      type: object
      properties:
        carrier_id:
          type: integer
          example: 1
        carrier_name:
          type: string
          example: "é¡ºä¸°é€Ÿè¿"
        quote_amount:
          type: number
          example: 150.00
        estimated_delivery_time:
          type: string
          format: date-time
          example: "2026-02-10T18:00:00Z"
        service_level:
          type: string
          example: "standard"
          enum:
            - standard
            - express
            - premium
        vehicle_type:
          type: string
          example: "van"
        capacity_available:
          type: number
          example: 1000
        rating:
          type: number
          example: 4.8
          minimum: 0
          maximum: 5
        quote_valid_until:
          type: string
          format: date-time
          example: "2026-02-11T10:00:00Z"
        additional_services:
          type: array
          items:
            type: object
            properties:
              service_name:
                type: string
                example: "å¤œé—´é…é€"
              cost:
                type: number
                example: 20.00
              description:
                type: string
                example: "æä¾›å¤œé—´é…é€æœåŠ¡"
        terms:
          type: string
          example: "åŒ…å«åŸºç¡€ä¿é™©ï¼Œè¶…æ—¶èµ”å¿"
    OrderDetails:
      type: object
      properties:
        distance_km:
          type: number
          example: 15.5
        duration_hours:
          type: number
          example: 2.5
        weight_kg:
          type: number
          example: 100
paths:
  /api/admin/pricing-rules:
    get:
      tags:
        - admin-pricing
      summary: è·å–å¹³å°å®šä»·è§„åˆ™åˆ—è¡¨
      operationId: listPlatformPricingRules
      security:
        - AdminSessionAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: é¡µç 
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: æ¯é¡µæ•°é‡
        - name: active
          in: query
          schema:
            type: boolean
          description: æ˜¯å¦åªè¿”å›æ¿€æ´»çš„è§„åˆ™
      responses:
        '200':
          description: å®šä»·è§„åˆ™åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PricingRule'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - admin-pricing
      summary: åˆ›å»ºå¹³å°å®šä»·è§„åˆ™
      operationId: createPlatformPricingRule
      security:
        - AdminSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePricingRuleRequest'
      responses:
        '201':
          description: å®šä»·è§„åˆ™åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: å¹³å°å®šä»·è§„åˆ™åˆ›å»ºæˆåŠŸ
                  data:
                    $ref: '#/components/schemas/PricingRule'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/admin/pricing-rules/{id}:
    get:
      tags:
        - admin-pricing
      summary: è·å–å•ä¸ªå¹³å°å®šä»·è§„åˆ™
      operationId: getPlatformPricingRule
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: å®šä»·è§„åˆ™ID
      responses:
        '200':
          description: å®šä»·è§„åˆ™è¯¦æƒ…
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/PricingRule'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    put:
      tags:
        - admin-pricing
      summary: æ›´æ–°å¹³å°å®šä»·è§„åˆ™
      operationId: updatePlatformPricingRule
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: å®šä»·è§„åˆ™ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePricingRuleRequest'
      responses:
        '200':
          description: å®šä»·è§„åˆ™æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: å¹³å°å®šä»·è§„åˆ™æ›´æ–°æˆåŠŸ
                  data:
                    $ref: '#/components/schemas/PricingRule'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - admin-pricing
      summary: åˆ é™¤å¹³å°å®šä»·è§„åˆ™
      operationId: deletePlatformPricingRule
      security:
        - AdminSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: å®šä»·è§„åˆ™ID
      responses:
        '200':
          description: å®šä»·è§„åˆ™åˆ é™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: å¹³å°å®šä»·è§„åˆ™åˆ é™¤æˆåŠŸ
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/carrier/pricing-configs:
    get:
      tags:
        - carrier-pricing
      summary: è·å–æ‰¿è¿å•†å®šä»·é…ç½®åˆ—è¡¨
      operationId: listCarrierPricingConfigs
      security:
        - TenantSessionAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: é¡µç 
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: æ¯é¡µæ•°é‡
        - name: carrier_id
          in: query
          schema:
            type: integer
          description: æ‰¿è¿å•†IDè¿‡æ»¤
      responses:
        '200':
          description: æ‰¿è¿å•†å®šä»·é…ç½®åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CarrierPricingConfig'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - carrier-pricing
      summary: åˆ›å»ºæ‰¿è¿å•†å®šä»·é…ç½®
      operationId: createCarrierPricingConfig
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCarrierPricingConfigRequest'
      responses:
        '201':
          description: æ‰¿è¿å•†å®šä»·é…ç½®åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: æ‰¿è¿å•†å®šä»·é…ç½®åˆ›å»ºæˆåŠŸ
                  data:
                    $ref: '#/components/schemas/CarrierPricingConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/carrier/pricing-configs/{id}:
    get:
      tags:
        - carrier-pricing
      summary: è·å–å•ä¸ªæ‰¿è¿å•†å®šä»·é…ç½®
      operationId: getCarrierPricingConfig
      security:
        - TenantSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: å®šä»·é…ç½®ID
      responses:
        '200':
          description: æ‰¿è¿å•†å®šä»·é…ç½®è¯¦æƒ…
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/CarrierPricingConfig'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    put:
      tags:
        - carrier-pricing
      summary: æ›´æ–°æ‰¿è¿å•†å®šä»·é…ç½®
      operationId: updateCarrierPricingConfig
      security:
        - TenantSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: å®šä»·é…ç½®ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCarrierPricingConfigRequest'
      responses:
        '200':
          description: æ‰¿è¿å•†å®šä»·é…ç½®æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: æ‰¿è¿å•†å®šä»·é…ç½®æ›´æ–°æˆåŠŸ
                  data:
                    $ref: '#/components/schemas/CarrierPricingConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - carrier-pricing
      summary: åˆ é™¤æ‰¿è¿å•†å®šä»·é…ç½®
      operationId: deleteCarrierPricingConfig
      security:
        - TenantSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: å®šä»·é…ç½®ID
      responses:
        '200':
          description: æ‰¿è¿å•†å®šä»·é…ç½®åˆ é™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: æ‰¿è¿å•†å®šä»·é…ç½®åˆ é™¤æˆåŠŸ
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/carrier/my-pricing-config:
    get:
      tags:
        - carrier-pricing
      summary: è·å–å½“å‰æ‰¿è¿å•†çš„å®šä»·é…ç½®
      operationId: getMyPricingConfig
      security:
        - TenantSessionAuth: []
      responses:
        '200':
          description: å½“å‰æ‰¿è¿å•†å®šä»·é…ç½®è¯¦æƒ…
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/CarrierPricingConfig'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    put:
      tags:
        - carrier-pricing
      summary: æ›´æ–°å½“å‰æ‰¿è¿å•†çš„å®šä»·é…ç½®
      operationId: updateMyPricingConfig
      security:
        - TenantSessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCarrierPricingConfigRequest'
      responses:
        '200':
          description: æ‰¿è¿å•†å®šä»·é…ç½®æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: æ‰¿è¿å•†å®šä»·é…ç½®æ›´æ–°æˆåŠŸ
                  data:
                    $ref: '#/components/schemas/CarrierPricingConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/order/quote:
    post:
      tags:
        - public
      summary: è·å–è®¢å•æŠ¥ä»· - å®¢æˆ·ä¸‹å•æ—¶è·å–å¤šå®¶æ‰¿è¿å•†æŠ¥ä»·
      operationId: getOrderQuote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - distance_km
                - duration_hours
              properties:
                distance_km:
                  type: number
                  example: 15.5
                  description: è¿è¾“è·ç¦»ï¼ˆå…¬é‡Œï¼‰
                duration_hours:
                  type: number
                  example: 2.5
                  description: é¢„è®¡è¿è¾“æ—¶é•¿ï¼ˆå°æ—¶ï¼‰
                weight_kg:
                  type: number
                  example: 100
                  description: è´§ç‰©é‡é‡ï¼ˆå…¬æ–¤ï¼‰
                is_cold_storage:
                  type: boolean
                  example: false
                  description: æ˜¯å¦éœ€è¦å†·é“¾è¿è¾“
                time_slot:
                  type: string
                  example: morning
                  description: æ—¶é—´æ®µï¼ˆmorning, afternoon, evening, nightï¼‰
                weather_condition:
                  type: string
                  example: normal
                  enum:
                    - normal
                    - rain
                    - snow
                    - storm
                  description: å¤©æ°”çŠ¶å†µ
                region:
                  type: string
                  example: beijing_haidian
                  description: è¿è¾“åŒºåŸŸ
                vehicle_type:
                  type: string
                  example: van
                  enum:
                    - van
                    - truck
                    - refrigerated_truck
                    - container_truck
                  description: æ‰€éœ€è½¦å‹
                pickup_address:
                  type: string
                  example: åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·
                  description: æè´§åœ°å€
                delivery_address:
                  type: string
                  example: åŒ—äº¬å¸‚æœé˜³åŒºå›½è´¸å¤§å¦
                  description: é€è´§åœ°å€
                cargo_type:
                  type: string
                  example: electronics
                  enum:
                    - electronics
                    - clothing
                    - food
                    - medicine
                    - documents
                    - other
                  description: è´§ç‰©ç±»å‹
      responses:
        '200':
          description: æŠ¥ä»·è®¡ç®—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: æŠ¥ä»·è®¡ç®—æˆåŠŸ
                  data:
                    type: object
                    properties:
                      order_details:
                        $ref: '#/components/schemas/OrderDetails'
                      quotes:
                        type: array
                        items:
                          $ref: '#/components/schemas/CarrierQuote'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/order/{id}/add-ons:
    post:
      tags:
        - carrier-order
      summary: ä¸ºè®¢å•æ·»åŠ é™„åŠ è´¹ - æ‰¿è¿å•†æäº¤é™„åŠ æœåŠ¡è´¹ç”¨
      operationId: addOrderAddons
      security:
        - TenantSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: è®¢å•ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - addons_config
                - addons_total
              properties:
                addons_config:
                  type: object
                  description: é™„åŠ æœåŠ¡é…ç½®
                  properties:
                    loading_fee:
                      type: number
                      example: 50
                      description: è£…å¸è´¹
                    waiting_fee:
                      type: number
                      example: 30
                      description: ç­‰å¾…è´¹
                    overtime_fee:
                      type: number
                      example: 100
                      description: è¶…æ—¶è´¹
                    special_handling_fee:
                      type: number
                      example: 80
                      description: ç‰¹æ®Šå¤„ç†è´¹
                    cold_storage_fee:
                      type: number
                      example: 40
                      description: å†·è—é™„åŠ è´¹
                    insurance_fee:
                      type: number
                      example: 20
                      description: ä¿é™©è´¹
                    other_fees:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                            example: å¤œé—´é…é€è´¹
                          amount:
                            type: number
                            example: 60
                          description:
                            type: string
                            example: å¤œé—´é…é€é¢å¤–è´¹ç”¨
                addons_total:
                  type: number
                  example: 230
                  description: é™„åŠ è´¹æ€»è®¡
                description:
                  type: string
                  example: å› å®¢æˆ·è¦æ±‚å¤œé—´é…é€å’Œç‰¹æ®ŠåŒ…è£…äº§ç”Ÿçš„é™„åŠ è´¹ç”¨
                  description: é™„åŠ è´¹è¯´æ˜
      responses:
        '200':
          description: é™„åŠ è´¹æ·»åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: è®¢å•é™„åŠ è´¹æ·»åŠ æˆåŠŸ
                  data:
                    type: object
                    properties:
                      order_id:
                        type: integer
                        example: 1
                      tracking_number:
                        type: string
                        example: ORD-20260209-001
                      addons_config:
                        $ref: '#/components/schemas/AddonsConfig'
                      addons_total:
                        type: number
                        example: 230
                      addons_status:
                        type: string
                        example: pending
                        enum:
                          - pending
                          - confirmed
                          - rejected
                      updated_at:
                        type: string
                        format: date-time
                        example: '2026-02-09T12:00:00Z'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /api/order/{id}/add-ons/confirm:
    patch:
      tags:
        - customer-order
      summary: ç¡®è®¤è®¢å•é™„åŠ è´¹ - å®¢æˆ·ç¡®è®¤æˆ–æ‹’ç»æ‰¿è¿å•†æäº¤çš„é™„åŠ è´¹
      operationId: confirmOrderAddons
      security:
        - TenantSessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: è®¢å•ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - confirm
              properties:
                confirm:
                  type: boolean
                  example: true
                  description: æ˜¯å¦ç¡®è®¤é™„åŠ è´¹ (true=ç¡®è®¤, false=æ‹’ç»)
      responses:
        '200':
          description: é™„åŠ è´¹ç¡®è®¤çŠ¶æ€æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: è®¢å•é™„åŠ è´¹å·²ç¡®è®¤
                  data:
                    type: object
                    properties:
                      order_id:
                        type: integer
                        example: 1
                      tracking_number:
                        type: string
                        example: ORD-20260209-001
                      addons_total:
                        type: number
                        example: 230
                      addons_status:
                        type: string
                        example: confirmed
                        enum:
                          - pending
                          - confirmed
                          - rejected
                      addons_confirmation_time:
                        type: string
                        format: date-time
                        example: '2026-02-09T12:00:00Z'
                      total_price_with_addons:
                        type: number
                        example: 530
                      updated_at:
                        type: string
                        format: date-time
                        example: '2026-02-09T12:00:00Z'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'